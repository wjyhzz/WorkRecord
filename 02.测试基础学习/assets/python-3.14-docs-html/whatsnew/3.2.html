<!DOCTYPE html>

<html lang="zh-CN" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Python 3.2 有什么新变化" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://docs.python.org/3/whatsnew/3.2.html" />
<meta property="og:site_name" content="Python documentation" />
<meta property="og:description" content="作者, Raymond Hettinger（译者：wh2099 at outlook dot com）,. 这篇文章介绍了 Python 3.2 相比 3.1 新增的特性。 Python 3.2 发布于 2011 年 2 月 20 日。 文章聚焦于几个关键特性并给出了一些示例。 有关完整细节，请参阅 Misc/NEWS 文件。 PEP 384: 定义稳定的ABI: 过去，为一个 Python..." />
<meta property="og:image:width" content="1146" />
<meta property="og:image:height" content="600" />
<meta property="og:image" content="https://docs.python.org/3.14/zh-cn/_images/social_previews/summary_whatsnew_3.2_55241bcd.png" />
<meta property="og:image:alt" content="作者, Raymond Hettinger（译者：wh2099 at outlook dot com）,. 这篇文章介绍了 Python 3.2 相比 3.1 新增的特性。 Python 3.2 发布于 2011 年 2 月 20 日。 文章聚焦于几个关键特性并给出了一些示例。 有关完整细节，请参阅 Misc/NEWS 文件。 PEP 384: 定义稳定的ABI: 过去，为一个 Python..." />
<meta name="description" content="作者, Raymond Hettinger（译者：wh2099 at outlook dot com）,. 这篇文章介绍了 Python 3.2 相比 3.1 新增的特性。 Python 3.2 发布于 2011 年 2 月 20 日。 文章聚焦于几个关键特性并给出了一些示例。 有关完整细节，请参阅 Misc/NEWS 文件。 PEP 384: 定义稳定的ABI: 过去，为一个 Python..." />
<meta name="twitter:card" content="summary_large_image" />
<meta name="theme-color" content="#3776ab">

    <title>Python 3.2 有什么新变化 &#8212; Python 3.14.0 文档</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css?v=234b1a7c" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css?v=8cd84f99" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=5349f25f" />
    
    <script src="../_static/documentation_options.js?v=a595ec0e"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Python 3.14.0 文档 中搜索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="关于此文档" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="copyright" title="版权" href="../copyright.html" />
    <link rel="next" title="Python 3.1 有什么新变化" href="3.1.html" />
    <link rel="prev" title="Python 3.3 有什么新变化" href="3.3.html" />
    
      
      <script defer file-types="bz2,epub,zip" data-domain="docs.python.org" src="https://analytics.python.org/js/script.file-downloads.outbound-links.js"></script>
      
      <link rel="canonical" href="https://docs.python.org/3/whatsnew/3.2.html">
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="stylesheet" href="../_static/pydoctheme_dark.css" media="(prefers-color-scheme: dark)" id="pydoctheme_dark_css">
    <link rel="shortcut icon" type="image/png" href="../_static/py.svg">
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script>
            <script type="text/javascript" src="../_static/search-focus.js"></script>
            <script type="text/javascript" src="../_static/themetoggle.js"></script> 
            <script type="text/javascript" src="../_static/rtd_switcher.js"></script>
            <meta name="readthedocs-addons-api-version" content="1">

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="菜单">
    <nav class="nav-content" role="navigation">
        <label for="menuToggler" class="toggler__label">
            <span></span>
        </label>
        <span class="nav-items-wrapper">
            <a href="https://www.python.org/" class="nav-logo">
                <img src="../_static/py.svg" alt="Python logo">
            </a>
            <span class="version_switcher_placeholder"></span>
            <form role="search" class="search" action="../search.html" method="get">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                    <path fill-rule="nonzero" fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                </svg>
                <input placeholder="快速搜索" aria-label="快速搜索" type="search" name="q">
                <input type="submit" value="转到">
            </form>
        </span>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
            
<label class="theme-selector-label">
    主题
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>自动</option>
        <option value="light">明亮</option>
        <option value="dark">黑暗</option>
    </select>
</label>
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Python 3.2 有什么新变化</a><ul>
<li><a class="reference internal" href="#pep-384-defining-a-stable-abi">PEP 384: 定义稳定的ABI</a></li>
<li><a class="reference internal" href="#pep-389-argparse-command-line-parsing-module">PEP 389: Argparse 命令行解析模块</a></li>
<li><a class="reference internal" href="#pep-391-dictionary-based-configuration-for-logging">PEP 391:  基于字典的日志配置</a></li>
<li><a class="reference internal" href="#pep-3148-the-concurrent-futures-module">PEP 3148:  <code class="docutils literal notranslate"><span class="pre">concurrent.futures</span></code> 模块</a></li>
<li><a class="reference internal" href="#pep-3147-pyc-repository-directories">PEP 3147: PYC 仓库目录</a></li>
<li><a class="reference internal" href="#pep-3149-abi-version-tagged-so-files">PEP 3149: 带有 ABI 版本标签的 .so 文件</a></li>
<li><a class="reference internal" href="#pep-3333-python-web-server-gateway-interface-v1-0-1">PEP 3333: Python Web服务器网关接口v1.0.1</a></li>
<li><a class="reference internal" href="#other-language-changes">其他语言特性修改</a></li>
<li><a class="reference internal" href="#new-improved-and-deprecated-modules">新增、改进和弃用的模块</a><ul>
<li><a class="reference internal" href="#email">email</a></li>
<li><a class="reference internal" href="#elementtree">elementtree</a></li>
<li><a class="reference internal" href="#functools">functools</a></li>
<li><a class="reference internal" href="#itertools">itertools</a></li>
<li><a class="reference internal" href="#collections">collections</a></li>
<li><a class="reference internal" href="#threading">threading</a></li>
<li><a class="reference internal" href="#datetime-and-time">datetime 和 time</a></li>
<li><a class="reference internal" href="#math">math</a></li>
<li><a class="reference internal" href="#abc">abc(抽象基类)</a></li>
<li><a class="reference internal" href="#io">io</a></li>
<li><a class="reference internal" href="#reprlib">reprlib</a></li>
<li><a class="reference internal" href="#logging">logging</a></li>
<li><a class="reference internal" href="#csv">csv</a></li>
<li><a class="reference internal" href="#contextlib">contextlib</a></li>
<li><a class="reference internal" href="#decimal-and-fractions">decimal 和 fractions</a></li>
<li><a class="reference internal" href="#ftp">ftp</a></li>
<li><a class="reference internal" href="#popen">popen</a></li>
<li><a class="reference internal" href="#select">select</a></li>
<li><a class="reference internal" href="#gzip-and-zipfile">gzip 和 zipfile</a></li>
<li><a class="reference internal" href="#tarfile">tarfile</a></li>
<li><a class="reference internal" href="#hashlib">hashlib</a></li>
<li><a class="reference internal" href="#ast">ast</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#shutil">shutil</a></li>
<li><a class="reference internal" href="#sqlite3">sqlite3</a></li>
<li><a class="reference internal" href="#html">html</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#ssl">ssl</a></li>
<li><a class="reference internal" href="#nntp">nntp</a></li>
<li><a class="reference internal" href="#certificates">certificates</a></li>
<li><a class="reference internal" href="#imaplib">imaplib</a></li>
<li><a class="reference internal" href="#http-client">http.client</a></li>
<li><a class="reference internal" href="#unittest">unittest</a></li>
<li><a class="reference internal" href="#random">random</a></li>
<li><a class="reference internal" href="#poplib">poplib</a></li>
<li><a class="reference internal" href="#asyncore">asyncore</a></li>
<li><a class="reference internal" href="#tempfile">tempfile</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#pydoc">pydoc</a></li>
<li><a class="reference internal" href="#dis">dis</a></li>
<li><a class="reference internal" href="#dbm">dbm</a></li>
<li><a class="reference internal" href="#ctypes">ctypes</a></li>
<li><a class="reference internal" href="#site">site</a></li>
<li><a class="reference internal" href="#sysconfig">sysconfig</a></li>
<li><a class="reference internal" href="#pdb">pdb</a></li>
<li><a class="reference internal" href="#configparser">configparser</a></li>
<li><a class="reference internal" href="#urllib-parse">urllib.parse</a></li>
<li><a class="reference internal" href="#mailbox">mailbox</a></li>
<li><a class="reference internal" href="#turtledemo">turtledemo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multi-threading">多线程</a></li>
<li><a class="reference internal" href="#optimizations">性能优化</a></li>
<li><a class="reference internal" href="#unicode">Unicode</a></li>
<li><a class="reference internal" href="#codecs">编解码器</a></li>
<li><a class="reference internal" href="#documentation">文档</a></li>
<li><a class="reference internal" href="#idle">IDLE</a></li>
<li><a class="reference internal" href="#code-repository">代码库</a></li>
<li><a class="reference internal" href="#build-and-c-api-changes">构建和 C API 的改变</a></li>
<li><a class="reference internal" href="#porting-to-python-3-2">移植到 Python 3.2</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一主题</h4>
    <p class="topless"><a href="3.3.html"
                          title="上一章">Python 3.3 有什么新变化</a></p>
  </div>
  <div>
    <h4>下一主题</h4>
    <p class="topless"><a href="3.1.html"
                          title="下一章">Python 3.1 有什么新变化</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">报告代码错误</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/whatsnew/3.2.rst?plain=1"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="Related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="3.1.html" title="Python 3.1 有什么新变化"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="3.3.html" title="Python 3.3 有什么新变化"
             accesskey="P">上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="Python logo" style="vertical-align: middle; margin-top: -1px"></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.14.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Python的新变化</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python 3.2 有什么新变化</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="search" name="q" id="search-box">
          <input type="submit" value="转到">
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    主题
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>自动</option>
        <option value="light">明亮</option>
        <option value="dark">黑暗</option>
    </select>
</label> |</li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="what-s-new-in-python-3-2">
<h1 class="translated">Python 3.2 有什么新变化<a class="headerlink" href="#what-s-new-in-python-3-2" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd translated">作者<span class="colon">:</span></dt>
<dd class="field-odd translated"><p class="translated">Raymond Hettinger（译者：wh2099 at outlook dot com）</p>
</dd>
</dl>
<p class="translated">这篇文章介绍了 Python 3.2 相比 3.1 新增的特性。 Python 3.2 发布于 2011 年 2 月 20 日。 文章聚焦于几个关键特性并给出了一些示例。 有关完整细节，请参阅 <a class="reference external" href="https://github.com/python/cpython/blob/076ca6c3c8df3030307e548d9be792ce3c1c6eea/Misc/NEWS">Misc/NEWS</a> 文件。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p class="translated"><span class="target" id="index-30"></span><a class="pep reference external" href="https://peps.python.org/pep-0392/"><strong>PEP 392</strong></a> - Python 3.2 发布计划</p>
</div>
<section id="pep-384-defining-a-stable-abi">
<h2 class="translated">PEP 384: 定义稳定的ABI<a class="headerlink" href="#pep-384-defining-a-stable-abi" title="Link to this heading">¶</a></h2>
<p class="translated">过去，为一个 Python 版本所构建的扩展模块通常无法用于其他 Python 版本。 特别是在 Windows 上，每一个 Python 新特性发布版都必须重新构建想要使用的所有扩展模块。 之所以有这样的要求是因为扩展模块可以任意访问 Python 解释器的内部对象。</p>
<p class="translated">在 Python 3.2 中，则有了一种替代方式：扩展模块将自己约束于一个受限 API（通过定义 Py_LIMITED_API）因而不能使用许多内部对象，仅限使用一组承诺会在多个发布版中保持稳定的 API 函数。 作为其结果，在这种模式下为 3.2 构建的扩展模块也将能在 3.3、3.4 等版本中运行。 使用了内存结构体细节数据的扩展模块仍然可以被构建，但将需要为每个新特性发布版重新编译。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<dl class="simple">
<dt class="translated"><span class="target" id="index-31"></span><a class="pep reference external" href="https://peps.python.org/pep-0384/"><strong>PEP 384</strong></a> - 定义稳定的ABI</dt><dd><p class="translated">PEP 由 Martin von Löwis 撰写。</p>
</dd>
</dl>
</div>
</section>
<section id="pep-389-argparse-command-line-parsing-module">
<h2 class="translated">PEP 389: Argparse 命令行解析模块<a class="headerlink" href="#pep-389-argparse-command-line-parsing-module" title="Link to this heading">¶</a></h2>
<p class="translated">引入了一个新的 <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> 模块用于命令行解析，以克服 <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">optparse</span></code></a> 的局限性，后者不支持位置参数（不仅仅是选项）、子命令、必需选项以及其他常见的选项指定和验证模式。</p>
<p class="translated">该模块作为一个第三方模块已在社区中取得了广泛的成功。相比其前身，<a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> 模块功能更加全面，现在是处理命令行的首选模块。出于对大量依赖该模块的遗留代码的考虑，旧模块仍被保留使用。</p>
<p class="translated">以下是一个带注释的示例解析器，展示了诸如限制结果到一组选项、在帮助屏幕中指定 <em>metavar</em>、验证一个或多个位置参数是否存在以及创建一个必需选项等功能：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
            <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;管理服务器&#39;</span><span class="p">,</span>         <span class="c1"># 帮助中的主要描述</span>
            <span class="n">epilog</span> <span class="o">=</span> <span class="s1">&#39;已在Solaris和Linux上测试&#39;</span><span class="p">)</span> <span class="c1"># 要求帮助后显示的内容</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span>                       <span class="c1"># 参数名称</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">],</span>  <span class="c1"># 三个允许的值</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;对每个目标执行的操作&#39;</span><span class="p">)</span>         <span class="c1"># 帮助信息</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;targets&#39;</span><span class="p">,</span>
            <span class="n">metavar</span> <span class="o">=</span> <span class="s1">&#39;HOSTNAME&#39;</span><span class="p">,</span>                   <span class="c1"># 帮助信息中使用的变量名</span>
            <span class="n">nargs</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span>                            <span class="c1"># 需要一个或多个目标</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;目标机器的URL&#39;</span><span class="p">)</span>               <span class="c1"># 帮助信息解释</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-u&#39;</span><span class="p">,</span> <span class="s1">&#39;--user&#39;</span><span class="p">,</span>                 <span class="c1"># -u 或 --user 选项</span>
            <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>                        <span class="c1"># 使其成为必需参数</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;以用户身份登录&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">在命令字符串中调用解析器的示例:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;deploy sneezy.example.com sleepy.example.com -u skycaptain&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">action</span>
<span class="go">&#39;deploy&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">targets</span>
<span class="go">[&#39;sneezy.example.com&#39;, &#39;sleepy.example.com&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">user</span>
<span class="go">&#39;skycaptain&#39;</span>
</pre></div>
</div>
<p class="translated">解析器自动生成的帮助示例:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

<span class="go">usage: manage_cloud.py [-h] -u USER</span>
<span class="go">                       {deploy,start,stop} HOSTNAME [HOSTNAME ...]</span>

<span class="go">Manage servers</span>

<span class="go">positional arguments:</span>
<span class="go">  {deploy,start,stop}   action on each target</span>
<span class="go">  HOSTNAME              url for target machines</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -u USER, --user USER  login as user</span>

<span class="go">Tested on Solaris and Linux</span>
</pre></div>
</div>
<p class="translated">一个非常好的 <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> 特性是可以定义子解析器，每个子解析器拥有它们自己的参数模式和帮助显示:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s1">&#39;HELM&#39;</span><span class="p">)</span>
<span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">()</span>

<span class="n">parser_l</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;launch&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Launch Control&#39;</span><span class="p">)</span>   <span class="c1"># 第一个子分组</span>
<span class="n">parser_l</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;--missiles&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
<span class="n">parser_l</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;--torpedos&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>

<span class="n">parser_m</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;move&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Move Vessel&#39;</span><span class="p">,</span>        <span class="c1"># 第二个子分组</span>
                                 <span class="n">aliases</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;steer&#39;</span><span class="p">,</span> <span class="s1">&#39;turn&#39;</span><span class="p">))</span>         <span class="c1"># 等价的名称</span>
<span class="n">parser_m</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--course&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser_m</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="s1">&#39;--speed&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="translated highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./helm.py<span class="w"> </span>--help<span class="w">                         </span><span class="c1"># 最高层级的帮助 (launch 和 move)</span>
<span class="gp">$ </span>./helm.py<span class="w"> </span>launch<span class="w"> </span>--help<span class="w">                  </span><span class="c1"># launch 选项的帮助</span>
<span class="gp">$ </span>./helm.py<span class="w"> </span>launch<span class="w"> </span>--missiles<span class="w">              </span><span class="c1"># 设置 missiles=True 及 torpedos=False</span>
<span class="gp">$ </span>./helm.py<span class="w"> </span>steer<span class="w"> </span>--course<span class="w"> </span><span class="m">180</span><span class="w"> </span>--speed<span class="w"> </span><span class="m">5</span><span class="w">   </span><span class="c1"># 设置动作形参</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<dl class="simple">
<dt class="translated"><span class="target" id="index-32"></span><a class="pep reference external" href="https://peps.python.org/pep-0389/"><strong>PEP 389</strong></a> - 新的命令行解析模块</dt><dd><p class="translated">PEP 由 Steven Bethard 撰写。</p>
</dd>
</dl>
<p class="translated">参阅 <a class="reference internal" href="../howto/argparse-optparse.html#upgrading-optparse-code"><span class="std std-ref">将 optparse 代码迁移至 argparse</span></a> 了解与 <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">optparse</span></code></a> 的差异的细节。</p>
</div>
</section>
<section id="pep-391-dictionary-based-configuration-for-logging">
<h2 class="translated">PEP 391:  基于字典的日志配置<a class="headerlink" href="#pep-391-dictionary-based-configuration-for-logging" title="Link to this heading">¶</a></h2>
<p class="translated"><a class="reference internal" href="../library/logging.html#module-logging" title="logging: Flexible event logging system for applications."><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> 模块提供了两种配置方式，一种是通过函数调用为每个选项进行配置，另一种是通过外部文件进行配置，该文件以 <a class="reference internal" href="../library/configparser.html#module-configparser" title="configparser: Configuration file parser."><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> 格式保存。这些选项无法灵活地从 JSON 或 YAML 文件创建配置，也不支持增量配置，而增量配置是用于从命令行指定日志记录器选项所必需的。</p>
<p class="translated">为了支持更灵活的配置方式，该模块现在提供了 <a class="reference internal" href="../library/logging.config.html#logging.config.dictConfig" title="logging.config.dictConfig"><code class="xref py py-func docutils literal notranslate"><span class="pre">logging.config.dictConfig()</span></code></a>，用于通过普通的 Python 字典指定日志配置。配置选项包括格式化器、处理器、过滤器和日志记录器。以下是一个配置字典的工作示例：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s2">&quot;formatters&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;brief&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(levelname)-8s</span><span class="s2">: </span><span class="si">%(name)-15s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">},</span>
                <span class="s2">&quot;full&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(name)-15s</span><span class="s2"> </span><span class="si">%(levelname)-8s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">}</span>
                <span class="p">},</span>
 <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="p">{</span>
                   <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.StreamHandler&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;brief&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="s2">&quot;ext://sys.stdout&quot;</span><span class="p">},</span>
              <span class="s2">&quot;console_priority&quot;</span><span class="p">:</span> <span class="p">{</span>
                   <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.StreamHandler&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;full&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="s2">&quot;ext://sys.stderr&quot;</span><span class="p">}</span>
              <span class="p">},</span>
 <span class="s2">&quot;root&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;console&quot;</span><span class="p">,</span> <span class="s2">&quot;console_priority&quot;</span><span class="p">]}}</span>
</pre></div>
</div>
<p class="translated">如果将该字典存储在一个名为 <code class="file docutils literal notranslate"><span class="pre">conf.json</span></code> 的文件中，可以使用如下代码加载并调用它：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span><span class="o">,</span><span class="w"> </span><span class="nn">logging.config</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;conf.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">conf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Transaction completed normally&quot;</span><span class="p">)</span>
<span class="go">INFO    : root           : Transaction completed normally</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Abnormal termination&quot;</span><span class="p">)</span>
<span class="go">2011-02-17 11:14:36,694 root            CRITICAL Abnormal termination</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<dl class="simple">
<dt class="translated"><span class="target" id="index-33"></span><a class="pep reference external" href="https://peps.python.org/pep-0391/"><strong>PEP 391</strong></a> - 基于字典的日志配置</dt><dd><p class="translated">PEP 由 Vinay Sajip 撰写。</p>
</dd>
</dl>
</div>
</section>
<section id="pep-3148-the-concurrent-futures-module">
<h2 class="translated">PEP 3148:  <code class="docutils literal notranslate"><span class="pre">concurrent.futures</span></code> 模块<a class="headerlink" href="#pep-3148-the-concurrent-futures-module" title="Link to this heading">¶</a></h2>
<p class="translated">用于创建和管理并发性的代码正在被收集到一个新的顶级命名空间 <em>concurrent</em> 中。其第一个成员是一个 <em>futures</em> 包，该包提供了一个统一的高级接口，用于管理线程和进程。</p>
<p class="translated"><a class="reference internal" href="../library/concurrent.futures.html#module-concurrent.futures" title="concurrent.futures: Execute computations concurrently using threads or processes."><code class="xref py py-mod docutils literal notranslate"><span class="pre">concurrent.futures</span></code></a> 的设计灵感来自 <em>java.util.concurrent</em> 包。在该模型中，一个正在运行的调用及其结果由一个 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Future" title="concurrent.futures.Future"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a> 对象表示，该对象抽象了线程、进程和远程过程调用共有的特性。该对象支持状态检查（运行中或已完成）、超时、取消、添加回调以及访问结果或异常。</p>
<p class="translated">新模块的核心功能是提供了一对执行器类，用于启动和管理调用任务。这些执行器的设计目标是简化现有并行调用工具的使用流程，它们能够帮助开发者省去以下繁琐操作：配置资源池、发起调用任务、创建结果队列、添加超时处理机制，以及限制线程、进程或远程过程调用的总数量。</p>
<p class="translated">理想情况下，每个应用程序应该在多个组件之间共享单个执行器，以便可以集中管理进程和线程限制。这解决了当每个组件都有自己的资源管理竞争策略时出现的设计挑战。</p>
<p class="translated">这两个类共享一个通用接口，包含三个方法：<a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Executor.submit" title="concurrent.futures.Executor.submit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">submit()</span></code></a> 用于调度可调用对象并返回一个 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Future" title="concurrent.futures.Future"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a> 对象；<a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Executor.map" title="concurrent.futures.Executor.map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">map()</span></code></a> 用于一次性调度多个异步调用；<a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Executor.shutdown" title="concurrent.futures.Executor.shutdown"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shutdown()</span></code></a> 用于释放资源。该类是一个 <a class="reference internal" href="../glossary.html#term-context-manager"><span class="xref std std-term">上下文管理器</span></a>，可以在 <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 语句中使用，以确保在当前挂起的futures对象执行完毕时自动释放资源。</p>
<p class="translated"><a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="concurrent.futures.ThreadPoolExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">ThreadPoolExecutor</span></code></a> 的一个简单示例是启动四个并行线程来复制文件：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="o">,</span><span class="w"> </span><span class="nn">shutil</span>
<span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">e</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="s1">&#39;src1.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;dest1.txt&#39;</span><span class="p">)</span>
    <span class="n">e</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="s1">&#39;src2.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;dest2.txt&#39;</span><span class="p">)</span>
    <span class="n">e</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="s1">&#39;src3.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;dest3.txt&#39;</span><span class="p">)</span>
    <span class="n">e</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="s1">&#39;src3.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;dest4.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<dl class="simple">
<dt class="translated"><span class="target" id="index-34"></span><a class="pep reference external" href="https://peps.python.org/pep-3148/"><strong>PEP 3148</strong></a> -- futures - 异步执行指令</dt><dd><p class="translated">PEP 由 Brian Quinlan 撰写。</p>
</dd>
</dl>
<p class="translated"><a class="reference internal" href="../library/concurrent.futures.html#threadpoolexecutor-example"><span class="std std-ref">使用线程并行 URL 读取的代码示例</span></a>，展示了如何利用线程并发获取多个网页内容。</p>
<p class="translated"><a class="reference internal" href="../library/concurrent.futures.html#processpoolexecutor-example"><span class="std std-ref">并行计算质数的代码示例</span></a>，展示了 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor" title="concurrent.futures.ProcessPoolExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessPoolExecutor</span></code></a> 的用法。</p>
</div>
</section>
<section id="pep-3147-pyc-repository-directories">
<h2 class="translated">PEP 3147: PYC 仓库目录<a class="headerlink" href="#pep-3147-pyc-repository-directories" title="Link to this heading">¶</a></h2>
<p class="translated">Python 在 <em>.pyc</em> 文件中缓存字节码的方案在存在多个 Python 解释器的环境中效果不佳。如果一个解释器遇到了由另一个解释器创建的缓存文件，它会重新编译源代码并覆盖缓存文件，从而失去缓存的优势。</p>
<p class="translated">随着 Linux 发行版普遍附带多个 Python 版本，“pyc 冲突”问题变得更加突出。这些冲突在使用 CPython 的替代品（如 Unladen Swallow）时也会出现。</p>
<p class="translated">为解决此问题，Python 的导入机制已进行扩展，会为每个解释器使用不同的文件名。Python 3.2、Python 3.3 和 Unladen Swallow 不再争抢同一个名为 &quot;mymodule.pyc&quot; 的文件，而是分别查找 &quot;mymodule.cpython-32.pyc&quot;、&quot;mymodule.cpython-33.pyc&quot; 和 &quot;mymodule.unladen10.pyc&quot;。此外，为避免这些新文件使源目录变得杂乱，<em>pyc</em> 文件现在会被收集到一个名为 &quot;__pycache__&quot; 的目录中，该目录存放在包目录下。</p>
<p class="translated">除了文件名和目标目录之外，新方案还有几个方面是程序员可见的：</p>
<ul>
<li><p class="translated">导入的模块现在具有一个 <a class="reference internal" href="../reference/datamodel.html#module.__cached__" title="module.__cached__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__cached__</span></code></a> 属性，该属性存储实际导入的文件名：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collections</span><span class="o">.</span><span class="n">__cached__</span>
<span class="go">&#39;c:/py32/lib/__pycache__/collections.cpython-32.pyc&#39;</span>
</pre></div>
</div>
</li>
<li><p class="translated">可以通过 <code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code> 模块访问每个解释器唯一的标签：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">imp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">imp</span><span class="o">.</span><span class="n">get_tag</span><span class="p">()</span>
<span class="go">&#39;cpython-32&#39;</span>
</pre></div>
</div>
</li>
<li><p class="translated">尝试从导入的文件推断源文件名的脚本现在需要更智能。简单地从&quot;.pyc&quot;文件名中去除&quot;c&quot;已不再足够。相反，应使用 <code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code> 模块中的新函数：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">imp</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">(</span><span class="s1">&#39;c:/py32/lib/__pycache__/collections.cpython-32.pyc&#39;</span><span class="p">)</span>
<span class="go">&#39;c:/py32/lib/collections.py&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="s1">&#39;c:/py32/lib/collections.py&#39;</span><span class="p">)</span>
<span class="go">&#39;c:/py32/lib/__pycache__/collections.cpython-32.pyc&#39;</span>
</pre></div>
</div>
</li>
<li><p class="translated"><a class="reference internal" href="../library/py_compile.html#module-py_compile" title="py_compile: Generate byte-code files from Python source files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">py_compile</span></code></a> 和 <a class="reference internal" href="../library/compileall.html#module-compileall" title="compileall: Tools for byte-compiling all Python source files in a directory tree."><code class="xref py py-mod docutils literal notranslate"><span class="pre">compileall</span></code></a> 模块已更新以反映新的命名约定和目标目录。<em>compileall</em> 的命令行调用有了新选项：<code class="docutils literal notranslate"><span class="pre">-i</span></code> 用于指定要编译的文件和目录列表，<code class="docutils literal notranslate"><span class="pre">-b</span></code> 使字节码文件写入其传统位置而非 <em>__pycache__</em>。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/importlib.html#module-importlib.abc" title="importlib.abc: Abstract base classes related to import"><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib.abc</span></code></a> 模块已更新，包含用于加载字节码文件的新 <a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">抽象基类</span></a>。已弃用的ABCs，<code class="xref py py-class docutils literal notranslate"><span class="pre">PyLoader</span></code> 和 <code class="xref py py-class docutils literal notranslate"><span class="pre">PyPycLoader</span></code> (如何保持与 Python 3.1 兼容的说明包含在文档中) 。</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<dl class="simple">
<dt class="translated"><span class="target" id="index-35"></span><a class="pep reference external" href="https://peps.python.org/pep-3147/"><strong>PEP 3147</strong></a> - PYC 仓库目录</dt><dd><p class="translated">PEP 由 Barry Warsaw 撰写。</p>
</dd>
</dl>
</div>
</section>
<section id="pep-3149-abi-version-tagged-so-files">
<h2 class="translated">PEP 3149: 带有 ABI 版本标签的 .so 文件<a class="headerlink" href="#pep-3149-abi-version-tagged-so-files" title="Link to this heading">¶</a></h2>
<p class="translated">PYC存储库目录允许多个字节码缓存文件共存。此PEP通过为共享对象文件提供一个公共目录并为每个版本提供不同的名称，实现了类似的机制。</p>
<p class="translated">通用目录为 &quot;pyshared&quot;，文件名通过识别 Python 实现方式（如 CPython、PyPy、Jython 等）、主版本号和次版本号以及可选的构建标志（如 &quot;d&quot; 表示调试、&quot;m&quot; 表示 pymalloc、&quot;u&quot; 表示宽Unicode）来区分。对于任意包 &quot;foo&quot;，当分发包安装时，您可能会看到这些文件：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pyshared</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mi">32</span><span class="n">m</span><span class="o">.</span><span class="n">so</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pyshared</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mi">33</span><span class="n">md</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
<p class="translated">对于 Python 本身，可以通过 <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sysconfig</span></code></a> 模块中的函数来访问这些标签:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">sysconfig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sysconfig</span><span class="o">.</span><span class="n">get_config_var</span><span class="p">(</span><span class="s1">&#39;SOABI&#39;</span><span class="p">)</span>       <span class="c1"># 查找版本标签</span>
<span class="go">&#39;cpython-32mu&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sysconfig</span><span class="o">.</span><span class="n">get_config_var</span><span class="p">(</span><span class="s1">&#39;EXT_SUFFIX&#39;</span><span class="p">)</span>  <span class="c1"># 查找完整文件名扩展</span>
<span class="go">&#39;.cpython-32mu.so&#39;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<dl class="simple">
<dt class="translated"><span class="target" id="index-36"></span><a class="pep reference external" href="https://peps.python.org/pep-3149/"><strong>PEP 3149</strong></a> - 带有 ABI 版本标签的 .so 文件</dt><dd><p class="translated">PEP 由 Barry Warsaw 撰写。</p>
</dd>
</dl>
</div>
</section>
<section id="pep-3333-python-web-server-gateway-interface-v1-0-1">
<h2 class="translated">PEP 3333: Python Web服务器网关接口v1.0.1<a class="headerlink" href="#pep-3333-python-web-server-gateway-interface-v1-0-1" title="Link to this heading">¶</a></h2>
<p class="translated">本信息性 PEP 阐明了 WSGI 协议如何处理字节/文本问题。挑战在于，尽管 HTTP 协议本身是基于字节的，但 Python 3 中的字符串处理最方便的方式是使用 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 类型。</p>
<p class="translated">该 PEP 规范区分了用于请求/响应头和元数据的所谓 <em>原生字符串</em> (native strings)，与用于请求和响应正文的 <em>字节字符串</em> (byte strings)。</p>
<p class="translated"><em>原生字符串</em> 始终为 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 类型，但限制在 <em>U+0000</em> 到 <em>U+00FF</em> 之间的代码点，这些代码点可以使用 <em>Latin-1</em> 编码转换为字节。这些字符串用于环境字典中的键和值，以及 <code class="xref py py-func docutils literal notranslate"><span class="pre">start_response()</span></code> 函数中的响应头和状态。它们必须遵循 <span class="target" id="index-37"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> 的编码要求。也就是说，它们必须是 <em>ISO-8859-1</em> 字符或使用 <span class="target" id="index-38"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2047.html"><strong>RFC 2047</strong></a> MIME 编码。</p>
<p class="translated">对于从 Python 2 迁移 WSGI 应用程序的开发者，以下是关键点：</p>
<ul class="simple">
<li><p class="translated">如果应用程序在 Python 2 中已经使用字符串作为请求/响应头，则无需更改。</p></li>
<li><p class="translated">如果应用程序对输出头进行编码或对输入头进行解码，则头需要重新编码为 Latin-1。例如，一个使用 utf-8 编码的输出头原本使用 <code class="docutils literal notranslate"><span class="pre">h.encode('utf-8')</span></code>，现在需要转换为字节到原生字符串，使用 <code class="docutils literal notranslate"><span class="pre">h.encode('utf-8').decode('latin-1')</span></code>。</p></li>
<li><p class="translated">应用程序生成的值或使用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">write()</span></code> 方法发送的值必须是字节字符串。<code class="xref py py-func docutils literal notranslate"><span class="pre">start_response()</span></code> 函数和环境必须使用原生字符串。两者不能混用。</p></li>
</ul>
<p class="translated">对于编写CGI到WSGI路径或其他CGI风格协议的服务器实现者来说，用户必须能够使用原生字符串访问环境，即使底层平台可能有不同的约定。为了弥合这一差距，<a class="reference internal" href="../library/wsgiref.html#module-wsgiref" title="wsgiref: WSGI Utilities and Reference Implementation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">wsgiref</span></code></a> 模块新增了一个函数 <a class="reference internal" href="../library/wsgiref.html#wsgiref.handlers.read_environ" title="wsgiref.handlers.read_environ"><code class="xref py py-func docutils literal notranslate"><span class="pre">wsgiref.handlers.read_environ()</span></code></a>，用于将CGI变量从 <a class="reference internal" href="../library/os.html#os.environ" title="os.environ"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.environ</span></code></a> 转码为原生字符串，并返回一个新的字典。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<dl class="simple">
<dt class="translated"><span class="target" id="index-39"></span><a class="pep reference external" href="https://peps.python.org/pep-3333/"><strong>PEP 3333</strong></a> - Python Web服务器网关接口v1.0.1</dt><dd><p class="translated">PEP 由 Phillip Eby 撰写。</p>
</dd>
</dl>
</div>
</section>
<section id="other-language-changes">
<h2 class="translated">其他语言特性修改<a class="headerlink" href="#other-language-changes" title="Link to this heading">¶</a></h2>
<p class="translated">对Python 语言核心进行的小改动：</p>
<ul>
<li><p class="translated"><a class="reference internal" href="../library/functions.html#format" title="format"><code class="xref py py-func docutils literal notranslate"><span class="pre">format()</span></code></a> 函数和 <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> 方法的字符串格式化功能为格式字符 <strong>#</strong> 新增了能力。此前，对于二进制、八进制或十六进制的整数，该字符会使输出分别带有 '0b'、'0o' 或 '0x' 前缀。现在，它还能处理浮点数、复数和 Decimal 类型，确保输出始终包含小数点——即使后续没有数字跟随。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">format</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;#o&#39;</span><span class="p">)</span>
<span class="go">&#39;0o24&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">format</span><span class="p">(</span><span class="mf">12.34</span><span class="p">,</span> <span class="s1">&#39;#5.0f&#39;</span><span class="p">)</span>
<span class="go">&#39;  12.&#39;</span>
</pre></div>
</div>
<p class="translated">（由 Mark Dickinson 建议，Eric Smith 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7094">bpo-7094</a> 中实现。）</p>
</li>
<li><p class="translated">还有一个新的 <a class="reference internal" href="../library/stdtypes.html#str.format_map" title="str.format_map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format_map()</span></code></a> 方法，它通过接受任意的 <a class="reference internal" href="../glossary.html#term-mapping"><span class="xref std std-term">mapping</span></a> 对象，扩展了现有 <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> 方法的功能。这个新方法使得可以使用字符串格式化与Python的许多字典类对象，如 <a class="reference internal" href="../library/collections.html#collections.defaultdict" title="collections.defaultdict"><code class="xref py py-class docutils literal notranslate"><span class="pre">defaultdict</span></code></a>、<a class="reference internal" href="../library/shelve.html#shelve.Shelf" title="shelve.Shelf"><code class="xref py py-class docutils literal notranslate"><span class="pre">Shelf</span></code></a>、<a class="reference internal" href="../library/configparser.html#configparser.ConfigParser" title="configparser.ConfigParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a> 或 <a class="reference internal" href="../library/dbm.html#module-dbm" title="dbm: Interfaces to various Unix &quot;database&quot; formats."><code class="xref py py-mod docutils literal notranslate"><span class="pre">dbm</span></code></a>。它也适用于在查找前标准化键的自定义 <a class="reference internal" href="../library/stdtypes.html#dict" title="dict"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> 子类，或者为未知键提供 <a class="reference internal" href="../reference/datamodel.html#object.__missing__" title="object.__missing__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__missing__()</span></code></a> 方法的自定义类:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">shelve</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;tmp.shl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;The </span><span class="si">{project_name}</span><span class="s1"> status is </span><span class="si">{status}</span><span class="s1"> as of </span><span class="si">{date}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">&#39;The testing project status is green as of February 15, 2011&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">LowerCasedDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lcd</span> <span class="o">=</span> <span class="n">LowerCasedDict</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="s1">&#39;widgets&#39;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;There are </span><span class="si">{QUANTITY}</span><span class="s1"> </span><span class="si">{Part}</span><span class="s1"> in stock&#39;</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">lcd</span><span class="p">)</span>
<span class="go">&#39;There are 10 widgets in stock&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">PlaceholderDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;Hello </span><span class="si">{name}</span><span class="s1">, welcome to </span><span class="si">{location}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">PlaceholderDict</span><span class="p">())</span>
<span class="go">&#39;Hello &lt;name&gt;, welcome to &lt;location&gt;&#39;</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p class="translated">（由 Raymond Hettinger 提议并由 Eric Smith 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6081">bpo-6081</a> 中实现。）</p>
</div></blockquote>
<ul>
<li><p class="translated">解释器现在可以带有一个安静选项 <code class="docutils literal notranslate"><span class="pre">-q</span></code> 启动，以防止在交互模式下显示版权和版本信息。该选项可以通过 <a class="reference internal" href="../library/sys.html#sys.flags" title="sys.flags"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.flags</span></code></a> 属性进行内省：</p>
<div class="translated highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-q
<span class="go">&gt;&gt;&gt; sys.flags</span>
<span class="go">sys.flags(debug=0, division_warning=0, inspect=0, interactive=0,</span>
<span class="go">optimize=0, dont_write_bytecode=0, no_user_site=0, no_site=0,</span>
<span class="go">ignore_environment=0, verbose=0, bytes_warning=0, quiet=1)</span>
</pre></div>
</div>
<p class="translated">（由 Marcin Wojdyr 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1772833">bpo-1772833</a> 中贡献。）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../library/functions.html#hasattr" title="hasattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">hasattr()</span></code></a> 函数通过调用 <a class="reference internal" href="../library/functions.html#getattr" title="getattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">getattr()</span></code></a> 并检测是否引发异常来工作。这种技术使其能够检测由 <a class="reference internal" href="../reference/datamodel.html#object.__getattr__" title="object.__getattr__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattr__()</span></code></a> 或 <a class="reference internal" href="../reference/datamodel.html#object.__getattribute__" title="object.__getattribute__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattribute__()</span></code></a> 动态创建的方法，这些方法在类字典中原本是不存在的。以前，<em>hasattr</em> 会捕获任何异常，可能会掩盖真正的错误。现在，<em>hasattr</em> 已经被改进，仅捕获 <a class="reference internal" href="../library/exceptions.html#AttributeError" title="AttributeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a>，而让其他异常通过:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="mi">1</span> <span class="o">//</span> <span class="mi">0</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">ZeroDivisionError</span>: <span class="n">integer division or modulo by zero</span>
</pre></div>
</div>
<p class="translated">（由 Yury Selivanov 发现并由 Benjamin Peterson 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9666">bpo-9666</a> 中修复。）</p>
</li>
<li><p class="translated">浮点数或复数的 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code></a> 现在与它的 <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code></a> 相同。以前，<a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code></a> 形式更短，但这只会造成混淆，因此现在默认显示最短的 <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">repr</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="go">&#39;3.141592653589793&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="go">&#39;3.141592653589793&#39;</span>
</pre></div>
</div>
<p class="translated">（由 Mark Dickinson 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9337">bpo-9337</a> 中提议并实现。）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a> 对象现在有一个 <a class="reference internal" href="../library/stdtypes.html#memoryview.release" title="memoryview.release"><code class="xref py py-meth docutils literal notranslate"><span class="pre">release()</span></code></a> 方法，并且它们现在也支持上下文管理协议。这允许及时释放请求原始对象缓冲区时获得的任何资源。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">memoryview</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;abcdefgh&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="go">[97, 98, 99, 100, 101, 102, 103, 104]</span>
</pre></div>
</div>
<p class="translated">（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9757">bpo-9757</a> 中添加。）</p>
</li>
<li><p class="translated">此前，如果名称在嵌套块中作为自由变量出现，删除局部命名空间中的名称是非法的:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">outer</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">inner</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="n">inner</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">x</span>
</pre></div>
</div>
<p class="translated">现在允许这样做。请记住，<a class="reference internal" href="../reference/compound_stmts.html#except"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">except</span></code></a> 子句的目标是被清除的，所以这段代码在 Python 2.6 中可以工作，但在 Python 3.1 中会引发 <a class="reference internal" href="../library/exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a>，现在又再次可以工作:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">():</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_error</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">something</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">print_error</span><span class="p">()</span>
        <span class="c1"># 在此隐式执行 &quot;del e&quot;</span>
</pre></div>
</div>
<p class="translated">（参见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4617">bpo-4617</a>。）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../c-api/tuple.html#struct-sequence-objects"><span class="std std-ref">结构体序列类型</span></a> 现在是 tuple 的子类。这意味着像 <a class="reference internal" href="../library/os.html#os.stat" title="os.stat"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.stat()</span></code></a>、<a class="reference internal" href="../library/time.html#time.gmtime" title="time.gmtime"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.gmtime()</span></code></a> 和 <a class="reference internal" href="../library/sys.html#sys.version_info" title="sys.version_info"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.version_info</span></code></a> 返回的 C 结构现在像 <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">具名元组</span></a> 一样工作，并且可以与期望一个元组作为参数的函数和方法一起使用。这是使 C 结构体与其纯 Python 对应物一样灵活的一大步:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;Version </span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1"> </span><span class="si">%s</span><span class="s1">(</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span>
<span class="go">&#39;Version 3.2.0 final(0)&#39;</span>
</pre></div>
</div>
<p class="translated">（由 Arfrever Frehtes Taifersar Arahesis 建议，Benjamin Peterson 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8413">bpo-8413</a> 中实现。）</p>
</li>
<li><p class="translated">现在可以使用 <span class="target" id="index-40"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONWARNINGS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONWARNINGS</span></code></a> 环境变量来更轻松地控制警告，作为在命令行中使用 <code class="docutils literal notranslate"><span class="pre">-W</span></code> 的替代方案:</p>
<div class="translated highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONWARNINGS</span><span class="o">=</span><span class="s1">&#39;ignore::RuntimeWarning::,once::UnicodeWarning::&#39;</span>
</pre></div>
</div>
<p class="translated">（由Barry Warsaw建议，Philip Jenvey在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7301">bpo-7301</a> 中实现。）</p>
</li>
<li><p class="translated">新增了一个警告类别: <a class="reference internal" href="../library/exceptions.html#ResourceWarning" title="ResourceWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceWarning</span></code></a>。当检测到资源消耗或清理的潜在问题时会发出此警告。在正常发布版本中，该警告默认被禁用，但可以通过 <a class="reference internal" href="../library/warnings.html#module-warnings" title="warnings: Issue warning messages and control their disposition."><code class="xref py py-mod docutils literal notranslate"><span class="pre">warnings</span></code></a> 模块提供的方式或通过命令行启用。</p>
<p class="translated">如果在解释器关闭时 <a class="reference internal" href="../library/gc.html#gc.garbage" title="gc.garbage"><code class="xref py py-data docutils literal notranslate"><span class="pre">gc.garbage</span></code></a> 列表不为空，并且设置了 <a class="reference internal" href="../library/gc.html#gc.DEBUG_UNCOLLECTABLE" title="gc.DEBUG_UNCOLLECTABLE"><code class="xref py py-const docutils literal notranslate"><span class="pre">gc.DEBUG_UNCOLLECTABLE</span></code></a>，则会发出 <a class="reference internal" href="../library/exceptions.html#ResourceWarning" title="ResourceWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceWarning</span></code></a>，并打印所有不可收集的对象。这是为了提醒程序员他们的代码中存在对象终结问题。</p>
<p class="translated">当一个 <a class="reference internal" href="../glossary.html#term-file-object"><span class="xref std std-term">文件对象</span></a> 在没有显式关闭的情况下被销毁时，也会发出 <a class="reference internal" href="../library/exceptions.html#ResourceWarning" title="ResourceWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceWarning</span></code></a>。尽管此类对象的析构函数确保关闭底层的操作系统资源（通常是文件描述符），但对象释放的延迟可能导致各种问题，特别是在 Windows 系统下。以下是通过命令行启用该警告的示例：</p>
<div class="translated highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-q<span class="w"> </span>-Wdefault
<span class="go">&gt;&gt;&gt; f = open(&quot;foo&quot;, &quot;wb&quot;)</span>
<span class="go">&gt;&gt;&gt; del f</span>
<span class="go">__main__:1: ResourceWarning: unclosed file &lt;_io.BufferedWriter name=&#39;foo&#39;&gt;</span>
</pre></div>
</div>
<p class="translated">（由 Antoine Pitrou 和 Georg Brandl 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10093">bpo-10093</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=477863">bpo-477863</a> 中添加。）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../library/stdtypes.html#range" title="range"><code class="xref py py-class docutils literal notranslate"><span class="pre">range</span></code></a> 对象现在支持 <em>index</em> 和 <em>count</em> 方法。这是为了让更多对象完全实现 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Sequence" title="collections.abc.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.Sequence</span></code></a> <a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">抽象基类</span></a> 而进行的工作的一部分。因此，该语言将拥有更加统一的 API。此外，<a class="reference internal" href="../library/stdtypes.html#range" title="range"><code class="xref py py-class docutils literal notranslate"><span class="pre">range</span></code></a> 对象现在还支持切片操作和负数索引，即使这些索引的值大于 <a class="reference internal" href="../library/sys.html#sys.maxsize" title="sys.maxsize"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.maxsize</span></code></a>。这使得 <em>range</em> 与列表具有更好的互操作性：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="go">range(0, 10, 2)</span>
</pre></div>
</div>
<p class="translated">（由 Daniel Stutzbach 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9213">bpo-9213</a> 中贡献，由 Alexander Belopolsky 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2690">bpo-2690</a> 中贡献，由 Nick Coghlan 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10889">bpo-10889</a> 中贡献。）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../library/functions.html#callable" title="callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">callable()</span></code></a> 内置函数从 Py2.x 中恢复。它提供了一个简洁、可读的替代方案，用于在类似 <code class="docutils literal notranslate"><span class="pre">isinstance(x,</span> <span class="pre">collections.Callable)</span></code> 的表达式中使用 <a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">抽象基类</span></a>：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">callable</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">callable</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p class="translated">（参见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10518">bpo-10518</a>。）</p>
</li>
<li><p class="translated">Python 的导入机制现在可以加载路径名中包含非 ASCII 字符的目录中安装的模块。这解决了一个令人烦恼的问题，即用户主目录中包含非 ASCII 字符的用户名。</p></li>
</ul>
<blockquote>
<div><p class="translated">（需要 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9425">bpo-9425</a> 中做大量工作。）</p>
</div></blockquote>
</section>
<section id="new-improved-and-deprecated-modules">
<h2 class="translated">新增、改进和弃用的模块<a class="headerlink" href="#new-improved-and-deprecated-modules" title="Link to this heading">¶</a></h2>
<p class="translated">Python 标准库经过了大量的维护工作和质量改进。</p>
<p class="translated">Python 3.2 最重要的更新是：<a class="reference internal" href="../library/email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code></a> 包、<a class="reference internal" href="../library/mailbox.html#module-mailbox" title="mailbox: Manipulate mailboxes in various formats"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mailbox</span></code></a> 模块以及 <code class="xref py py-mod docutils literal notranslate"><span class="pre">nntplib</span></code> 模块现在能够正确支持 Python 3 的字节/文本模型。这是首次实现对混合编码邮件的正确处理。</p>
<p class="translated">在整个标准库中，对编码和文本与字节问题的关注更加细致。特别是，与操作系统的交互现在能够更好地使用 Windows MBCS 编码、区域感知编码或 UTF-8 交换非 ASCII 数据。</p>
<p class="translated">另一个重要的改进是大幅提升了 <em>SSL</em> 连接和安全证书的支持。</p>
<p class="translated">此外，更多的类现在实现了 <a class="reference internal" href="../glossary.html#term-context-manager"><span class="xref std std-term">上下文管理器</span></a>，以支持使用 <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 语句进行方便且可靠的资源清理。</p>
<section id="email">
<h3 class="translated">email<a class="headerlink" href="#email" title="Link to this heading">¶</a></h3>
<p class="translated">Python 3 中 <a class="reference internal" href="../library/email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code></a> 包的可用性已基本由 R. David Murray 的极大努力修复。问题在于电子邮件通常以 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 而不是 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 文本的形式读取和存储，并且单个电子邮件中可能包含多种编码。因此，必须扩展电子邮件包以解析和生成字节格式的电子邮件消息。</p>
<ul>
<li><p class="translated">新函数 <a class="reference internal" href="../library/email.parser.html#email.message_from_bytes" title="email.message_from_bytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">message_from_bytes()</span></code></a> 和 <a class="reference internal" href="../library/email.parser.html#email.message_from_binary_file" title="email.message_from_binary_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">message_from_binary_file()</span></code></a>，以及新类 <a class="reference internal" href="../library/email.parser.html#email.parser.BytesFeedParser" title="email.parser.BytesFeedParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">BytesFeedParser</span></code></a> 和 <a class="reference internal" href="../library/email.parser.html#email.parser.BytesParser" title="email.parser.BytesParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">BytesParser</span></code></a> 允许将二进制消息数据解析为模型对象。</p></li>
<li><p class="translated">给定模型的字节输入，<a class="reference internal" href="../library/email.compat32-message.html#email.message.Message.get_payload" title="email.message.Message.get_payload"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_payload()</span></code></a> 默认将解码具有 <em class="mailheader">Content-Transfer-Encoding</em> 为 <em>8bit</em> 的消息正文，使用 MIME 头中指定的字符集，并返回结果字符串。</p></li>
<li><p class="translated">给定模型的字节输入，<a class="reference internal" href="../library/email.generator.html#email.generator.Generator" title="email.generator.Generator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generator</span></code></a> 将把具有 <em class="mailheader">Content-Transfer-Encoding</em> 为 <em>8bit</em> 的消息正文转换为具有 <em>7bit</em> 的 <em class="mailheader">Content-Transfer-Encoding</em>。</p>
<p class="translated">包含未编码的非 ASCII 字节的邮件头，将被视为使用 <em>unknown-8bit</em> 字符集按照 <span class="target" id="index-41"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2047.html"><strong>RFC 2047</strong></a> 标准进行编码。</p>
</li>
<li><p class="translated">一个新的类 <a class="reference internal" href="../library/email.generator.html#email.generator.BytesGenerator" title="email.generator.BytesGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">BytesGenerator</span></code></a> 生成字节输出，保留输入中未更改的任何非 ASCII 数据，包括具有 <em class="mailheader">Content-Transfer-Encoding</em> 为 <em>8bit</em> 的消息正文。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/smtplib.html#module-smtplib" title="smtplib: SMTP protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">smtplib</span></code></a> 的 <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP" title="smtplib.SMTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTP</span></code></a> 类现在接受字节字符串作为 <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP.sendmail" title="smtplib.SMTP.sendmail"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sendmail()</span></code></a> 方法的 <em>msg</em> 参数，并且一个新的方法 <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP.send_message" title="smtplib.SMTP.send_message"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_message()</span></code></a> 接受一个 <a class="reference internal" href="../library/email.compat32-message.html#email.message.Message" title="email.message.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code></a> 对象，并可以可选地从对象中直接获取 <em>from_addr</em> 和 <em>to_addrs</em> 地址。</p></li>
</ul>
<p class="translated">（由 R. David Murray 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4661">bpo-4661</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10321">bpo-10321</a> 中提议并实现。）</p>
</section>
<section id="elementtree">
<h3 class="translated">elementtree<a class="headerlink" href="#elementtree" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/xml.etree.elementtree.html#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.ElementTree</span></code></a> 包及其 <code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.cElementTree</span></code> 对应版本已更新到 1.3。</p>
<p class="translated">新增了几个有用的函数和方法：</p>
<ul class="simple">
<li><p class="translated"><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.fromstringlist" title="xml.etree.ElementTree.fromstringlist"><code class="xref py py-func docutils literal notranslate"><span class="pre">xml.etree.ElementTree.fromstringlist()</span></code></a> 可根据一系列片段生成 XML 文档</p></li>
<li><p class="translated"><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.register_namespace" title="xml.etree.ElementTree.register_namespace"><code class="xref py py-func docutils literal notranslate"><span class="pre">xml.etree.ElementTree.register_namespace()</span></code></a> 用于注册全局命名空间前缀</p></li>
<li><p class="translated"><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.tostringlist" title="xml.etree.ElementTree.tostringlist"><code class="xref py py-func docutils literal notranslate"><span class="pre">xml.etree.ElementTree.tostringlist()</span></code></a> 用于字符串表示包括所有子列表</p></li>
<li><p class="translated"><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.extend" title="xml.etree.ElementTree.Element.extend"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.Element.extend()</span></code></a> 用于添加包含零个或多个元素的序列</p></li>
<li><p class="translated"><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.iterfind" title="xml.etree.ElementTree.Element.iterfind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.Element.iterfind()</span></code></a> 可搜索元素和子元素</p></li>
<li><p class="translated"><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.itertext" title="xml.etree.ElementTree.Element.itertext"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.Element.itertext()</span></code></a> 创建一个包含指定元素及其子元素的文本迭代器。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.TreeBuilder.end" title="xml.etree.ElementTree.TreeBuilder.end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.TreeBuilder.end()</span></code></a> 关闭当前元素</p></li>
<li><p class="translated"><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.TreeBuilder.doctype" title="xml.etree.ElementTree.TreeBuilder.doctype"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.TreeBuilder.doctype()</span></code></a> 处理 doctype 声明</p></li>
</ul>
<p class="translated">两个方法被弃用：</p>
<ul class="simple">
<li><p class="translated"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.getchildren()</span></code> 使用 <code class="docutils literal notranslate"><span class="pre">list(elem)</span></code> 代替。</p></li>
<li><p class="translated"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.getiterator()</span></code> 使用 <code class="docutils literal notranslate"><span class="pre">Element.iter</span></code> 代替。</p></li>
</ul>
<p class="translated">有关更新的详细信息，请参阅 Fredrik Lundh 网站上的 <a class="reference external" href="https://web.archive.org/web/20200703234532/http://effbot.org/zone/elementtree-13-intro.htm">Introducing ElementTree</a>。</p>
<p class="translated">（由 Florent Xicluna 和 Fredrik Lundh 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6472">bpo-6472</a> 中贡献。）</p>
</section>
<section id="functools">
<h3 class="translated">functools<a class="headerlink" href="#functools" title="Link to this heading">¶</a></h3>
<ul>
<li><p class="translated"><a class="reference internal" href="../library/functools.html#module-functools" title="functools: Higher-order functions and operations on callable objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">functools</span></code></a> 模块包含一个新的装饰器用于缓存函数调用。<a class="reference internal" href="../library/functools.html#functools.lru_cache" title="functools.lru_cache"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.lru_cache()</span></code></a> 可以在预期结果相同的情况下，保存对外部资源的重复查询。</p>
<p class="translated">例如，向数据库查询函数添加缓存装饰器可以节省热门搜索的数据库访问：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span><span class="w"> </span><span class="nf">get_phone_number</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">c</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT phonenumber FROM phonelist WHERE name=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,))</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">user_requests</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">get_phone_number</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>        <span class="c1"># cached lookup</span>
</pre></div>
</div>
<p class="translated">为了帮助选择有效的缓存大小，包装函数被用于跟踪缓存统计信息：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_phone_number</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span>
<span class="go">CacheInfo(hits=4805, misses=980, maxsize=300, currsize=300)</span>
</pre></div>
</div>
<p class="translated">如果 phonelist 表被更新，过时的缓存内容可以通过以下方式清除：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_phone_number</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
</pre></div>
</div>
<p class="translated">（由 Raymond Hettinger 贡献，并融合了 Jim Baker、Miki Tebeka 和 Nick Coghlan 的设计理念；参见 <a class="reference external" href="https://code.activestate.com/recipes/498245-lru-and-lfu-cache-decorators/">recipe 498245</a>、<a class="reference external" href="https://code.activestate.com/recipes/577479-simple-caching-decorator/">recipe 577479</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10586">bpo-10586</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10593">bpo-10593</a>。）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../library/functools.html#functools.wraps" title="functools.wraps"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.wraps()</span></code></a> 装饰器现在添加了一个指向原始可调用函数的 <code class="xref py py-attr docutils literal notranslate"><span class="pre">__wrapped__</span></code> 属性。这使得包装函数可以被内省。它还会复制定义的 <a class="reference internal" href="../reference/datamodel.html#function.__annotations__" title="function.__annotations__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__annotations__</span></code></a>。现在它也能优雅地跳过缺失的属性，如可能未为包装的可调用对象定义的 <a class="reference internal" href="../reference/datamodel.html#function.__doc__" title="function.__doc__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__doc__</span></code></a>。</p>
<p class="translated">在上面的例子中，可以通过恢复原始函数来移除缓存：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_phone_number</span> <span class="o">=</span> <span class="n">get_phone_number</span><span class="o">.</span><span class="n">__wrapped__</span>    <span class="c1"># uncached function</span>
</pre></div>
</div>
<p class="translated">（由 Nick Coghlan 和 Terrence Cole 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9567">bpo-9567</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=3445">bpo-3445</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8814">bpo-8814</a> 中贡献。)</p>
</li>
<li><p class="translated">为帮助编写具有丰富比较方法的类，新增的装饰器 <a class="reference internal" href="../library/functools.html#functools.total_ordering" title="functools.total_ordering"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.total_ordering()</span></code></a> 将使用现有的相等和不相等方法来填充其余的方法。</p>
<p class="translated">例如，提供 <em>__eq__</em> and <em>__lt__</em> 后， <a class="reference internal" href="../library/functools.html#functools.total_ordering" title="functools.total_ordering"><code class="xref py py-func docutils literal notranslate"><span class="pre">total_ordering()</span></code></a> 装饰器将自动补全 <em>__le__</em>, <em>__gt__</em> 和 <em>__ge__</em>:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@total_ordering</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lastname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstname</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">==</span>
                <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lastname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">firstname</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lastname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstname</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">&lt;</span>
                <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lastname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">firstname</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
</pre></div>
</div>
<p class="translated">使用 <em>total_ordering</em> 装饰器时，将会自动补全其余的比较方法。</p>
<p class="translated">（由 Raymond Hettinger 贡献。）</p>
</li>
<li><p class="translated">为帮助移植 Python 2 程序，<a class="reference internal" href="../library/functools.html#functools.cmp_to_key" title="functools.cmp_to_key"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.cmp_to_key()</span></code></a> 函数可将旧式的比较函数转换为新式的 <a class="reference internal" href="../glossary.html#term-key-function"><span class="xref std std-term">键函数</span></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># locale-aware sort order</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">strcoll</span><span class="p">))</span>
</pre></div>
</div>
<p class="translated">有关排序示例和简短的排序教程，请参阅 <a class="reference external" href="https://wiki.python.org/moin/HowTo/Sorting/">排序的技术</a> 教程。</p>
<p class="translated">（由 Raymond Hettinger 贡献。）</p>
</li>
</ul>
</section>
<section id="itertools">
<h3 class="translated">itertools<a class="headerlink" href="#itertools" title="Link to this heading">¶</a></h3>
<ul>
<li><p class="translated"><a class="reference internal" href="../library/itertools.html#module-itertools" title="itertools: Functions creating iterators for efficient looping."><code class="xref py py-mod docutils literal notranslate"><span class="pre">itertools</span></code></a> 模块有一个新的 <a class="reference internal" href="../library/itertools.html#itertools.accumulate" title="itertools.accumulate"><code class="xref py py-func docutils literal notranslate"><span class="pre">accumulate()</span></code></a> 函数，该函数模仿 APL 的 <em>scan</em> 运算符和 Numpy 的 <em>accumulate</em> 函数：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">accumulate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">accumulate</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">]))</span>
<span class="go">[8, 10, 60]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prob_dist</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">accumulate</span><span class="p">(</span><span class="n">prob_dist</span><span class="p">))</span>      <span class="c1"># cumulative probability distribution</span>
<span class="go">[0.1, 0.5, 0.7, 1.0]</span>
</pre></div>
</div>
<p class="translated">有关使用 <a class="reference internal" href="../library/itertools.html#itertools.accumulate" title="itertools.accumulate"><code class="xref py py-func docutils literal notranslate"><span class="pre">accumulate()</span></code></a> 的示例，请参阅 <a class="reference internal" href="../library/random.html#random-examples"><span class="std std-ref">random 模块的示例</span></a>。</p>
<p class="translated">（由 Raymond Hettinger 贡献，并融合了 Mark Dickinson 的设计建议。）</p>
</li>
</ul>
</section>
<section id="collections">
<h3 class="translated">collections<a class="headerlink" href="#collections" title="Link to this heading">¶</a></h3>
<ul>
<li><p class="translated"><a class="reference internal" href="../library/collections.html#collections.Counter" title="collections.Counter"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.Counter</span></code></a> 类现在支持两种形式的原地减法操作：现有的 <em>-=</em> 运算符实现的是 <a class="reference external" href="https://en.wikipedia.org/wiki/Saturation_arithmetic">饱和减法</a> (即结果不会低于零)，而新增的 <a class="reference internal" href="../library/collections.html#collections.Counter.subtract" title="collections.Counter.subtract"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subtract()</span></code></a> 方法则实现常规减法 (允许结果为负值)。前者适用于 <a class="reference external" href="https://en.wikipedia.org/wiki/Multiset">多重集</a> (仅包含正计数的场景)，后者更适合允许负计数的使用场景。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">dogs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span> <span class="o">-=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">dogs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>    <span class="c1"># saturating subtraction</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span>
<span class="go">Counter({&#39;dogs&#39;: 3})</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">dogs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">dogs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>      <span class="c1"># regular subtraction</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span>
<span class="go">Counter({&#39;dogs&#39;: 3, &#39;cats&#39;: -5})</span>
</pre></div>
</div>
<p class="translated">（由 Raymond Hettinger 贡献。）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.OrderedDict</span></code></a> 类有一个新方法 <a class="reference internal" href="../library/collections.html#collections.OrderedDict.move_to_end" title="collections.OrderedDict.move_to_end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">move_to_end()</span></code></a>，它接受一个现有的键并将其移动到有序序列的第一个或最后一个位置。</p>
<p class="translated">默认情况下，将项目移动到最后一个位置。这相当于用 <code class="docutils literal notranslate"><span class="pre">od[k]</span> <span class="pre">=</span> <span class="pre">od.pop(k)</span></code> 更新一个条目。</p>
<p class="translated">快速移动到末尾的操作对于重新排序条目很有用。例如，有序字典可以用来跟踪访问顺序，通过将条目从最旧的更新到最近访问的。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;X&#39;, &#39;d&#39;, &#39;e&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">move_to_end</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;d&#39;, &#39;e&#39;, &#39;X&#39;]</span>
</pre></div>
</div>
<p class="translated">（由 Raymond Hettinger 贡献。）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../library/collections.html#collections.deque" title="collections.deque"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.deque</span></code></a> 类新增了两个方法 <a class="reference internal" href="../library/collections.html#collections.deque.count" title="collections.deque.count"><code class="xref py py-meth docutils literal notranslate"><span class="pre">count()</span></code></a> 和 <a class="reference internal" href="../library/collections.html#collections.deque.reverse" title="collections.deque.reverse"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reverse()</span></code></a>，使它们更易于替代 <a class="reference internal" href="../library/stdtypes.html#list" title="list"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> 对象：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="s1">&#39;simsalabim&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">deque([&#39;m&#39;, &#39;i&#39;, &#39;b&#39;, &#39;a&#39;, &#39;l&#39;, &#39;a&#39;, &#39;s&#39;, &#39;m&#39;, &#39;i&#39;, &#39;s&#39;])</span>
</pre></div>
</div>
<p class="translated">（由 Raymond Hettinger 贡献。）</p>
</li>
</ul>
</section>
<section id="threading">
<h3 class="translated">threading<a class="headerlink" href="#threading" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/threading.html#module-threading" title="threading: Thread-based parallelism."><code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code></a> 模块有一个新的 <a class="reference internal" href="../library/threading.html#threading.Barrier" title="threading.Barrier"><code class="xref py py-class docutils literal notranslate"><span class="pre">Barrier</span></code></a> 同步类，用于使多个线程等待，直到它们都达到一个共同的屏障点。屏障对于确保具有多个先决条件的任务在所有前置任务完成之前不运行非常有用。</p>
<p class="translated">屏障可以与任意数量的线程一起工作。这是对仅适用于两个线程的 <a class="reference external" href="https://en.wikipedia.org/wiki/Synchronous_rendezvous">会合点</a> 的泛化。</p>
<p class="translated">作为两阶段循环屏障实现，<a class="reference internal" href="../library/threading.html#threading.Barrier" title="threading.Barrier"><code class="xref py py-class docutils literal notranslate"><span class="pre">Barrier</span></code></a> 对象适用于循环中使用。独立的 <em>填充</em> 和 <em>排空</em> 阶段确保所有线程在任何一个线程循环回并重新进入屏障之前都被释放（排空）。屏障在每个周期后完全重置。</p>
<p class="translated">使用屏障的示例：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="kn">import</span> <span class="n">Barrier</span><span class="p">,</span> <span class="n">Thread</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_votes</span><span class="p">(</span><span class="n">site</span><span class="p">):</span>
    <span class="n">ballots</span> <span class="o">=</span> <span class="n">conduct_election</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
    <span class="n">all_polls_closed</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>        <span class="c1"># 在所有投票站关闭之前不要计数</span>
    <span class="n">totals</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span><span class="n">ballots</span><span class="p">)</span>
    <span class="n">publish</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">totals</span><span class="p">)</span>

<span class="n">all_polls_closed</span> <span class="o">=</span> <span class="n">Barrier</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sites</span><span class="p">))</span>
<span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
    <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">get_votes</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">site</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p class="translated">在这个示例中，屏障强制执行一个规则，即在所有投票站关闭之前，任何投票站都不能计票。请注意，使用屏障的解决方案与使用 <a class="reference internal" href="../library/threading.html#threading.Thread.join" title="threading.Thread.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">threading.Thread.join()</span></code></a> 的解决方案类似，但线程在越过屏障点后仍然保持活动状态并继续工作（汇总选票）。</p>
<p class="translated">如果任何前置任务可能会挂起或延迟，可以创建一个带有可选 <em>timeout</em> 参数的屏障。然后，如果在超时期限内所有前置任务都没有到达屏障点，所有等待的线程将被释放，并引发 <a class="reference internal" href="../library/threading.html#threading.BrokenBarrierError" title="threading.BrokenBarrierError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BrokenBarrierError</span></code></a> 异常：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_votes</span><span class="p">(</span><span class="n">site</span><span class="p">):</span>
    <span class="n">ballots</span> <span class="o">=</span> <span class="n">conduct_election</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">all_polls_closed</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">midnight</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">BrokenBarrierError</span><span class="p">:</span>
        <span class="n">lockbox</span> <span class="o">=</span> <span class="n">seal_ballots</span><span class="p">(</span><span class="n">ballots</span><span class="p">)</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">lockbox</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">totals</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span><span class="n">ballots</span><span class="p">)</span>
        <span class="n">publish</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">totals</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">在这个示例中，屏障执行了一个更健壮的规则。如果某些选举站在午夜前没有完成，屏障将超时，选票将被封存并放入队列中以供后续处理。</p>
<p class="translated">请参阅 <a class="reference external" href="https://osl.cs.illinois.edu/media/papers/karmani-2009-barrier_synchronization_pattern.pdf">屏障同步模式</a> 了解更多关于如何在并行计算中使用屏障的示例。此外，在 <a class="reference external" href="https://greenteapress.com/semaphores/LittleBookOfSemaphores.pdf">信号量小册子</a> 的 <em>第3.6节</em> 中也有一个简单但详尽的屏障解释。</p>
<p class="translated">（由 Kristján Valur Jónsson 贡献，并由 Jeffrey Yasskin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8777">bpo-8777</a> 中进行 API 审查。）</p>
</section>
<section id="datetime-and-time">
<h3 class="translated">datetime 和 time<a class="headerlink" href="#datetime-and-time" title="Link to this heading">¶</a></h3>
<ul>
<li><p class="translated"><a class="reference internal" href="../library/datetime.html#module-datetime" title="datetime: Basic date and time types."><code class="xref py py-mod docutils literal notranslate"><span class="pre">datetime</span></code></a> 模块新增了一种类型 <a class="reference internal" href="../library/datetime.html#datetime.timezone" title="datetime.timezone"><code class="xref py py-class docutils literal notranslate"><span class="pre">timezone</span></code></a>，它通过返回固定的 UTC 偏移量和时区名称来实现 <a class="reference internal" href="../library/datetime.html#datetime.tzinfo" title="datetime.tzinfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">tzinfo</span></code></a> 接口。这使得创建带有时区信息的 datetime 对象变得更加容易:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<span class="go">datetime.datetime(2010, 12, 8, 21, 4, 2, 923754, tzinfo=datetime.timezone.utc)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;01/01/2000 12:00 +0000&quot;</span><span class="p">,</span> <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y %H:%M %z&quot;</span><span class="p">)</span>
<span class="go">datetime.datetime(2000, 1, 1, 12, 0, tzinfo=datetime.timezone.utc)</span>
</pre></div>
</div>
</li>
<li><p class="translated">此外，<a class="reference internal" href="../library/datetime.html#datetime.timedelta" title="datetime.timedelta"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> 对象现在可以与 <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> 相乘，并且可以被 <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> 和 <a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> 对象除。同时，<a class="reference internal" href="../library/datetime.html#datetime.timedelta" title="datetime.timedelta"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> 对象现在可以相互除。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/datetime.html#datetime.date.strftime" title="datetime.date.strftime"><code class="xref py py-meth docutils literal notranslate"><span class="pre">datetime.date.strftime()</span></code></a> 方法不再限制于 1900 年之后的年份。新的支持年份范围是从 1000 年到 9999 年（含）。</p></li>
<li><p class="translated">每当在时间元组中使用两位数年份时，其解释由 <code class="xref py py-data docutils literal notranslate"><span class="pre">time.accept2dyear</span></code> 控制。默认值为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，这意味着对于两位数年份，世纪是根据 POSIX 规则（管理 <code class="docutils literal notranslate"><span class="pre">%y</span></code> strptime 格式）进行猜测的。</p>
<p class="translated">从 Py3.2 开始，使用世纪猜测启发式方法将发出 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> 警告。建议将 <code class="xref py py-data docutils literal notranslate"><span class="pre">time.accept2dyear</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，以便在没有猜测的情况下使用大的日期范围:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span><span class="o">,</span><span class="w"> </span><span class="nn">warnings</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">warnings</span><span class="o">.</span><span class="n">resetwarnings</span><span class="p">()</span>      <span class="c1"># 移除默认的警告过滤器</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">accept2dyear</span> <span class="o">=</span> <span class="kc">True</span>      <span class="c1"># 猜测 11 是指 11 还是 2011</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">((</span><span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="go">Warning (from warnings module):</span>
<span class="go">  ...</span>
<span class="go">DeprecationWarning: Century info guessed for a 2-digit year.</span>
<span class="go">&#39;Fri Jan  1 12:34:56 2011&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">accept2dyear</span> <span class="o">=</span> <span class="kc">False</span>     <span class="c1"># 使用允许的完整日期范围</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">((</span><span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="go">&#39;Fri Jan  1 12:34:56 11&#39;</span>
</pre></div>
</div>
<p class="translated">多个函数的日期范围已显著扩展。当 <code class="xref py py-data docutils literal notranslate"><span class="pre">time.accept2dyear</span></code> 为假时，<a class="reference internal" href="../library/time.html#time.asctime" title="time.asctime"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.asctime()</span></code></a> 函数将接受任何适合 C int 类型的年份，而 <a class="reference internal" href="../library/time.html#time.mktime" title="time.mktime"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.mktime()</span></code></a> 和 <a class="reference internal" href="../library/time.html#time.strftime" title="time.strftime"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.strftime()</span></code></a> 函数将接受相应操作系统函数支持的全部范围。</p>
</li>
</ul>
<p class="translated">（由 Alexander Belopolsky 和 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1289118">bpo-1289118</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5094">bpo-5094</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6641">bpo-6641</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2706">bpo-2706</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1777412">bpo-1777412</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8013">bpo-8013</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10827">bpo-10827</a> 中贡献。）</p>
</section>
<section id="math">
<h3 class="translated">math<a class="headerlink" href="#math" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/math.html#module-math" title="math: Mathematical functions (sin() etc.)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">math</span></code></a> 模块已更新，新增了六个借鉴自 C99 标准的函数。</p>
<p class="translated"><a class="reference internal" href="../library/math.html#math.isfinite" title="math.isfinite"><code class="xref py py-func docutils literal notranslate"><span class="pre">isfinite()</span></code></a> 函数提供了一种可靠且快速的方法来检测特殊值。它对常规数字返回 <code class="docutils literal notranslate"><span class="pre">True</span></code>，对 <em>Nan</em> 或 <em>Infinity</em> 返回 <code class="docutils literal notranslate"><span class="pre">False</span></code>：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">isfinite</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mf">4.56</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;Nan&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;Inf&#39;</span><span class="p">))]</span>
<span class="go">[True, True, False, False]</span>
</pre></div>
</div>
<p class="translated"><a class="reference internal" href="../library/math.html#math.expm1" title="math.expm1"><code class="xref py py-func docutils literal notranslate"><span class="pre">expm1()</span></code></a> 函数用于计算 <code class="docutils literal notranslate"><span class="pre">e**x</span> <span class="pre">-</span> <span class="pre">1</span></code> (其中 <em>x</em> 为较小数值)，且不会产生因相减两个近似相等数值而导致精度损失的问题。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">expm1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expm1</span><span class="p">(</span><span class="mf">0.013671875</span><span class="p">)</span>   <span class="c1"># more accurate way to compute e**x-1 for a small x</span>
<span class="go">0.013765762467652909</span>
</pre></div>
</div>
<p class="translated"><a class="reference internal" href="../library/math.html#math.erf" title="math.erf"><code class="xref py py-func docutils literal notranslate"><span class="pre">erf()</span></code></a> 函数计算概率积分或 <a class="reference external" href="https://en.wikipedia.org/wiki/Error_function">高斯误差函数</a>。其互补误差函数 <a class="reference internal" href="../library/math.html#math.erfc" title="math.erfc"><code class="xref py py-func docutils literal notranslate"><span class="pre">erfc()</span></code></a> 的计算公式为 <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">-</span> <span class="pre">erf(x)</span></code>：</p>
<div class="translated highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">erf</span><span class="p">,</span> <span class="n">erfc</span><span class="p">,</span> <span class="n">sqrt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">erf</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>   <span class="c1"># 在 1 个标准差内的正态分布部分</span>
<span class="go">0.682689492137086</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">erfc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>  <span class="c1"># 在 1 个标准差外的正态分布部分</span>
<span class="go">0.31731050786291404</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">erf</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">erfc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="go">1.0</span>
</pre></div>
</div>
<p class="translated"><a class="reference internal" href="../library/math.html#math.gamma" title="math.gamma"><code class="xref py py-func docutils literal notranslate"><span class="pre">gamma()</span></code></a> 函数是阶乘函数的连续扩展。详情请见 <a class="reference external" href="https://en.wikipedia.org/wiki/Gamma_function">https://en.wikipedia.org/wiki/Gamma_function</a>。由于该函数与阶乘相关，即使对于小的 <em>x</em> 值，其值也会变得很大，因此还有一个 <a class="reference internal" href="../library/math.html#math.lgamma" title="math.lgamma"><code class="xref py py-func docutils literal notranslate"><span class="pre">lgamma()</span></code></a> 函数用于计算伽马函数的自然对数：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">lgamma</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gamma</span><span class="p">(</span><span class="mf">7.0</span><span class="p">)</span>           <span class="c1"># six factorial</span>
<span class="go">720.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lgamma</span><span class="p">(</span><span class="mf">801.0</span><span class="p">)</span>        <span class="c1"># log(800 factorial)</span>
<span class="go">4551.950730698041</span>
</pre></div>
</div>
<p class="translated">（由 Mark Dickinson 贡献）</p>
</section>
<section id="abc">
<h3 class="translated">abc(抽象基类)<a class="headerlink" href="#abc" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/abc.html#module-abc" title="abc: Abstract base classes according to :pep:`3119`."><code class="xref py py-mod docutils literal notranslate"><span class="pre">abc</span></code></a> 模块现在支持 <a class="reference internal" href="../library/abc.html#abc.abstractclassmethod" title="abc.abstractclassmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">abstractclassmethod()</span></code></a> 和 <a class="reference internal" href="../library/abc.html#abc.abstractstaticmethod" title="abc.abstractstaticmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">abstractstaticmethod()</span></code></a>。</p>
<p class="translated">这些工具使得可以定义一个要求实现特定 <a class="reference internal" href="../library/functions.html#classmethod" title="classmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">classmethod()</span></code></a> 或 <a class="reference internal" href="../library/functions.html#staticmethod" title="staticmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">staticmethod()</span></code></a> 的 <a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">抽象基类</span></a>：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Temperature</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractclassmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_fahrenheit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractclassmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_celsius</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p class="translated">（补丁由 Daniel Urban 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5867">bpo-5867</a> 中提交。）</p>
</section>
<section id="io">
<h3 class="translated">io<a class="headerlink" href="#io" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/io.html#io.BytesIO" title="io.BytesIO"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.BytesIO</span></code></a> 类新增了一个方法 <a class="reference internal" href="../library/io.html#io.BytesIO.getbuffer" title="io.BytesIO.getbuffer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getbuffer()</span></code></a>，其功能类似于 <a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><code class="xref py py-func docutils literal notranslate"><span class="pre">memoryview()</span></code></a>。该方法会创建一个数据的可编辑视图，且不会生成数据的副本。该缓冲区支持随机访问和切片表示法，非常适合进行原地编辑操作:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">REC_LEN</span><span class="p">,</span> <span class="n">LOC_START</span><span class="p">,</span> <span class="n">LOC_LEN</span> <span class="o">=</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">change_location</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">record_number</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">start</span> <span class="o">=</span> <span class="n">record_number</span> <span class="o">*</span> <span class="n">REC_LEN</span> <span class="o">+</span> <span class="n">LOC_START</span>
<span class="gp">... </span>    <span class="n">buffer</span><span class="p">[</span><span class="n">start</span><span class="p">:</span> <span class="n">start</span><span class="o">+</span><span class="n">LOC_LEN</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">byte_stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span>
<span class="gp">... </span>    <span class="sa">b</span><span class="s1">&#39;G3805  storeroom  Main chassis    &#39;</span>
<span class="gp">... </span>    <span class="sa">b</span><span class="s1">&#39;X7899  shipping   Reserve cog     &#39;</span>
<span class="gp">... </span>    <span class="sa">b</span><span class="s1">&#39;L6988  receiving  Primary sprocket&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">buffer</span> <span class="o">=</span> <span class="n">byte_stream</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">change_location</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;warehouse  &#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">change_location</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;showroom   &#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">byte_stream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
<span class="go">b&#39;G3805  showroom   Main chassis    &#39;</span>
<span class="go">b&#39;X7899  warehouse  Reserve cog     &#39;</span>
<span class="go">b&#39;L6988  receiving  Primary sprocket&#39;</span>
</pre></div>
</div>
<p class="translated">（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5506">bpo-5506</a> 中贡献。）</p>
</section>
<section id="reprlib">
<h3 class="translated">reprlib<a class="headerlink" href="#reprlib" title="Link to this heading">¶</a></h3>
<p class="translated">在为自定义容器编写 <a class="reference internal" href="../reference/datamodel.html#object.__repr__" title="object.__repr__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__repr__()</span></code></a> 方法时，很容易忘记处理成员引用容器自身的情况。Python的内置对象如 <a class="reference internal" href="../library/stdtypes.html#list" title="list"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> 通过在表示字符串的递归部分显示 &quot;...&quot; 来处理自引用。</p>
<p class="translated">为了帮助编写此类 <a class="reference internal" href="../reference/datamodel.html#object.__repr__" title="object.__repr__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__repr__()</span></code></a> 方法，<a class="reference internal" href="../library/reprlib.html#module-reprlib" title="reprlib: Alternate repr() implementation with size limits."><code class="xref py py-mod docutils literal notranslate"><span class="pre">reprlib</span></code></a> 模块新增了一个装饰器 <a class="reference internal" href="../library/reprlib.html#reprlib.recursive_repr" title="reprlib.recursive_repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">recursive_repr()</span></code></a>，用于检测对 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__repr__()</span></code> 的递归调用并替换为占位符字符串:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">MyList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@recursive_repr</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">MyList</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">&lt;&#39;a&#39;|&#39;b&#39;|&#39;c&#39;|...|&#39;x&#39;&gt;</span>
</pre></div>
</div>
<p class="translated">（由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9826">bpo-9826</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9840">bpo-9840</a> 中贡献。）</p>
</section>
<section id="logging">
<h3 class="translated">logging<a class="headerlink" href="#logging" title="Link to this heading">¶</a></h3>
<p class="translated">除了上述基于字典的配置外，<a class="reference internal" href="../library/logging.html#module-logging" title="logging: Flexible event logging system for applications."><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> 包还有许多其他改进。</p>
<p class="translated">日志模块的文档已新增一份 <a class="reference internal" href="../howto/logging.html#logging-basic-tutorial"><span class="std std-ref">基础教程</span></a>、一份 <a class="reference internal" href="../howto/logging.html#logging-advanced-tutorial"><span class="std std-ref">高级教程</span></a> 以及一份包含日志实践案例的 <a class="reference internal" href="../howto/logging-cookbook.html#logging-cookbook"><span class="std std-ref">指南</span></a>。这些文档是学习日志功能的最佳途径。</p>
<p class="translated"><a class="reference internal" href="../library/logging.html#logging.basicConfig" title="logging.basicConfig"><code class="xref py py-func docutils literal notranslate"><span class="pre">logging.basicConfig()</span></code></a> 配置函数新增了一个 <em>style</em> 参数，用于支持三种不同的字符串格式化方式。该参数默认值为 &quot;%&quot;，表示传统的 %-格式化；可设置为 &quot;{&quot;，采用新的 <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> 格式化风格；也可设置为 &quot;$&quot;，使用 <a class="reference internal" href="../library/string.html#string.Template" title="string.Template"><code class="xref py py-class docutils literal notranslate"><span class="pre">string.Template</span></code></a> 提供的类 shell 风格格式化。以下三种配置方式是等效的:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">basicConfig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">basicConfig</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(name)s</span><span class="s2"> -&gt; </span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">basicConfig</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> -&gt; </span><span class="si">{levelname}</span><span class="s2"> </span><span class="si">{message}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">basicConfig</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;$name -&gt; $levelname: $message&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">如果在日志事件发生之前没有进行配置，现在将使用默认配置，该配置使用 <a class="reference internal" href="../library/logging.handlers.html#logging.StreamHandler" title="logging.StreamHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamHandler</span></code></a> 将 <code class="docutils literal notranslate"><span class="pre">WARNING</span></code> 级别或更高的事件定向到 <a class="reference internal" href="../library/sys.html#sys.stderr" title="sys.stderr"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stderr</span></code></a>。以前，在配置设置之前发生的事件要么抛出异常，要么根据 <a class="reference internal" href="../library/logging.html#logging.raiseExceptions" title="logging.raiseExceptions"><code class="xref py py-data docutils literal notranslate"><span class="pre">logging.raiseExceptions</span></code></a> 的值静默丢弃事件。新的默认处理程序存储在 <a class="reference internal" href="../library/logging.html#logging.lastResort" title="logging.lastResort"><code class="xref py py-data docutils literal notranslate"><span class="pre">logging.lastResort</span></code></a> 中。</p>
<p class="translated">过滤器的使用已经简化。现在不再需要创建 <a class="reference internal" href="../library/logging.html#logging.Filter" title="logging.Filter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Filter</span></code></a> 对象，谓词可以是任何返回 <code class="docutils literal notranslate"><span class="pre">True</span></code> 或 <code class="docutils literal notranslate"><span class="pre">False</span></code> 的 Python 可调用对象。</p>
<p class="translated">还有许多其他改进，增加了灵活性并简化了配置。请参阅模块文档，了解 Python 3.2 中所有更改的完整列表。</p>
</section>
<section id="csv">
<h3 class="translated">csv<a class="headerlink" href="#csv" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/csv.html#module-csv" title="csv: Write and read tabular data to and from delimited files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">csv</span></code></a> 模块现在支持一个新的方言，<a class="reference internal" href="../library/csv.html#csv.unix_dialect" title="csv.unix_dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">unix_dialect</span></code></a>，它对所有字段应用引号，并使用传统的 Unix 风格，以 <code class="docutils literal notranslate"><span class="pre">'\n'</span></code> 作为行终止符。注册的方言名称为 <code class="docutils literal notranslate"><span class="pre">unix</span></code>。</p>
<p class="translated"><a class="reference internal" href="../library/csv.html#csv.DictWriter" title="csv.DictWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">csv.DictWriter</span></code></a> 有一个新的 <a class="reference internal" href="../library/csv.html#csv.DictWriter.writeheader" title="csv.DictWriter.writeheader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">writeheader()</span></code></a> 方法，用于写入初始行以记录字段名称:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span><span class="o">,</span><span class="w"> </span><span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;dept&#39;</span><span class="p">],</span> <span class="n">dialect</span><span class="o">=</span><span class="s1">&#39;unix&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
<span class="go">&quot;name&quot;,&quot;dept&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">writerows</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tom&#39;</span><span class="p">,</span> <span class="s1">&#39;dept&#39;</span><span class="p">:</span> <span class="s1">&#39;accounting&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;susan&#39;</span><span class="p">,</span> <span class="s1">&#39;dept&#39;</span><span class="p">:</span> <span class="s1">&#39;Salesl&#39;</span><span class="p">}])</span>
<span class="go">&quot;tom&quot;,&quot;accounting&quot;</span>
<span class="go">&quot;susan&quot;,&quot;sales&quot;</span>
</pre></div>
</div>
<p class="translated">（新方言由 Jay Talbot 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5975">bpo-5975</a> 中建议，新方法由 Ed Abraham 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1537721">bpo-1537721</a> 中建议。）</p>
</section>
<section id="contextlib">
<h3 class="translated">contextlib<a class="headerlink" href="#contextlib" title="Link to this heading">¶</a></h3>
<p class="translated">有一个新的且略显震撼的工具 <a class="reference internal" href="../library/contextlib.html#contextlib.ContextDecorator" title="contextlib.ContextDecorator"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContextDecorator</span></code></a>，它有助于创建一个既可以作为函数装饰器又可以作为 <a class="reference internal" href="../glossary.html#term-context-manager"><span class="xref std std-term">上下文管理器</span></a> 的双重用途的上下文管理器。</p>
<p class="translated">为了方便起见，这一新功能被 <a class="reference internal" href="../library/contextlib.html#contextlib.contextmanager" title="contextlib.contextmanager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contextmanager()</span></code></a> 使用，因此无需额外努力即可支持这两种角色。</p>
<p class="translated">基本思想是，上下文管理器和函数装饰器都可以用于前置动作和后置动作的包装器。上下文管理器使用 <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 语句包装一组语句，而函数装饰器包装一个函数内的一组语句。因此，有时需要编写一个可以在任一角色中使用的前置动作或后置动作包装器。</p>
<p class="translated">例如，有时需要用一个日志记录器包装函数或一组语句，以跟踪进入和退出时间。与其为该任务编写一个函数装饰器和一个上下文管理器，不如使用 <a class="reference internal" href="../library/contextlib.html#contextlib.contextmanager" title="contextlib.contextmanager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contextmanager()</span></code></a> 在单一定义中提供这两种能力:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">track_entry_and_exit</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Entering: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Exiting: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">以前，这只能用作上下文管理器:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">track_entry_and_exit</span><span class="p">(</span><span class="s1">&#39;widget loader&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Some time consuming activity goes here&#39;</span><span class="p">)</span>
    <span class="n">load_widget</span><span class="p">()</span>
</pre></div>
</div>
<p class="translated">现在，它也可以用作装饰器:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@track_entry_and_exit</span><span class="p">(</span><span class="s1">&#39;widget loader&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">activity</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Some time consuming activity goes here&#39;</span><span class="p">)</span>
    <span class="n">load_widget</span><span class="p">()</span>
</pre></div>
</div>
<p class="translated">试图同时满足两种角色对技术有一些限制。上下文管理器通常具有返回一个可被 <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 语句使用的参数的灵活性，但函数装饰器没有类似的特性。</p>
<p class="translated">在上面的示例中，<em>track_entry_and_exit</em> 上下文管理器没有一种简洁的方式来返回一个日志实例，以供封闭语句体中使用。</p>
<p class="translated">（由 Michael Foord 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9110">bpo-9110</a> 中贡献。）</p>
</section>
<section id="decimal-and-fractions">
<h3 class="translated">decimal 和 fractions<a class="headerlink" href="#decimal-and-fractions" title="Link to this heading">¶</a></h3>
<p class="translated">Mark Dickinson 设计了一个优雅且高效的方案，确保不同数值数据类型在实际值相等时具有相同的哈希值（<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8188">bpo-8188</a>）:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">hash</span><span class="p">(</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span> <span class="o">==</span> \
       <span class="nb">hash</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;1.5&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p class="translated">一些哈希细节通过新的属性 <a class="reference internal" href="../library/sys.html#sys.hash_info" title="sys.hash_info"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.hash_info</span></code></a> 公开，该属性描述了哈希值的位宽、素数模数、<em>infinity</em> 和 <em>nan</em> 的哈希值，以及用于数字虚部的乘数：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">hash_info</span>
<span class="go">sys.hash_info(width=64, modulus=2305843009213693951, inf=314159, nan=0, imag=1000003)</span>
</pre></div>
</div>
<p class="translated">早期限制各种数值类型互操作性的决定已经放宽。仍然不支持（也不建议）在算术表达式中隐式混合使用，例如 <code class="docutils literal notranslate"><span class="pre">Decimal('1.1')</span> <span class="pre">+</span> <span class="pre">float('1.1')</span></code>，因为后者在构建二进制浮点数的过程中会丢失信息。然而，由于现有的浮点值可以无损地转换为十进制或分数表示，因此将其添加到构造函数并支持混合类型比较是有意义的。</p>
<ul class="simple">
<li><p class="translated"><a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal notranslate"><span class="pre">decimal.Decimal</span></code></a> 构造函数现在直接接受 <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> 对象，因此不再需要使用 <a class="reference internal" href="../library/decimal.html#decimal.Decimal.from_float" title="decimal.Decimal.from_float"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_float()</span></code></a> 方法（<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8257">bpo-8257</a>）。</p></li>
<li><p class="translated">现在完全支持混合类型比较，以便 <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decimal</span></code></a> 对象可以直接与 <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> 和 <a class="reference internal" href="../library/fractions.html#fractions.Fraction" title="fractions.Fraction"><code class="xref py py-class docutils literal notranslate"><span class="pre">fractions.Fraction</span></code></a> 进行比较（<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2531">bpo-2531</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8188">bpo-8188</a>）。</p></li>
</ul>
<p class="translated">对 <a class="reference internal" href="../library/fractions.html#fractions.Fraction" title="fractions.Fraction"><code class="xref py py-class docutils literal notranslate"><span class="pre">fractions.Fraction</span></code></a> 也进行了类似的更改，因此不再需要 <a class="reference internal" href="../library/fractions.html#fractions.Fraction.from_float" title="fractions.Fraction.from_float"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_float()</span></code></a> 和 <a class="reference internal" href="../library/fractions.html#fractions.Fraction.from_decimal" title="fractions.Fraction.from_decimal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_decimal()</span></code></a> 方法（<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8294">bpo-8294</a>）：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">fractions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fraction</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span>
<span class="go">Decimal(&#39;1.100000000000000088817841970012523233890533447265625&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Fraction</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span>
<span class="go">Fraction(2476979795053773, 2251799813685248)</span>
</pre></div>
</div>
<p class="translated"><a class="reference internal" href="../library/decimal.html#module-decimal" title="decimal: Implementation of the General Decimal Arithmetic Specification."><code class="xref py py-mod docutils literal notranslate"><span class="pre">decimal</span></code></a> 模块的一个有用改动是，<a class="reference internal" href="../library/decimal.html#decimal.Context.clamp" title="decimal.Context.clamp"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Context.clamp</span></code></a> 属性现在变为公开。这在创建与 IEEE 754 指定的十进制交换格式相对应的上下文时非常有用（参见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8540">bpo-8540</a>）。</p>
<p class="translated">（由 Mark Dickinson 和 Raymond Hettinger贡献。）</p>
</section>
<section id="ftp">
<h3 class="translated">ftp<a class="headerlink" href="#ftp" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/ftplib.html#ftplib.FTP" title="ftplib.FTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">ftplib.FTP</span></code></a> 类现在支持上下文管理协议，可以无条件地捕获 <a class="reference internal" href="../library/socket.html#socket.error" title="socket.error"><code class="xref py py-exc docutils literal notranslate"><span class="pre">socket.error</span></code></a> 异常，并在完成操作时关闭 FTP 连接：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">ftplib</span><span class="w"> </span><span class="kn">import</span> <span class="n">FTP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">FTP</span><span class="p">(</span><span class="s2">&quot;ftp1.at.proftpd.org&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ftp</span><span class="p">:</span>
<span class="go">        ftp.login()</span>
<span class="go">        ftp.dir()</span>

<span class="go">&#39;230 Anonymous login ok, restrictions apply.&#39;</span>
<span class="go">dr-xr-xr-x   9 ftp      ftp           154 May  6 10:43 .</span>
<span class="go">dr-xr-xr-x   9 ftp      ftp           154 May  6 10:43 ..</span>
<span class="go">dr-xr-xr-x   5 ftp      ftp          4096 May  6 10:43 CentOS</span>
<span class="go">dr-xr-xr-x   3 ftp      ftp            18 Jul 10  2008 Fedora</span>
</pre></div>
</div>
<p class="translated">其他文件型对象如 <a class="reference internal" href="../library/mmap.html#mmap.mmap" title="mmap.mmap"><code class="xref py py-class docutils literal notranslate"><span class="pre">mmap.mmap</span></code></a> 和 <a class="reference internal" href="../library/fileinput.html#fileinput.input" title="fileinput.input"><code class="xref py py-func docutils literal notranslate"><span class="pre">fileinput.input()</span></code></a> 也有了支持自动关闭的上下文管理器:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;log1.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;log2.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">（由 Tarek Ziadé 和 Giampaolo Rodolà 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4972">bpo-4972</a> 贡献，由 Georg Brandl 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8046">bpo-8046</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1286">bpo-1286</a> 贡献。）</p>
<p class="translated"><a class="reference internal" href="../library/ftplib.html#ftplib.FTP_TLS" title="ftplib.FTP_TLS"><code class="xref py py-class docutils literal notranslate"><span class="pre">FTP_TLS</span></code></a> 类现在接受一个 <em>context</em> 参数，这是一个 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext" title="ssl.SSLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> 对象，允许将 SSL 配置选项、证书和私钥捆绑到一个单一的（可能是长寿命的）结构体中。</p>
<p class="translated">（由 Giampaolo Rodolà 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8806">bpo-8806</a> 中贡献。）</p>
</section>
<section id="popen">
<h3 class="translated">popen<a class="headerlink" href="#popen" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/os.html#os.popen" title="os.popen"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.popen()</span></code></a> 和 <a class="reference internal" href="../library/subprocess.html#subprocess.Popen" title="subprocess.Popen"><code class="xref py py-func docutils literal notranslate"><span class="pre">subprocess.Popen()</span></code></a> 函数现在支持使用 <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 语句来自动关闭文件描述符。</p>
<p class="translated">（由 Antoine Pitrou 和 Brian Curtin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7461">bpo-7461</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10554">bpo-10554</a> 中贡献。）</p>
</section>
<section id="select">
<h3 class="translated">select<a class="headerlink" href="#select" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/select.html#module-select" title="select: Wait for I/O completion on multiple streams."><code class="xref py py-mod docutils literal notranslate"><span class="pre">select</span></code></a> 模块现在暴露了一个新的常量属性，<a class="reference internal" href="../library/select.html#select.PIPE_BUF" title="select.PIPE_BUF"><code class="xref py py-const docutils literal notranslate"><span class="pre">PIPE_BUF</span></code></a>，它给出了在 <a class="reference internal" href="../library/select.html#select.select" title="select.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select.select()</span></code></a> 表示管道准备好写入时，保证不会阻塞的最小字节数。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">select</span><span class="o">.</span><span class="n">PIPE_BUF</span>
<span class="go">512</span>
</pre></div>
</div>
<p class="translated">（在 Unix 系统上可用。 由 Sébastien Sablé 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9862">bpo-9862</a> 中提供补丁）</p>
</section>
<section id="gzip-and-zipfile">
<h3 class="translated">gzip 和 zipfile<a class="headerlink" href="#gzip-and-zipfile" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/gzip.html#gzip.GzipFile" title="gzip.GzipFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">gzip.GzipFile</span></code></a> 现在实现了 <a class="reference internal" href="../library/io.html#io.BufferedIOBase" title="io.BufferedIOBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.BufferedIOBase</span></code></a> <a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">抽象基类</span></a> (除了 <code class="docutils literal notranslate"><span class="pre">truncate()</span></code>)。它还有一个 <a class="reference internal" href="../library/gzip.html#gzip.GzipFile.peek" title="gzip.GzipFile.peek"><code class="xref py py-meth docutils literal notranslate"><span class="pre">peek()</span></code></a> 方法，并支持不可 seek 的以及零填充的文件对象。</p>
<p class="translated"><a class="reference internal" href="../library/gzip.html#module-gzip" title="gzip: Interfaces for gzip compression and decompression using file objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">gzip</span></code></a> 模块还增加了 <a class="reference internal" href="../library/gzip.html#gzip.compress" title="gzip.compress"><code class="xref py py-func docutils literal notranslate"><span class="pre">compress()</span></code></a> 和 <a class="reference internal" href="../library/gzip.html#gzip.decompress" title="gzip.decompress"><code class="xref py py-func docutils literal notranslate"><span class="pre">decompress()</span></code></a> 函数，以便更容易地进行内存中的压缩和解压缩。请记住，文本在压缩和解压缩之前需要编码为 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">gzip</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Three shall be the number thou shalt count, &#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;and the number of the counting shall be three&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>                        <span class="c1"># convert to utf-8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">89</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">77</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gzip</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()[:</span><span class="mi">42</span><span class="p">]</span>      <span class="c1"># decompress and convert to text</span>
<span class="go">&#39;Three shall be the number thou shalt count&#39;</span>
</pre></div>
</div>
<p class="translated">（由 Anand B. Pillai 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=3488">bpo-3488</a> 中贡献，由 Antoine Pitrou、 Nir Aides 和 Brian Curtin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9962">bpo-9962</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1675951">bpo-1675951</a> 、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7471">bpo-7471</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2846">bpo-2846</a> 中贡献。）</p>
<p class="translated">此外，<a class="reference internal" href="../library/zipfile.html#zipfile.ZipFile.open" title="zipfile.ZipFile.open"><code class="xref py py-class docutils literal notranslate"><span class="pre">zipfile.ZipExtFile</span></code></a> 类在内部进行了重新设计，以表示存储在存档中的文件。新的实现显著更快，并且可以包装在 <a class="reference internal" href="../library/io.html#io.BufferedReader" title="io.BufferedReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.BufferedReader</span></code></a> 对象中以进一步提升速度。它还解决了交替调用 <em>read</em> 和 <em>readline</em> 导致结果错误的问题。</p>
<p class="translated">（补丁由 Nir Aides 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7610">bpo-7610</a> 中提交。）</p>
</section>
<section id="tarfile">
<h3 class="translated">tarfile<a class="headerlink" href="#tarfile" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/tarfile.html#tarfile.TarFile" title="tarfile.TarFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">TarFile</span></code></a> 类现在可以用作上下文管理器。此外，其 <a class="reference internal" href="../library/tarfile.html#tarfile.TarFile.add" title="tarfile.TarFile.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a> 方法有一个新的选项 <em>filter</em>，它控制哪些文件被添加到存档中，并允许编辑文件元数据。</p>
<p class="translated">新的 <em>filter</em> 选项取代了旧的、灵活性较差的 <em>exclude</em> 参数，后者现已弃用。如果指定，可选的 <em>filter</em> 参数需要是一个 <a class="reference internal" href="../glossary.html#term-keyword-argument"><span class="xref std std-term">关键字参数</span></a>。用户提供的过滤函数接受一个 <a class="reference internal" href="../library/tarfile.html#tarfile.TarInfo" title="tarfile.TarInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">TarInfo</span></code></a> 对象，并返回一个更新的 <a class="reference internal" href="../library/tarfile.html#tarfile.TarInfo" title="tarfile.TarInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">TarInfo</span></code></a> 对象，如果希望排除该文件，函数可以返回 <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">tarfile</span><span class="o">,</span><span class="w"> </span><span class="nn">glob</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">myfilter</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">isfile</span><span class="p">():</span>             <span class="c1"># 仅保存真实文件</span>
<span class="gp">... </span>        <span class="n">tarinfo</span><span class="o">.</span><span class="n">uname</span> <span class="o">=</span> <span class="s1">&#39;monty&#39;</span>      <span class="c1"># 涂改用户名</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">tarinfo</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;myarchive.tar.gz&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w:gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.txt&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">myfilter</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">tf</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="go">-rw-r--r-- monty/501        902 2011-01-26 17:59:11 annotations.txt</span>
<span class="go">-rw-r--r-- monty/501        123 2011-01-26 17:59:11 general_questions.txt</span>
<span class="go">-rw-r--r-- monty/501       3514 2011-01-26 17:59:11 prion.txt</span>
<span class="go">-rw-r--r-- monty/501        124 2011-01-26 17:59:11 py_todo.txt</span>
<span class="go">-rw-r--r-- monty/501       1399 2011-01-26 17:59:11 semaphore_notes.txt</span>
</pre></div>
</div>
<p class="translated">（由 Tarek Ziadé 提议并由 Lars Gustäbel 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6856">bpo-6856</a> 中实现。）</p>
</section>
<section id="hashlib">
<h3 class="translated">hashlib<a class="headerlink" href="#hashlib" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/hashlib.html#module-hashlib" title="hashlib: Secure hash and message digest algorithms."><code class="xref py py-mod docutils literal notranslate"><span class="pre">hashlib</span></code></a> 模块有两个新的常量属性，列出了在所有实现中保证存在的哈希算法和当前实现中可用的算法:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">hashlib</span><span class="o">.</span><span class="n">algorithms_guaranteed</span>
<span class="go">{&#39;sha1&#39;, &#39;sha224&#39;, &#39;sha384&#39;, &#39;sha256&#39;, &#39;sha512&#39;, &#39;md5&#39;}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">hashlib</span><span class="o">.</span><span class="n">algorithms_available</span>
<span class="go">{&#39;md2&#39;, &#39;SHA256&#39;, &#39;SHA512&#39;, &#39;dsaWithSHA&#39;, &#39;mdc2&#39;, &#39;SHA224&#39;, &#39;MD4&#39;, &#39;sha256&#39;,</span>
<span class="go">&#39;sha512&#39;, &#39;ripemd160&#39;, &#39;SHA1&#39;, &#39;MDC2&#39;, &#39;SHA&#39;, &#39;SHA384&#39;, &#39;MD2&#39;,</span>
<span class="go">&#39;ecdsa-with-SHA1&#39;,&#39;md4&#39;, &#39;md5&#39;, &#39;sha1&#39;, &#39;DSA-SHA&#39;, &#39;sha224&#39;,</span>
<span class="go">&#39;dsaEncryption&#39;, &#39;DSA&#39;, &#39;RIPEMD160&#39;, &#39;sha&#39;, &#39;MD5&#39;, &#39;sha384&#39;}</span>
</pre></div>
</div>
<p class="translated">（由 Carl Chenet 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7418">bpo-7418</a> 中建议。）</p>
</section>
<section id="ast">
<h3 class="translated">ast<a class="headerlink" href="#ast" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a> 模块提供了一个用于安全评估表达式字符串的通用工具，使用 Python 字面量语法。<a class="reference internal" href="../library/ast.html#ast.literal_eval" title="ast.literal_eval"><code class="xref py py-func docutils literal notranslate"><span class="pre">ast.literal_eval()</span></code></a> 函数作为内置 <a class="reference internal" href="../library/functions.html#eval" title="eval"><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code></a> 函数的安全替代，后者容易被滥用。Python 3.2 将 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> 字面量添加到支持的类型列表中：字符串、字节、数字、元组、列表、字典、集合、布尔值和 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">ast</span><span class="w"> </span><span class="kn">import</span> <span class="n">literal_eval</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span> <span class="o">=</span> <span class="s2">&quot;{&#39;req&#39;: 3, &#39;func&#39;: &#39;pow&#39;, &#39;args&#39;: (2, 0.5)}&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">literal_eval</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="go">{&#39;args&#39;: (2, 0.5), &#39;req&#39;: 3, &#39;func&#39;: &#39;pow&#39;}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span> <span class="o">=</span> <span class="s2">&quot;os.system(&#39;do something harmful&#39;)&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">literal_eval</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">malformed node or string: &lt;_ast.Call object at 0x101739a10&gt;</span>
</pre></div>
</div>
<p class="translated">（由Benjamin Peterson 和 Georg Brandl 实现。）</p>
</section>
<section id="os">
<h3 class="translated">os<a class="headerlink" href="#os" title="Link to this heading">¶</a></h3>
<p class="translated">不同的操作系统对文件名和环境变量使用各种编码。<a class="reference internal" href="../library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> 模块提供了两个新函数，<a class="reference internal" href="../library/os.html#os.fsencode" title="os.fsencode"><code class="xref py py-func docutils literal notranslate"><span class="pre">fsencode()</span></code></a> 和 <a class="reference internal" href="../library/os.html#os.fsdecode" title="os.fsdecode"><code class="xref py py-func docutils literal notranslate"><span class="pre">fsdecode()</span></code></a>，用于编码和解码文件名：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;Sehenswürdigkeiten&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">fsencode</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="go">b&#39;Sehensw\xc3\xbcrdigkeiten&#39;</span>
</pre></div>
</div>
<p class="translated">某些操作系统允许直接访问环境中的编码字节。如果是这样，<a class="reference internal" href="../library/os.html#os.supports_bytes_environ" title="os.supports_bytes_environ"><code class="xref py py-const docutils literal notranslate"><span class="pre">os.supports_bytes_environ</span></code></a> 常量将为真。</p>
<p class="translated">为了直接访问编码的环境变量（如果可用），使用新的 <a class="reference internal" href="../library/os.html#os.getenvb" title="os.getenvb"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.getenvb()</span></code></a> 函数，或者使用 <a class="reference internal" href="../library/os.html#os.environb" title="os.environb"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.environb</span></code></a>，它是 <a class="reference internal" href="../library/os.html#os.environ" title="os.environ"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.environ</span></code></a> 的字节版本。</p>
<p class="translated">（由 Victor Stinner 贡献。）</p>
</section>
<section id="shutil">
<h3 class="translated">shutil<a class="headerlink" href="#shutil" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/shutil.html#shutil.copytree" title="shutil.copytree"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.copytree()</span></code></a> 函数增加了两个新选项:</p>
<ul class="simple">
<li><p class="translated"><em>ignore_dangling_symlinks</em>：当 <code class="docutils literal notranslate"><span class="pre">symlinks=False</span></code> 时，函数会复制由符号链接指向的文件，而不是符号链接本身。此选项将静默处理文件不存在时引发的错误。</p></li>
<li><p class="translated"><em>copy_function</em>：是一个用于复制文件的可调用对象。默认使用 <a class="reference internal" href="../library/shutil.html#shutil.copy2" title="shutil.copy2"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.copy2()</span></code></a>。</p></li>
</ul>
<p class="translated">（由 Tarek Ziadé 贡献。）</p>
<p class="translated">此外，<a class="reference internal" href="../library/shutil.html#module-shutil" title="shutil: High-level file operations, including copying."><code class="xref py py-mod docutils literal notranslate"><span class="pre">shutil</span></code></a> 模块现在支持对 zip 文件、未压缩的 tar 文件、gzip 压缩的 tar 文件和 bzip 压缩的 tar 文件的 <a class="reference internal" href="../library/shutil.html#archiving-operations"><span class="std std-ref">归档操作</span></a>。还有用于注册其他归档文件格式（如 xz 压缩的 tar 文件或自定义格式）的函数。</p>
<p class="translated">主要函数是 <a class="reference internal" href="../library/shutil.html#shutil.make_archive" title="shutil.make_archive"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_archive()</span></code></a> 和 <a class="reference internal" href="../library/shutil.html#shutil.unpack_archive" title="shutil.unpack_archive"><code class="xref py py-func docutils literal notranslate"><span class="pre">unpack_archive()</span></code></a>。默认情况下，两者操作当前目录（可以通过 <a class="reference internal" href="../library/os.html#os.chdir" title="os.chdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.chdir()</span></code></a> 设置）及其任何子目录。归档文件名需要指定完整路径名。归档步骤是非破坏性的（原始文件保持不变）。</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span><span class="o">,</span><span class="w"> </span><span class="nn">pprint</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;mydata&#39;</span><span class="p">)</span>  <span class="c1"># 切换到源目录</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="s1">&#39;/var/backup/mydata&#39;</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="s1">&#39;zip&#39;</span><span class="p">)</span>      <span class="c1"># 将当前目录归档</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span>                                   <span class="c1"># 显示归档文件名</span>
<span class="go">&#39;/var/backup/mydata.zip&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>                     <span class="c1"># 切换到解包目录</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span><span class="s1">&#39;/var/backup/mydata.zip&#39;</span><span class="p">)</span>  <span class="c1"># 恢复数据</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">get_archive_formats</span><span class="p">())</span>  <span class="c1"># 显示已知格式</span>
<span class="go">[(&#39;bztar&#39;, &quot;bzip2&#39;ed tar-file&quot;),</span>
<span class="go"> (&#39;gztar&#39;, &quot;gzip&#39;ed tar-file&quot;),</span>
<span class="go"> (&#39;tar&#39;, &#39;uncompressed tar file&#39;),</span>
<span class="go"> (&#39;zip&#39;, &#39;ZIP file&#39;)]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">shutil</span><span class="o">.</span><span class="n">register_archive_format</span><span class="p">(</span>     <span class="c1"># 注册新的归档格式</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;xz&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">function</span><span class="o">=</span><span class="n">xz</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span>           <span class="c1"># 可调用的归档函数</span>
<span class="gp">... </span>    <span class="n">extra_args</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)],</span>      <span class="c1"># 传给该函数的参数</span>
<span class="gp">... </span>    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;xz compression&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">（由 Tarek Ziadé 贡献。）</p>
</section>
<section id="sqlite3">
<h3 class="translated">sqlite3<a class="headerlink" href="#sqlite3" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/sqlite3.html#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlite3</span></code></a> 模块被更新至 pysqlite 2.6.0 版。 它拥有两个新功能。</p>
<ul class="simple">
<li><p class="translated"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sqlite3.Connection.in_transit</span></code> 属性为真，表示存在未提交更改的活跃事务。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection.enable_load_extension" title="sqlite3.Connection.enable_load_extension"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlite3.Connection.enable_load_extension()</span></code></a> 和 <a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection.load_extension" title="sqlite3.Connection.load_extension"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlite3.Connection.load_extension()</span></code></a> 方法允许你从 &quot;.so&quot; 文件加载 SQLite 扩展。一个著名的扩展是随 SQLite 分发的全文搜索扩展。</p></li>
</ul>
<p class="translated">（由 R. David Murray 和 Shashwat Anand 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8845">bpo-8845</a> 中贡献。）</p>
</section>
<section id="html">
<h3 class="translated">html<a class="headerlink" href="#html" title="Link to this heading">¶</a></h3>
<p class="translated">引入了一个新的 <a class="reference internal" href="../library/html.html#module-html" title="html: Helpers for manipulating HTML."><code class="xref py py-mod docutils literal notranslate"><span class="pre">html</span></code></a> 模块，其中只有一个函数 <a class="reference internal" href="../library/html.html#html.escape" title="html.escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">escape()</span></code></a>，用于转义 HTML 标记中的保留字符：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">html</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">&#39;x &gt; 2 &amp;&amp; x &lt; 7&#39;</span><span class="p">)</span>
<span class="go">&#39;x &amp;gt; 2 &amp;amp;&amp;amp; x &amp;lt; 7&#39;</span>
</pre></div>
</div>
</section>
<section id="socket">
<h3 class="translated">socket<a class="headerlink" href="#socket" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/socket.html#module-socket" title="socket: Low-level networking interface."><code class="xref py py-mod docutils literal notranslate"><span class="pre">socket</span></code></a> 模块有两项新改进。</p>
<ul class="simple">
<li><p class="translated">Socket对象现在有一个 <a class="reference internal" href="../library/socket.html#socket.socket.detach" title="socket.socket.detach"><code class="xref py py-meth docutils literal notranslate"><span class="pre">detach()</span></code></a> 方法，该方法将套接字置于关闭状态，而不实际关闭底层的文件描述符。后者随后可以用于其他目的。（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8524">bpo-8524</a> 中添加。）</p></li>
<li><p class="translated"><a class="reference internal" href="../library/socket.html#socket.create_connection" title="socket.create_connection"><code class="xref py py-func docutils literal notranslate"><span class="pre">socket.create_connection()</span></code></a> 现在支持上下文管理协议，以无条件消耗 <a class="reference internal" href="../library/socket.html#socket.error" title="socket.error"><code class="xref py py-exc docutils literal notranslate"><span class="pre">socket.error</span></code></a> 异常，并在完成后关闭套接字。（由 Giampaolo Rodolà 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9794">bpo-9794</a> 中贡献。）</p></li>
</ul>
</section>
<section id="ssl">
<h3 class="translated">ssl<a class="headerlink" href="#ssl" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> 模块添加了许多功能以满足安全（加密、认证）互联网连接的常见需求：</p>
<ul class="simple">
<li><p class="translated">一个新的类，<a class="reference internal" href="../library/ssl.html#ssl.SSLContext" title="ssl.SSLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">SSLContext</span></code></a>，用作持久SSL数据的容器，例如协议设置、证书、私钥和各种其他选项。它包括一个 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.wrap_socket" title="ssl.SSLContext.wrap_socket"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wrap_socket()</span></code></a> 方法，用于从SSL上下文创建SSL套接字。</p></li>
<li><p class="translated">一个新的函数，<code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.match_hostname()</span></code>，通过实现HTTPS（来自 <span class="target" id="index-42"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2818.html"><strong>RFC 2818</strong></a>）的规则来支持高级协议的服务器身份验证，这些规则也适用于其他协议。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/ssl.html#ssl.SSLContext.wrap_socket" title="ssl.SSLContext.wrap_socket"><code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.wrap_socket()</span></code></a> 构造函数现在接受一个 <em>ciphers</em> 参数。<em>ciphers</em> 字符串列出了允许的加密算法，使用 <a class="reference external" href="https://docs.openssl.org/1.0.2/man1/ciphers/#cipher-list-format">OpenSSL文档</a> 中描述的格式。</p></li>
<li><p class="translated">当与较新版本的 OpenSSL 库链接时，<a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> 模块现在支持 TLS 协议的服务器名称指示（Server Name Indication，SNI）扩展。该特性允许在单个 IP 端口上为多个使用不同证书的“虚拟主机”提供服务。需要注意的是，此扩展仅在客户端模式下受支持，并且需要通过向 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.wrap_socket" title="ssl.SSLContext.wrap_socket"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLContext.wrap_socket()</span></code></a> 方法传递 <em>server_hostname</em> 参数来激活。</p></li>
<li><p class="translated">已向 <a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> 模块添加了各种选项，例如 <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_SSLv2" title="ssl.OP_NO_SSLv2"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_SSLv2</span></code></a>，该选项禁用了不安全且已过时的SSLv2协议。</p></li>
<li><p class="translated">扩展现在加载了所有OpenSSL密码和摘要算法。如果某些SSL证书无法验证，它们将被报告为“未知算法”错误。</p></li>
<li><p class="translated">现在可以通过模块属性 <a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION" title="ssl.OPENSSL_VERSION"><code class="xref py py-const docutils literal notranslate"><span class="pre">ssl.OPENSSL_VERSION</span></code></a> (字符串) 、<a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION_INFO" title="ssl.OPENSSL_VERSION_INFO"><code class="xref py py-const docutils literal notranslate"><span class="pre">ssl.OPENSSL_VERSION_INFO</span></code></a> (一个5元组) 和 <a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION_NUMBER" title="ssl.OPENSSL_VERSION_NUMBER"><code class="xref py py-const docutils literal notranslate"><span class="pre">ssl.OPENSSL_VERSION_NUMBER</span></code></a> (整数) 访问正在使用的OpenSSL版本。</p></li>
</ul>
<p class="translated">（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8850">bpo-8850</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1589">bpo-1589</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8322">bpo-8322</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5639">bpo-5639</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4870">bpo-4870</a>、 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8484">bpo-8484</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8321">bpo-8321</a> 中贡献。）</p>
</section>
<section id="nntp">
<h3 class="translated">nntp<a class="headerlink" href="#nntp" title="Link to this heading">¶</a></h3>
<p class="translated"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nntplib</span></code> 模块进行了重新实现，改进了字节和文本语义以及更实用的API。这些改进破坏了与Python 3.1中nntplib版本的兼容性，后者本身部分功能不完善。</p>
<p class="translated">还增加了通过隐式（使用 <code class="xref py py-class docutils literal notranslate"><span class="pre">nntplib.NNTP_SSL</span></code>）和显式（使用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">nntplib.NNTP.starttls()</span></code>）TLS进行安全连接的支持。</p>
<p class="translated">（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9360">bpo-9360</a> 中贡献，由 Andrew Vant 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1926">bpo-1926</a> 中贡献。）</p>
</section>
<section id="certificates">
<h3 class="translated">certificates<a class="headerlink" href="#certificates" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/http.client.html#http.client.HTTPSConnection" title="http.client.HTTPSConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">http.client.HTTPSConnection</span></code></a>、<a class="reference internal" href="../library/urllib.request.html#urllib.request.HTTPSHandler" title="urllib.request.HTTPSHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">urllib.request.HTTPSHandler</span></code></a> 和 <a class="reference internal" href="../library/urllib.request.html#urllib.request.urlopen" title="urllib.request.urlopen"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.request.urlopen()</span></code></a> 现在接受可选参数，以允许对服务器证书进行检查，以验证一组证书颁发机构，这是公共HTTPS使用的推荐做法。</p>
<p class="translated">（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9003">bpo-9003</a> 中添加。）</p>
</section>
<section id="imaplib">
<h3 class="translated">imaplib<a class="headerlink" href="#imaplib" title="Link to this heading">¶</a></h3>
<p class="translated">通过新的 <a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4.starttls" title="imaplib.IMAP4.starttls"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imaplib.IMAP4.starttls</span></code></a> 方法，标准IMAP4连接上增加了显式TLS支持。</p>
<p class="translated">（由 Lorenzo M. Catucci 和 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4471">bpo-4471</a> 中贡献。）</p>
</section>
<section id="http-client">
<h3 class="translated">http.client<a class="headerlink" href="#http-client" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/http.client.html#module-http.client" title="http.client: HTTP and HTTPS protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">http.client</span></code></a> 模块中进行了一些小的API改进。不再支持旧式HTTP 0.9简单响应，所有类中的 <em>strict</em> 参数已被弃用。</p>
<p class="translated"><a class="reference internal" href="../library/http.client.html#http.client.HTTPConnection" title="http.client.HTTPConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPConnection</span></code></a> 和 <a class="reference internal" href="../library/http.client.html#http.client.HTTPSConnection" title="http.client.HTTPSConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPSConnection</span></code></a> 类现在有一个 <em>source_address</em> 参数，用于指示（主机，端口）元组，表明HTTP连接是从哪里建立的。</p>
<p class="translated">为 <a class="reference internal" href="../library/http.client.html#http.client.HTTPSConnection" title="http.client.HTTPSConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPSConnection</span></code></a> 增加了证书检查和HTTPS虚拟主机的支持。</p>
<p class="translated">连接对象上的 <a class="reference internal" href="../library/http.client.html#http.client.HTTPConnection.request" title="http.client.HTTPConnection.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request()</span></code></a> 方法允许一个可选的 <em>body</em> 参数，以便可以使用 <a class="reference internal" href="../glossary.html#term-file-object"><span class="xref std std-term">文件对象</span></a> 来提供请求的内容。方便的是，<em>body</em> 参数现在也接受一个 <a class="reference internal" href="../glossary.html#term-iterable"><span class="xref std std-term">可迭代</span></a> 对象，只要它包含一个明确的 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 头部。这个扩展接口比以前更加灵活。</p>
<p class="translated">为了通过代理服务器建立 HTTPS 连接，新增了一个 <a class="reference internal" href="../library/http.client.html#http.client.HTTPConnection.set_tunnel" title="http.client.HTTPConnection.set_tunnel"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_tunnel()</span></code></a> 方法，用于设置 HTTP Connect 隧道的主机和端口。</p>
<p class="translated">为了与 <a class="reference internal" href="../library/http.server.html#module-http.server" title="http.server: HTTP server and request handlers."><code class="xref py py-mod docutils literal notranslate"><span class="pre">http.server</span></code></a> 的行为保持一致，HTTP 客户端库现在也使用 ISO-8859-1（Latin-1）编码对头部进行编码。它已经对传入的头部这样做了，所以现在传入和传出流量的行为是一致的。（参见 Armin Ronacher 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10980">bpo-10980</a> 中的工作。）</p>
</section>
<section id="unittest">
<h3 class="translated">unittest<a class="headerlink" href="#unittest" title="Link to this heading">¶</a></h3>
<p class="translated">unittest 模块有许多改进，支持包的测试发现、在交互式提示符下更容易进行实验、新的测试用例方法、改进的测试失败诊断消息以及更好的方法名称。</p>
<ul>
<li><p class="translated">命令行调用 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">unittest</span></code> 现在接受文件路径而不是模块名来运行特定的测试 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10620">bpo-10620</a>)。新的测试发现可以在包内找到测试，定位从顶级目录可导入的任何测试。顶级目录可以用 <code class="docutils literal notranslate"><span class="pre">-t</span></code> 选项指定，用 <code class="docutils literal notranslate"><span class="pre">-p</span></code> 匹配文件的模式，以及用 <code class="docutils literal notranslate"><span class="pre">-s</span></code> 指定开始发现的目录：</p>
<div class="translated highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>unittest<span class="w"> </span>discover<span class="w"> </span>-s<span class="w"> </span>my_proj_dir<span class="w"> </span>-p<span class="w"> </span>_test.py
</pre></div>
</div>
<p class="translated">（由 Michael Foord 贡献）</p>
</li>
<li><p class="translated">在交互式提示符下进行实验现在更容易了，因为 <a class="reference internal" href="../library/unittest.html#unittest.TestCase" title="unittest.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">unittest.TestCase</span></code></a> 类现在可以不带参数实例化：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">unittest</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestCase</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">TestCase</span><span class="p">()</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">（由 Michael Foord 贡献）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> 模块有两个新方法，<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertWarns" title="unittest.TestCase.assertWarns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertWarns()</span></code></a> 和 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertWarnsRegex" title="unittest.TestCase.assertWarnsRegex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertWarnsRegex()</span></code></a>，用于验证给定警告类型是否由被测试代码触发：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">):</span>
    <span class="n">legacy_function</span><span class="p">(</span><span class="s1">&#39;XYZ&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9754">bpo-9754</a> 中贡献。）</p>
<p class="translated">另一个新方法，<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertCountEqual" title="unittest.TestCase.assertCountEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertCountEqual()</span></code></a> 用于比较两个可迭代对象，以确定它们的元素计数是否相等（无论顺序如何，相同元素的出现次数是否相同）:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_anagram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertCountEqual</span><span class="p">(</span><span class="s1">&#39;algorithm&#39;</span><span class="p">,</span> <span class="s1">&#39;logarithm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">（由 Raymond Hettinger 贡献。）</p>
</li>
<li><p class="translated">unittest 模块的主要特性之一是当测试失败时，努力生成有意义的诊断信息。在可能的情况下，失败记录会附带输出内容的差异。这对于分析失败的测试运行的日志文件特别有帮助。然而，由于差异有时可能非常庞大，因此有一个新的 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.maxDiff" title="unittest.TestCase.maxDiff"><code class="xref py py-attr docutils literal notranslate"><span class="pre">maxDiff</span></code></a> 属性用于设置显示的差异最大长度。</p></li>
<li><p class="translated">此外，模块中的方法名称已经进行了多项清理。</p>
<p class="translated">例如，<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertRegex" title="unittest.TestCase.assertRegex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRegex()</span></code></a> 是 <code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRegexpMatches()</span></code> 的新名称，后者命名不当，因为测试使用的是 <a class="reference internal" href="../library/re.html#re.search" title="re.search"><code class="xref py py-func docutils literal notranslate"><span class="pre">re.search()</span></code></a>，而不是 <a class="reference internal" href="../library/re.html#re.match" title="re.match"><code class="xref py py-func docutils literal notranslate"><span class="pre">re.match()</span></code></a>。其他使用正则表达式的方法现在也优先使用短形式 &quot;Regex&quot; 而不是 &quot;Regexp&quot; —— 这与其他 unittest 实现中的命名一致，匹配 Python 中 <a class="reference internal" href="../library/re.html#module-re" title="re: Regular expression operations."><code class="xref py py-mod docutils literal notranslate"><span class="pre">re</span></code></a> 模块的旧名称，并且具有明确的驼峰命名。</p>
<p class="translated">（由 Raymond Hettinger 贡献并由 Ezio Melotti 实现。）</p>
</li>
<li><p class="translated">为了提高一致性，一些长期存在的方法别名正在被弃用，转而使用首选名称：</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p class="translated">旧名称</p></th>
<th class="head"><p class="translated">首选名称</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p class="translated"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assert_()</span></code></p></td>
<td><p class="translated"><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertTrue" title="unittest.TestCase.assertTrue"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertTrue()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p class="translated"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertEquals()</span></code></p></td>
<td><p class="translated"><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertEqual()</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p class="translated"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotEquals()</span></code></p></td>
<td><p class="translated"><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotEqual" title="unittest.TestCase.assertNotEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotEqual()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p class="translated"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertAlmostEquals()</span></code></p></td>
<td><p class="translated"><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertAlmostEqual" title="unittest.TestCase.assertAlmostEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertAlmostEqual()</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p class="translated"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotAlmostEquals()</span></code></p></td>
<td><p class="translated"><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotAlmostEqual" title="unittest.TestCase.assertNotAlmostEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotAlmostEqual()</span></code></a></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p class="translated">同样，Python 3.1 中弃用的 <code class="docutils literal notranslate"><span class="pre">TestCase.fail*</span></code> 方法预计将在 Python 3.3 中被移除。</p>
<p class="translated">（由 Ezio Melotti 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9424">bpo-9424</a> 中贡献。）</p>
</li>
<li><p class="translated"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertDictContainsSubset()</span></code> 方法被弃用，因为它的实现有误，参数顺序错误。这导致了难以调试的视觉错觉，例如 <code class="docutils literal notranslate"><span class="pre">TestCase().assertDictContainsSubset({'a':1,</span> <span class="pre">'b':2},</span> <span class="pre">{'a':1})</span></code> 这样的测试会失败。</p>
<p class="translated">（由 Raymond Hettinger 贡献。）</p>
</li>
</ul>
</section>
<section id="random">
<h3 class="translated">random<a class="headerlink" href="#random" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/random.html#module-random" title="random: Generate pseudo-random numbers with various common distributions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">random</span></code></a> 模块中的整数方法现在能更好地生成均匀分布。之前，它们使用 <code class="docutils literal notranslate"><span class="pre">int(n*random())</span></code> 计算选择，这在 <em>n</em> 不是二的幂时存在轻微偏差。现在，从下一个二的幂的范围中进行多次选择，并且只有当选择落在 <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">n</span></code> 范围内时才保留。受影响的函数和方法包括 <a class="reference internal" href="../library/random.html#random.randrange" title="random.randrange"><code class="xref py py-func docutils literal notranslate"><span class="pre">randrange()</span></code></a>、 <a class="reference internal" href="../library/random.html#random.randint" title="random.randint"><code class="xref py py-func docutils literal notranslate"><span class="pre">randint()</span></code></a>、 <a class="reference internal" href="../library/random.html#random.choice" title="random.choice"><code class="xref py py-func docutils literal notranslate"><span class="pre">choice()</span></code></a>、 <a class="reference internal" href="../library/random.html#random.shuffle" title="random.shuffle"><code class="xref py py-func docutils literal notranslate"><span class="pre">shuffle()</span></code></a> 和 <a class="reference internal" href="../library/random.html#random.sample" title="random.sample"><code class="xref py py-func docutils literal notranslate"><span class="pre">sample()</span></code></a>。</p>
<p class="translated">（由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9025">bpo-9025</a> 中贡献。）</p>
</section>
<section id="poplib">
<h3 class="translated">poplib<a class="headerlink" href="#poplib" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/poplib.html#poplib.POP3_SSL" title="poplib.POP3_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">POP3_SSL</span></code></a> 类现在接受一个 <em>context</em> 参数，这是一个 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext" title="ssl.SSLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> 对象，允许将 SSL 配置选项、证书和私钥捆绑到一个单一的（可能是长期存在的）结构体中。</p>
<p class="translated">（由 Giampaolo Rodolà 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8807">bpo-8807</a> 中贡献。）</p>
</section>
<section id="asyncore">
<h3 class="translated">asyncore<a class="headerlink" href="#asyncore" title="Link to this heading">¶</a></h3>
<p class="translated"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncore.dispatcher</span></code> 现在提供了一个 <code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_accepted()</span></code> 方法，返回一个 <code class="docutils literal notranslate"><span class="pre">(sock,</span> <span class="pre">addr)</span></code> 对，当与新远程端点实际建立连接时调用。这应作为旧 <code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_accept()</span></code> 的替代，避免了用户直接调用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">accept()</span></code>。</p>
<p class="translated">（由 Giampaolo Rodolà 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6706">bpo-6706</a> 中贡献。）</p>
</section>
<section id="tempfile">
<h3 class="translated">tempfile<a class="headerlink" href="#tempfile" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/tempfile.html#module-tempfile" title="tempfile: Generate temporary files and directories."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tempfile</span></code></a> 模块有一个新的上下文管理器，<a class="reference internal" href="../library/tempfile.html#tempfile.TemporaryDirectory" title="tempfile.TemporaryDirectory"><code class="xref py py-class docutils literal notranslate"><span class="pre">TemporaryDirectory</span></code></a>，它提供了临时目录的简单确定性清理：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;创建的临时目录：&#39;</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">（由 Neil Schemenauer 和 Nick Coghlan 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5178">bpo-5178</a> 中贡献。）</p>
</section>
<section id="inspect">
<h3 class="translated">inspect<a class="headerlink" href="#inspect" title="Link to this heading">¶</a></h3>
<ul>
<li><p class="translated"><a class="reference internal" href="../library/inspect.html#module-inspect" title="inspect: Extract information and source code from live objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">inspect</span></code></a> 模块有一个新函数 <a class="reference internal" href="../library/inspect.html#inspect.getgeneratorstate" title="inspect.getgeneratorstate"><code class="xref py py-func docutils literal notranslate"><span class="pre">getgeneratorstate()</span></code></a> 用来方便地标识一个生成器迭代器的当前状态:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">inspect</span><span class="w"> </span><span class="kn">import</span> <span class="n">getgeneratorstate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">gen</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">yield</span> <span class="s1">&#39;demo&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getgeneratorstate</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">&#39;GEN_CREATED&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">&#39;demo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getgeneratorstate</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">&#39;GEN_SUSPENDED&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getgeneratorstate</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">&#39;GEN_CLOSED&#39;</span>
</pre></div>
</div>
<p class="translated">（由 Rodolpho Eckhardt 和 Nick Coghlan 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10220">bpo-10220</a> 中贡献。）</p>
</li>
<li><p class="translated">为了支持查找而不激活动态属性，<a class="reference internal" href="../library/inspect.html#module-inspect" title="inspect: Extract information and source code from live objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">inspect</span></code></a> 模块有一个新函数，<a class="reference internal" href="../library/inspect.html#inspect.getattr_static" title="inspect.getattr_static"><code class="xref py py-func docutils literal notranslate"><span class="pre">getattr_static()</span></code></a>。与 <a class="reference internal" href="../library/functions.html#hasattr" title="hasattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">hasattr()</span></code></a> 不同，这是一个真正的只读搜索，保证在搜索过程中不会改变状态：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;运行中&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="mi">10</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
<span class="go">运行中</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">getattr_static</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
<span class="go">&lt;property object at 0x1022bd788&gt;</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p class="translated">（由 Michael Foord 贡献）</p>
</div></blockquote>
</section>
<section id="pydoc">
<h3 class="translated">pydoc<a class="headerlink" href="#pydoc" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/pydoc.html#module-pydoc" title="pydoc: Documentation generator and online help system."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pydoc</span></code></a> 模块现在提供了一个大幅改进的Web服务器接口，以及一个新的命令行选项 <code class="docutils literal notranslate"><span class="pre">-b</span></code>，用于自动打开浏览器窗口以显示该服务器：</p>
<div class="translated highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pydoc3.2<span class="w"> </span>-b
</pre></div>
</div>
<p class="translated">（由 Ron Adam 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2001">bpo-2001</a> 中贡献。）</p>
</section>
<section id="dis">
<h3 class="translated">dis<a class="headerlink" href="#dis" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/dis.html#module-dis" title="dis: Disassembler for Python bytecode."><code class="xref py py-mod docutils literal notranslate"><span class="pre">dis</span></code></a> 模块新增了两个用于检查代码的函数，<a class="reference internal" href="../library/dis.html#dis.code_info" title="dis.code_info"><code class="xref py py-func docutils literal notranslate"><span class="pre">code_info()</span></code></a> 和 <a class="reference internal" href="../library/dis.html#dis.show_code" title="dis.show_code"><code class="xref py py-func docutils literal notranslate"><span class="pre">show_code()</span></code></a>。两者都为提供的函数、方法、源代码字符串或代码对象提供详细的代码对象信息。前者返回一个字符串，后者将其打印出来：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">dis</span><span class="o">,</span><span class="w"> </span><span class="nn">random</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dis</span><span class="o">.</span><span class="n">show_code</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">)</span>
<span class="go">Name:              choice</span>
<span class="go">Filename:          /Library/Frameworks/Python.framework/Versions/3.2/lib/python3.2/random.py</span>
<span class="go">Argument count:    2</span>
<span class="go">Kw-only arguments: 0</span>
<span class="go">Number of locals:  3</span>
<span class="go">Stack size:        11</span>
<span class="go">Flags:             OPTIMIZED, NEWLOCALS, NOFREE</span>
<span class="go">Constants:</span>
<span class="go">   0: &#39;Choose a random element from a non-empty sequence.&#39;</span>
<span class="go">   1: &#39;Cannot choose from an empty sequence&#39;</span>
<span class="go">Names:</span>
<span class="go">   0: _randbelow</span>
<span class="go">   1: len</span>
<span class="go">   2: ValueError</span>
<span class="go">   3: IndexError</span>
<span class="go">Variable names:</span>
<span class="go">   0: self</span>
<span class="go">   1: seq</span>
<span class="go">   2: i</span>
</pre></div>
</div>
<p class="translated">此外，<a class="reference internal" href="../library/dis.html#dis.dis" title="dis.dis"><code class="xref py py-func docutils literal notranslate"><span class="pre">dis()</span></code></a> 函数现在接受字符串参数，以便常用的 <code class="docutils literal notranslate"><span class="pre">dis(compile(s,</span> <span class="pre">'',</span> <span class="pre">'eval'))</span></code> 可以简化为 <code class="docutils literal notranslate"><span class="pre">dis(s)</span></code>：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dis</span><span class="p">(</span><span class="s1">&#39;3*x+1 if x%2==1 else x//2&#39;</span><span class="p">)</span>
<span class="go">  1           0 LOAD_NAME                0 (x)</span>
<span class="go">              3 LOAD_CONST               0 (2)</span>
<span class="go">              6 BINARY_MODULO</span>
<span class="go">              7 LOAD_CONST               1 (1)</span>
<span class="go">             10 COMPARE_OP               2 (==)</span>
<span class="go">             13 POP_JUMP_IF_FALSE       28</span>
<span class="go">             16 LOAD_CONST               2 (3)</span>
<span class="go">             19 LOAD_NAME                0 (x)</span>
<span class="go">             22 BINARY_MULTIPLY</span>
<span class="go">             23 LOAD_CONST               1 (1)</span>
<span class="go">             26 BINARY_ADD</span>
<span class="go">             27 RETURN_VALUE</span>
<span class="go">        &gt;&gt;   28 LOAD_NAME                0 (x)</span>
<span class="go">             31 LOAD_CONST               0 (2)</span>
<span class="go">             34 BINARY_FLOOR_DIVIDE</span>
<span class="go">             35 RETURN_VALUE</span>
</pre></div>
</div>
<p class="translated">综合来看，这些改进使得探索CPython的实现方式以及亲自查看语言语法在底层的作用变得更加容易。</p>
<p class="translated">（由 Nick Coghlan 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9147">bpo-9147</a> 中贡献。）</p>
</section>
<section id="dbm">
<h3 class="translated">dbm<a class="headerlink" href="#dbm" title="Link to this heading">¶</a></h3>
<p class="translated">所有数据库模块现在均支持 <code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code> 和 <code class="xref py py-meth docutils literal notranslate"><span class="pre">setdefault()</span></code> 方法。</p>
<p class="translated">（由 Ray Allen 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9523">bpo-9523</a> 中建议。）</p>
</section>
<section id="ctypes">
<h3 class="translated">ctypes<a class="headerlink" href="#ctypes" title="Link to this heading">¶</a></h3>
<p class="translated">一个新类型 <a class="reference internal" href="../library/ctypes.html#ctypes.c_ssize_t" title="ctypes.c_ssize_t"><code class="xref py py-class docutils literal notranslate"><span class="pre">ctypes.c_ssize_t</span></code></a> 用来表示 C <code class="xref c c-type docutils literal notranslate"><span class="pre">ssize_t</span></code> 数据类型。</p>
</section>
<section id="site">
<h3 class="translated">site<a class="headerlink" href="#site" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/site.html#module-site" title="site: Module responsible for site-specific configuration."><code class="xref py py-mod docutils literal notranslate"><span class="pre">site</span></code></a> 模块新增了三个用于报告给定 Python 安装版详细信息的函数。</p>
<ul class="simple">
<li><p class="translated"><a class="reference internal" href="../library/site.html#site.getsitepackages" title="site.getsitepackages"><code class="xref py py-func docutils literal notranslate"><span class="pre">getsitepackages()</span></code></a> 列出所有全局 site-packages 目录。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/site.html#site.getuserbase" title="site.getuserbase"><code class="xref py py-func docutils literal notranslate"><span class="pre">getuserbase()</span></code></a> 报告可用来存储数据的用户基准目录。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/site.html#site.getusersitepackages" title="site.getusersitepackages"><code class="xref py py-func docutils literal notranslate"><span class="pre">getusersitepackages()</span></code></a> 将揭示用户专属的 site-packages 目录路径。</p></li>
</ul>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">site</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">site</span><span class="o">.</span><span class="n">getsitepackages</span><span class="p">()</span>
<span class="go">[&#39;/Library/Frameworks/Python.framework/Versions/3.2/lib/python3.2/site-packages&#39;,</span>
<span class="go"> &#39;/Library/Frameworks/Python.framework/Versions/3.2/lib/site-python&#39;,</span>
<span class="go"> &#39;/Library/Python/3.2/site-packages&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">site</span><span class="o">.</span><span class="n">getuserbase</span><span class="p">()</span>
<span class="go">&#39;/Users/raymondhettinger/Library/Python/3.2&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">site</span><span class="o">.</span><span class="n">getusersitepackages</span><span class="p">()</span>
<span class="go">&#39;/Users/raymondhettinger/Library/Python/3.2/lib/python/site-packages&#39;</span>
</pre></div>
</div>
<p class="translated">部分 site 功能可方便地直接通过命令行访问：</p>
<div class="translated highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>site<span class="w"> </span>--user-base
<span class="go">/Users/raymondhettinger/.local</span>
<span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>site<span class="w"> </span>--user-site
<span class="go">/Users/raymondhettinger/.local/lib/python3.2/site-packages</span>
</pre></div>
</div>
<p class="translated">（由 Tarek Ziadé 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6693">bpo-6693</a> 中贡献。）</p>
</section>
<section id="sysconfig">
<h3 class="translated">sysconfig<a class="headerlink" href="#sysconfig" title="Link to this heading">¶</a></h3>
<p class="translated">新增的 <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sysconfig</span></code></a> 模块使得发现依赖于不同系统平台和安装版的安装路径和配置变量更为简单直观。</p>
<p class="translated">该模块提供了对平台和版本信息获取函数的访问：</p>
<ul class="simple">
<li><p class="translated"><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_platform" title="sysconfig.get_platform"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_platform()</span></code></a> 将返回 <em>linux-i586</em> 或 <em>macosx-10.6-ppc</em> 形式的值。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_python_version" title="sysconfig.get_python_version"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_python_version()</span></code></a> 将返回 Python 版本字符串如 &quot;3.2&quot;。</p></li>
</ul>
<p class="translated">它还提供了与 <code class="docutils literal notranslate"><span class="pre">distutils</span></code> 所使用的七个规范名称所对应的路径和变量的访问。 这包括 <em>posix_prefix</em>、 <em>posix_home</em>、 <em>posix_user</em>、 <em>nt</em>、 <em>nt_user</em>、 <em>os2</em>、 <em>os2_home</em>:</p>
<ul class="simple">
<li><p class="translated"><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_paths" title="sysconfig.get_paths"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_paths()</span></code></a> 返回一个包含当前安装方案安装路径的字典。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_config_vars" title="sysconfig.get_config_vars"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_config_vars()</span></code></a> 返回一个包含平台特定变量的字典。</p></li>
</ul>
<p class="translated">还有一个方便的命令行界面：</p>
<div class="translated highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">C:\Python32&gt;</span>python -m sysconfig
<span class="go">Platform: &quot;win32&quot;</span>
<span class="go">Python version: &quot;3.2&quot;</span>
<span class="go">Current installation scheme: &quot;nt&quot;</span>

<span class="go">Paths:</span>
<span class="go">        data = &quot;C:\Python32&quot;</span>
<span class="go">        include = &quot;C:\Python32\Include&quot;</span>
<span class="go">        platinclude = &quot;C:\Python32\Include&quot;</span>
<span class="go">        platlib = &quot;C:\Python32\Lib\site-packages&quot;</span>
<span class="go">        platstdlib = &quot;C:\Python32\Lib&quot;</span>
<span class="go">        purelib = &quot;C:\Python32\Lib\site-packages&quot;</span>
<span class="go">        scripts = &quot;C:\Python32\Scripts&quot;</span>
<span class="go">        stdlib = &quot;C:\Python32\Lib&quot;</span>

<span class="go">Variables:</span>
<span class="go">        BINDIR = &quot;C:\Python32&quot;</span>
<span class="go">        BINLIBDEST = &quot;C:\Python32\Lib&quot;</span>
<span class="go">        EXE = &quot;.exe&quot;</span>
<span class="go">        INCLUDEPY = &quot;C:\Python32\Include&quot;</span>
<span class="go">        LIBDEST = &quot;C:\Python32\Lib&quot;</span>
<span class="go">        SO = &quot;.pyd&quot;</span>
<span class="go">        VERSION = &quot;32&quot;</span>
<span class="go">        abiflags = &quot;&quot;</span>
<span class="go">        base = &quot;C:\Python32&quot;</span>
<span class="go">        exec_prefix = &quot;C:\Python32&quot;</span>
<span class="go">        platbase = &quot;C:\Python32&quot;</span>
<span class="go">        prefix = &quot;C:\Python32&quot;</span>
<span class="go">        projectbase = &quot;C:\Python32&quot;</span>
<span class="go">        py_version = &quot;3.2&quot;</span>
<span class="go">        py_version_nodot = &quot;32&quot;</span>
<span class="go">        py_version_short = &quot;3.2&quot;</span>
<span class="go">        srcdir = &quot;C:\Python32&quot;</span>
<span class="go">        userbase = &quot;C:\Documents and Settings\Raymond\Application Data\Python&quot;</span>
</pre></div>
</div>
<p class="translated">（由TarekZiadé 移出Distutils。）</p>
</section>
<section id="pdb">
<h3 class="translated">pdb<a class="headerlink" href="#pdb" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/pdb.html#module-pdb" title="pdb: The Python debugger for interactive interpreters."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pdb</span></code></a> 调试器模块获得了一些可用性改进：</p>
<ul class="simple">
<li><p class="translated"><code class="file docutils literal notranslate"><span class="pre">pdb.py</span></code> 现在有一个 <code class="docutils literal notranslate"><span class="pre">-c</span></code> 选项，用于执行 <code class="file docutils literal notranslate"><span class="pre">.pdbrc</span></code> 脚本文件中给出的命令。</p></li>
<li><p class="translated">一个 <code class="file docutils literal notranslate"><span class="pre">.pdbrc</span></code> 脚本文件可以包含 <code class="docutils literal notranslate"><span class="pre">continue</span></code> 和 <code class="docutils literal notranslate"><span class="pre">next</span></code> 命令，用于继续调试。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/pdb.html#pdb.Pdb" title="pdb.Pdb"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pdb</span></code></a> 类构造函数现在接受一个 <em>nosigint</em> 参数。</p></li>
<li><p class="translated">新命令：<code class="docutils literal notranslate"><span class="pre">l(list)</span></code>、<code class="docutils literal notranslate"><span class="pre">ll(long</span> <span class="pre">list)</span></code> 和 <code class="docutils literal notranslate"><span class="pre">source</span></code> 用于列出源代码。</p></li>
<li><p class="translated">新命令：<code class="docutils literal notranslate"><span class="pre">display</span></code> 和 <code class="docutils literal notranslate"><span class="pre">undisplay</span></code> 用于显示或隐藏表达式值的变化。</p></li>
<li><p class="translated">新命令：<code class="docutils literal notranslate"><span class="pre">interact</span></code> 用于启动一个包含当前作用域中全局和局部名称的交互式解释器。</p></li>
<li><p class="translated">可以通过断点编号清除断点。</p></li>
</ul>
<p class="translated">（由Georg Brandl、 Antonio Cuni 和 Ilya Sandler 贡献。）</p>
</section>
<section id="configparser">
<h3 class="translated">configparser<a class="headerlink" href="#configparser" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/configparser.html#module-configparser" title="configparser: Configuration file parser."><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> 模块已被修改，以提高默认解析器的可用性和其支持的 INI 语法的可预测性。旧的 <code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code> 类已被移除，改为 <code class="xref py py-class docutils literal notranslate"><span class="pre">SafeConfigParser</span></code>，后者已被重命名为 <a class="reference internal" href="../library/configparser.html#configparser.ConfigParser" title="configparser.ConfigParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a>。内联注释支持现在默认关闭，并且单个配置源中不允许有节或选项重复。</p>
<p class="translated">配置解析器获得了一个基于映射协议的新 API：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">[DEFAULT]</span>
<span class="gp">... </span><span class="s2">location = upper left</span>
<span class="gp">... </span><span class="s2">visible = yes</span>
<span class="gp">... </span><span class="s2">editable = no</span>
<span class="gp">... </span><span class="s2">color = blue</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="s2">[main]</span>
<span class="gp">... </span><span class="s2">title = Main Menu</span>
<span class="gp">... </span><span class="s2">color = green</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="s2">[options]</span>
<span class="gp">... </span><span class="s2">title = Options</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
<span class="go">&#39;green&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">][</span><span class="s1">&#39;editable&#39;</span><span class="p">]</span>
<span class="go">&#39;no&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">section</span> <span class="o">=</span> <span class="n">parser</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
<span class="go">&#39;Options&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Options (editable: </span><span class="si">%(editable)s</span><span class="s1">)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
<span class="go">&#39;Options (editable: no)&#39;</span>
</pre></div>
</div>
<p class="translated">新 API 是在经典 API 之上实现的，因此自定义解析器子类应能够无修改地使用它。</p>
<p class="translated">配置解析器接受的 INI 文件结构体现在可以自定义。用户可以指定替代的选项/值分隔符和注释前缀，更改 <em>DEFAULT</em> 部分的名称或切换插值语法。</p>
<p class="translated">支持可插拔插值，包括一个额外的插值处理程序 <a class="reference internal" href="../library/configparser.html#configparser.ExtendedInterpolation" title="configparser.ExtendedInterpolation"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtendedInterpolation</span></code></a>：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="n">ExtendedInterpolation</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="o">.</span><span class="n">read_dict</span><span class="p">({</span><span class="s1">&#39;buildout&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="s1">&#39;/home/ambv/zope9&#39;</span><span class="p">},</span>
<span class="gp">... </span>                  <span class="s1">&#39;custom&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="s1">&#39;/usr/local&#39;</span><span class="p">}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">[buildout]</span>
<span class="gp">... </span><span class="s2">parts =</span>
<span class="gp">... </span><span class="s2">  zope9</span>
<span class="gp">... </span><span class="s2">  instance</span>
<span class="gp">... </span><span class="s2">find-links =</span>
<span class="gp">... </span><span class="s2">  ${buildout:directory}/downloads/dist</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="s2">[zope9]</span>
<span class="gp">... </span><span class="s2">recipe = plone.recipe.zope9install</span>
<span class="gp">... </span><span class="s2">location = /opt/zope</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="s2">[instance]</span>
<span class="gp">... </span><span class="s2">recipe = plone.recipe.zope9instance</span>
<span class="gp">... </span><span class="s2">zope9-location = ${zope9:location}</span>
<span class="gp">... </span><span class="s2">zope-conf = ${custom:prefix}/etc/zope.conf</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="p">[</span><span class="s1">&#39;buildout&#39;</span><span class="p">][</span><span class="s1">&#39;find-links&#39;</span><span class="p">]</span>
<span class="go">&#39;\n/home/ambv/zope9/downloads/dist&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">][</span><span class="s1">&#39;zope-conf&#39;</span><span class="p">]</span>
<span class="go">&#39;/usr/local/etc/zope.conf&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span> <span class="o">=</span> <span class="n">parser</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span><span class="p">[</span><span class="s1">&#39;zope-conf&#39;</span><span class="p">]</span>
<span class="go">&#39;/usr/local/etc/zope.conf&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span><span class="p">[</span><span class="s1">&#39;zope9-location&#39;</span><span class="p">]</span>
<span class="go">&#39;/opt/zope&#39;</span>
</pre></div>
</div>
<p class="translated">此外还引入了一些较小的功能特性，例如：支持在读取操作中指定编码格式、为获取函数（get-functions）指定回退值，以及直接从字典和字符串中读取数据。</p>
<p class="translated">（所有修改均由 Łukasz Langa 贡献。）</p>
</section>
<section id="urllib-parse">
<h3 class="translated">urllib.parse<a class="headerlink" href="#urllib-parse" title="Link to this heading">¶</a></h3>
<p class="translated">对 <a class="reference internal" href="../library/urllib.parse.html#module-urllib.parse" title="urllib.parse: Parse URLs into or assemble them from components."><code class="xref py py-mod docutils literal notranslate"><span class="pre">urllib.parse</span></code></a> 模块进行了一些可用性改进。</p>
<p class="translated"><a class="reference internal" href="../library/urllib.parse.html#urllib.parse.urlparse" title="urllib.parse.urlparse"><code class="xref py py-func docutils literal notranslate"><span class="pre">urlparse()</span></code></a> 函数现在支持 <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6">IPv6</a> 地址，如 <span class="target" id="index-43"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2732.html"><strong>RFC 2732</strong></a> 中所述：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="s1">&#39;http://[dead:beef:cafe:5417:affe:8FA3:deaf:feed]/foo/&#39;</span><span class="p">)</span>
<span class="go">ParseResult(scheme=&#39;http&#39;,</span>
<span class="go">            netloc=&#39;[dead:beef:cafe:5417:affe:8FA3:deaf:feed]&#39;,</span>
<span class="go">            path=&#39;/foo/&#39;,</span>
<span class="go">            params=&#39;&#39;,</span>
<span class="go">            query=&#39;&#39;,</span>
<span class="go">            fragment=&#39;&#39;)</span>
</pre></div>
</div>
<p class="translated"><a class="reference internal" href="../library/urllib.parse.html#urllib.parse.urldefrag" title="urllib.parse.urldefrag"><code class="xref py py-func docutils literal notranslate"><span class="pre">urldefrag()</span></code></a> 函数现在返回一个 <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">具名元组</span></a>:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urldefrag</span><span class="p">(</span><span class="s1">&#39;http://python.org/about/#target&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span>
<span class="go">DefragResult(url=&#39;http://python.org/about/&#39;, fragment=&#39;target&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;http://python.org/about/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">fragment</span>
<span class="go">&#39;target&#39;</span>
</pre></div>
</div>
<p class="translated">此外，<a class="reference internal" href="../library/urllib.parse.html#urllib.parse.urlencode" title="urllib.parse.urlencode"><code class="xref py py-func docutils literal notranslate"><span class="pre">urlencode()</span></code></a> 函数现在更加灵活，可以接受字符串或字节类型作为 <em>query</em> 参数。如果是字符串，那么 <em>safe</em>、<em>encoding</em> 和 <em>error</em> 参数将被传递给 <a class="reference internal" href="../library/urllib.parse.html#urllib.parse.quote_plus" title="urllib.parse.quote_plus"><code class="xref py py-func docutils literal notranslate"><span class="pre">quote_plus()</span></code></a> 进行编码:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">([</span>
<span class="gp">... </span>     <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;telenovela&#39;</span><span class="p">),</span>
<span class="gp">... </span>     <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;¿Dónde Está Elisa?&#39;</span><span class="p">)],</span>
<span class="gp">... </span>     <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
<span class="go">&#39;type=telenovela&amp;name=%BFD%F3nde+Est%E1+Elisa%3F&#39;</span>
</pre></div>
</div>
<p class="translated">如 <a class="reference internal" href="../library/urllib.parse.html#parsing-ascii-encoded-bytes"><span class="std std-ref">解析ASCII编码字节</span></a> 中所述，所有 <a class="reference internal" href="../library/urllib.parse.html#module-urllib.parse" title="urllib.parse: Parse URLs into or assemble them from components."><code class="xref py py-mod docutils literal notranslate"><span class="pre">urllib.parse</span></code></a> 函数现在都接受 ASCII 编码的字节字符串作为输入，只要它们不与普通字符串混合。如果给定 ASCII 编码的字节字符串作为参数，返回类型也将是 ASCII 编码的字节字符串:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;http://www.python.org:80/about/&#39;</span><span class="p">)</span>
<span class="go">ParseResultBytes(scheme=b&#39;http&#39;, netloc=b&#39;www.python.org:80&#39;,</span>
<span class="go">                 path=b&#39;/about/&#39;, params=b&#39;&#39;, query=b&#39;&#39;, fragment=b&#39;&#39;)</span>
</pre></div>
</div>
<p class="translated">（由 Nick Coghlan、Dan Mahn 和 Senthil Kumaran 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2987">bpo-2987</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5468">bpo-5468</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9873">bpo-9873</a> 中提供。）</p>
</section>
<section id="mailbox">
<h3 class="translated">mailbox<a class="headerlink" href="#mailbox" title="Link to this heading">¶</a></h3>
<p class="translated">由于 R. David Murray 的共同努力，<a class="reference internal" href="../library/mailbox.html#module-mailbox" title="mailbox: Manipulate mailboxes in various formats"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mailbox</span></code></a> 模块已修复以适用于 Python 3.2。挑战在于 mailbox 最初是使用文本接口设计的，但电子邮件消息最好用 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 表示，因为消息的不同部分可能具有不同的编码。</p>
<p class="translated">解决方案利用了 <a class="reference internal" href="../library/email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code></a> 包的二进制支持来解析任意电子邮件消息。此外，解决方案还需要进行一些 API 更改。</p>
<p class="translated">如预期的那样，<a class="reference internal" href="../library/mailbox.html#mailbox.Mailbox" title="mailbox.Mailbox"><code class="xref py py-class docutils literal notranslate"><span class="pre">mailbox.Mailbox</span></code></a> 对象的 <a class="reference internal" href="../library/mailbox.html#mailbox.Mailbox.add" title="mailbox.Mailbox.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a> 方法现在接受二进制输入。</p>
<p class="translated"><a class="reference internal" href="../library/io.html#io.StringIO" title="io.StringIO"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringIO</span></code></a> 和文本文件输入已被弃用。此外，如果使用非 ASCII 字符，字符串输入将提前失败。此前它会在后续步骤处理电子邮件时失败。</p>
<p class="translated">还支持二进制输出。<a class="reference internal" href="../library/mailbox.html#mailbox.Mailbox.get_file" title="mailbox.Mailbox.get_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_file()</span></code></a> 方法现在以二进制模式返回文件（以前错误地将文件设置为文本模式）。还有一个新的 <a class="reference internal" href="../library/mailbox.html#mailbox.Mailbox.get_bytes" title="mailbox.Mailbox.get_bytes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_bytes()</span></code></a> 方法，它返回与给定 <em>key</em> 对应的 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 消息表示。</p>
<p class="translated">使用旧API的 <a class="reference internal" href="../library/mailbox.html#mailbox.Mailbox.get_string" title="mailbox.Mailbox.get_string"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_string()</span></code></a> 方法仍然可以获得非二进制输出，但这种方法并不非常有用。相反，最好是从 <a class="reference internal" href="../library/mailbox.html#mailbox.Message" title="mailbox.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code></a> 对象中提取消息，或者从二进制输入中加载它们。</p>
<p class="translated">（由R. David Murray贡献，Steffen Daode Nurpmeso参与努力，Victor Stinner在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9124">bpo-9124</a> 中提供初始补丁。）</p>
</section>
<section id="turtledemo">
<h3 class="translated">turtledemo<a class="headerlink" href="#turtledemo" title="Link to this heading">¶</a></h3>
<p class="translated"><a class="reference internal" href="../library/turtle.html#module-turtle" title="turtle: An educational framework for simple graphics applications"><code class="xref py py-mod docutils literal notranslate"><span class="pre">turtle</span></code></a> 模块的演示代码已从 <em>Demo</em> 目录移至主库。它包含十多个带有生动显示的示例脚本。由于现在位于 <a class="reference internal" href="../library/sys.html#sys.path" title="sys.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a> 中，可以直接从命令行运行：</p>
<div class="translated highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>turtledemo
</pre></div>
</div>
<p class="translated">（由Alexander Belopolsky从Demo目录移至主库，见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10199">bpo-10199</a>。）</p>
</section>
</section>
<section id="multi-threading">
<h2 class="translated">多线程<a class="headerlink" href="#multi-threading" title="Link to this heading">¶</a></h2>
<ul>
<li><p class="translated">用于序列化并发运行的Python线程的机制（通常称为 <a class="reference internal" href="../glossary.html#term-GIL"><span class="xref std std-term">GIL</span></a> 或全局解释器锁）已被重写。此次改进的目标包括：实现更可预测的线程切换间隔，以及减少因锁竞争和后续系统调用数量导致的开销。原有的&quot;检查间隔&quot;（用于控制线程切换的机制）概念已被废弃，取而代之的是以秒为单位的绝对时长。该参数可通过 <a class="reference internal" href="../library/sys.html#sys.setswitchinterval" title="sys.setswitchinterval"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.setswitchinterval()</span></code></a> 进行调节，当前默认值为5毫秒。</p>
<p class="translated">有关该实现的更多详细信息可以从 <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2009-October/093321.html">python-dev 邮件列表消息</a> 中阅读（但需注意：该消息中提到的&quot;优先级请求&quot;机制并未被最终采纳）。</p>
<p class="translated">（由 Antoine Pitrou 贡献。）</p>
</li>
<li><p class="translated">常规和递归锁现在在其 <a class="reference internal" href="../library/threading.html#threading.Lock.acquire" title="threading.Lock.acquire"><code class="xref py py-meth docutils literal notranslate"><span class="pre">acquire()</span></code></a> 方法中接受一个可选的 <em>timeout</em> 参数。（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7316">bpo-7316</a> 中贡献。）</p></li>
<li><p class="translated">同样，<a class="reference internal" href="../library/threading.html#threading.Semaphore.acquire" title="threading.Semaphore.acquire"><code class="xref py py-meth docutils literal notranslate"><span class="pre">threading.Semaphore.acquire()</span></code></a> 也增加了一个 <em>timeout</em> 参数。（由 Torsten Landschoff 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=850728">bpo-850728</a> 中贡献。)</p></li>
<li><p class="translated">在使用 Pthreads 的平台上，常规锁和递归锁的获取操作现在可以被信号中断。这意味着Python 程序在获取锁时发生死锁，可以通过反复向该进程发送 SIGINT 信号（在大多数 shell 中按下 <kbd class="kbd docutils literal notranslate">Ctrl</kbd>+<kbd class="kbd docutils literal notranslate">C</kbd>）来成功终止程序。（由 Reid Kleckner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8844">bpo-8844</a> 中贡献。）</p></li>
</ul>
</section>
<section id="optimizations">
<h2 class="translated">性能优化<a class="headerlink" href="#optimizations" title="Link to this heading">¶</a></h2>
<p class="translated">添加了一些小的性能提升：</p>
<ul>
<li><p class="translated">Python 的窥孔优化器（peephole optimizer）现在能够识别诸如 <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">in</span> <span class="pre">{1,</span> <span class="pre">2,</span> <span class="pre">3}</span></code> 这样的模式，将其判定为对常量集合的成员资格测试。优化器会将 <a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> (集合) 重新转换为 <a class="reference internal" href="../library/stdtypes.html#frozenset" title="frozenset"><code class="xref py py-class docutils literal notranslate"><span class="pre">frozenset</span></code></a> (不可变集合) ，并存储这个预先构建的常量。</p>
<p class="translated">既然速度开销已不复存在，现在可以放心地开始使用集合表示法来编写成员资格测试了。这种写法不仅语义清晰，而且执行高效：</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">extension</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">if</span> <span class="n">extension</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;xml&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;xhtml&#39;</span><span class="p">,</span> <span class="s1">&#39;css&#39;</span><span class="p">}:</span>
    <span class="n">handle</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">（补丁和附加测试由 Dave Malcolm 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6690">bpo-6690</a> 中贡献）。</p>
</li>
<li><p class="translated">使用 <a class="reference internal" href="../library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> 模块序列化和反序列化数据的速度现在快了几倍。</p>
<p class="translated">（由 Alexandre Vassalotti、 Antoine Pitrou 和 Unladen Swallow 团队在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9410">bpo-9410</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=3873">bpo-3873</a> 中贡献。）</p>
</li>
<li><p class="translated">在 <a class="reference internal" href="../library/stdtypes.html#list.sort" title="list.sort"><code class="xref py py-meth docutils literal notranslate"><span class="pre">list.sort()</span></code></a> 和 <a class="reference internal" href="../library/functions.html#sorted" title="sorted"><code class="xref py py-func docutils literal notranslate"><span class="pre">sorted()</span></code></a> 中使用的 <a class="reference external" href="https://en.wikipedia.org/wiki/Timsort">Timsort 算法</a> 现在在有 <a class="reference internal" href="../glossary.html#term-key-function"><span class="xref std std-term">键函数</span></a> 的情况下运行更快且使用更少内存。之前，列表的每个元素都会被一个临时对象包裹，该对象记住与每个元素关联的键值。现在，键和值的两个数组并行排序。这节省了排序包装器消耗的内存，并节省了委托比较所花费的时间。</p>
<p class="translated">（由 Daniel Stutzbach 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9915">bpo-9915</a> 中提交补丁。）</p>
</li>
<li><p class="translated">JSON 解码性能得到提升，且当同一字符串被用作多个键值时内存消耗降低。此外，当 <code class="docutils literal notranslate"><span class="pre">sort_keys</span></code> 参数为 True 时，JSON 编码现会启用 C 语言加速模块。</p>
<p class="translated">（由Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7451">bpo-7451</a> 中贡献，由 Raymond Hettinger 和 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10314">bpo-10314</a> 中贡献。）</p>
</li>
<li><p class="translated">递归锁（使用 <a class="reference internal" href="../library/threading.html#threading.RLock" title="threading.RLock"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.RLock()</span></code></a> API 创建）现在受益于 C 实现，这使得它们与常规锁一样快，并且比之前的纯 Python 实现快 10 到 15 倍。</p>
<p class="translated">（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=3001">bpo-3001</a> 中贡献。）</p>
</li>
<li><p class="translated">stringlib 中的快速搜索算法现在被 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>、<a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 对象的 <a class="reference internal" href="../library/stdtypes.html#str.split" title="str.split"><code class="xref py py-meth docutils literal notranslate"><span class="pre">split()</span></code></a>、<a class="reference internal" href="../library/stdtypes.html#str.rsplit" title="str.rsplit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rsplit()</span></code></a>、<a class="reference internal" href="../library/stdtypes.html#str.splitlines" title="str.splitlines"><code class="xref py py-meth docutils literal notranslate"><span class="pre">splitlines()</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#str.replace" title="str.replace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">replace()</span></code></a> 方法使用。同样，该算法也被 <a class="reference internal" href="../library/stdtypes.html#str.rfind" title="str.rfind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rfind()</span></code></a>、<a class="reference internal" href="../library/stdtypes.html#str.rindex" title="str.rindex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rindex()</span></code></a>、<a class="reference internal" href="../library/stdtypes.html#str.rsplit" title="str.rsplit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rsplit()</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#str.rpartition" title="str.rpartition"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rpartition()</span></code></a> 方法使用。</p>
<p class="translated">（由 Florent Xicluna 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7622">bpo-7622</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7462">bpo-7462</a> 中提交补丁。）</p>
</li>
<li><p class="translated">整型转字符串操作现在改为每次处理两个&quot;数字位&quot;，从而减少了除法和取模运算的次数。</p>
<p class="translated">（由 Gawain Bolton、Mark Dickinson 和 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6713">bpo-6713</a> 中提交。）</p>
</li>
</ul>
<p class="translated">还进行了其他一些小的优化。当一个操作数远大于另一个时，集合差分现在运行得更快（由 Andress Bennetts 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8685">bpo-8685</a> 中提交补丁）。<code class="xref py py-meth docutils literal notranslate"><span class="pre">array.repeat()</span></code> 方法有了更快的实现（由 Alexander Belopolsky 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1569291">bpo-1569291</a> 中提交）。<a class="reference internal" href="../library/http.server.html#http.server.BaseHTTPRequestHandler" title="http.server.BaseHTTPRequestHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseHTTPRequestHandler</span></code></a> 的缓冲更加高效（由 Andrew Schaaf 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=3709">bpo-3709</a> 中提交）。<a class="reference internal" href="../library/operator.html#operator.attrgetter" title="operator.attrgetter"><code class="xref py py-func docutils literal notranslate"><span class="pre">operator.attrgetter()</span></code></a> 函数的速度得到了提升（由 Christos Georgiou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10160">bpo-10160</a> 中提交）。<a class="reference internal" href="../library/configparser.html#configparser.ConfigParser" title="configparser.ConfigParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a> 加载多行参数的速度也有所提高（由 Łukasz Langa 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7113">bpo-7113</a> 中提交）。</p>
</section>
<section id="unicode">
<h2 class="translated">Unicode<a class="headerlink" href="#unicode" title="Link to this heading">¶</a></h2>
<p class="translated">Python 已更新到 <a class="reference external" href="https://unicode.org/versions/Unicode6.0.0/">Unicode 6.0.0</a>。此次更新新增了超过 2000 个字符，包括对手机重要的 <a class="reference external" href="https://en.wikipedia.org/wiki/Emoji">emoji</a> 符号。</p>
<p class="translated">此外，更新后的标准修改了两个卡纳达文字符（U+0CF1、U+0CF2）和一个新傣仂数字字符（U+19DA）的字符属性：前者现在可用于标识符，而后者则不再符合标识符使用要求。更多详细信息请参阅 <a class="reference external" href="https://www.unicode.org/versions/Unicode6.0.0/#Database_Changes">Unicode字符数据库变更说明</a>。</p>
</section>
<section id="codecs">
<h2 class="translated">编解码器<a class="headerlink" href="#codecs" title="Link to this heading">¶</a></h2>
<p class="translated">添加了对 <em>cp720</em> 阿拉伯 DOS 编码的支持（<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1616979">bpo-1616979</a>）。</p>
<p class="translated">MBCS 编码不再忽略错误处理程序参数。在默认的严格模式下，当遇到无法解码的字节序列时，它会引发 <a class="reference internal" href="../library/exceptions.html#UnicodeDecodeError" title="UnicodeDecodeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnicodeDecodeError</span></code></a> 异常；当遇到无法编码的字符时，会引发 <a class="reference internal" href="../library/exceptions.html#UnicodeEncodeError" title="UnicodeEncodeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnicodeEncodeError</span></code></a> 异常。</p>
<p class="translated">多字节字符集编解码器（MBCS codec）在解码时支持 <code class="docutils literal notranslate"><span class="pre">'strict'</span></code> (严格模式) 和 <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code> (忽略模式) 两种错误处理器，在编码时则支持 <code class="docutils literal notranslate"><span class="pre">'strict'</span></code> (严格模式) 和 <code class="docutils literal notranslate"><span class="pre">'replace'</span></code> (替换模式) 。</p>
<p class="translated">若需模拟 Python 3.1 版本的 MBCS 编码行为，应在解码时选用 <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code> (忽略模式) 错误处理器，而在编码时选用 <code class="docutils literal notranslate"><span class="pre">'replace'</span></code> (替换模式) 错误处理器。</p>
<p class="translated">在 Mac OS X 上，Python 使用 <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code> 而不是区域设置编码来解码命令行参数。</p>
<p class="translated">默认情况下，<a class="reference internal" href="../library/tarfile.html#module-tarfile" title="tarfile: Read and write tar-format archive files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code></a> 在 Windows 上使用 <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code> 编码格式 (而不是 <code class="docutils literal notranslate"><span class="pre">'mbcs'</span></code>) 并在所有操作系统上使用 <code class="docutils literal notranslate"><span class="pre">'surrogateescape'</span></code> 错误处理器。</p>
</section>
<section id="documentation">
<h2 class="translated">文档<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h2>
<p class="translated">文档继续得到改进。</p>
<ul>
<li><p class="translated">在长篇幅的章节（如 <a class="reference internal" href="../library/functions.html#built-in-funcs"><span class="std std-ref">内置函数</span></a>）顶部添加了一个快速链接表。以 <a class="reference internal" href="../library/itertools.html#module-itertools" title="itertools: Functions creating iterators for efficient looping."><code class="xref py py-mod docutils literal notranslate"><span class="pre">itertools</span></code></a> 为例，这些链接旁边附有速查表风格的摘要表格，无需通读完整文档即可快速掌握要点、唤醒记忆。</p></li>
<li><p class="translated">在某些情况下，纯 Python 源代码可以作为文档的有益补充，因此现在许多模块都提供了指向最新版本源代码的快速链接。例如，<a class="reference internal" href="../library/functools.html#module-functools" title="functools: Higher-order functions and operations on callable objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">functools</span></code></a> 模块文档顶部有一个快速链接，标记为：</p>
<blockquote>
<div><p class="translated"><strong>源代码</strong> <a class="extlink-source reference external" href="https://github.com/python/cpython/tree/3.14/Lib/functools.py">Lib/functools.py</a>。</p>
</div></blockquote>
<p class="translated">（由 Raymond Hettinger 贡献，参见 <a class="reference external" href="https://rhettinger.wordpress.com/2011/01/28/open-your-source-more/">rationale</a>。）</p>
</li>
<li><p class="translated">当前文档现包含更多实用示例与技巧指南。特别地，<a class="reference internal" href="../library/re.html#module-re" title="re: Regular expression operations."><code class="xref py py-mod docutils literal notranslate"><span class="pre">re</span></code></a> 模块新增了内容详尽的正则表达式示例专章 <a class="reference internal" href="../library/re.html#re-examples"><span class="std std-ref">正则表达式例子</span></a>；同样地，<a class="reference internal" href="../library/itertools.html#module-itertools" title="itertools: Functions creating iterators for efficient looping."><code class="xref py py-mod docutils literal notranslate"><span class="pre">itertools</span></code></a> 模块也持续更新，不断增添新的迭代器工具配方 <a class="reference internal" href="../library/itertools.html#itertools-recipes"><span class="std std-ref">itertools 配方</span></a>。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/datetime.html#module-datetime" title="datetime: Basic date and time types."><code class="xref py py-mod docutils literal notranslate"><span class="pre">datetime</span></code></a> 模块现在有一个纯 Python 的辅助实现。功能没有变化。这只是为了提供一个更易读的替代实现。</p>
<p class="translated">（由 Alexander Belopolsky 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9528">bpo-9528</a> 中贡献。）</p>
</li>
<li><p class="translated">未维护的 <code class="file docutils literal notranslate"><span class="pre">Demo</span></code> 目录已被删除。一些演示被整合到文档中，一些被移动到 <code class="file docutils literal notranslate"><span class="pre">Tools/demo</span></code> 目录，其他的则被完全删除。</p>
<p class="translated">（由 Georg Brandl 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7962">bpo-7962</a> 中贡献）</p>
</li>
</ul>
</section>
<section id="idle">
<h2 class="translated">IDLE<a class="headerlink" href="#idle" title="Link to this heading">¶</a></h2>
<ul>
<li><p class="translated">格式菜单现在有一个选项，用于通过删除尾部空格来清理源文件。</p>
<p class="translated">（由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5150">bpo-5150</a> 中贡献。）</p>
</li>
<li><p class="translated">Mac OS X 上的 IDLE 现在既支持 Carbon AquaTk 也支持 Cocoa AquaTk。</p>
<p class="translated">（由 Kevin Walzer、Ned Deily 和 Ronald Oussoren 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6075">bpo-6075</a> 中贡献。）</p>
</li>
</ul>
</section>
<section id="code-repository">
<h2 class="translated">代码库<a class="headerlink" href="#code-repository" title="Link to this heading">¶</a></h2>
<p class="translated">除了现有的 Subversion 代码仓库位于 <a class="reference external" href="https://svn.python.org">https://svn.python.org</a> 外，现在还有一个 <a class="reference external" href="https://www.mercurial-scm.org/">Mercurial</a> 仓库位于 <a class="reference external" href="https://hg.python.org/">https://hg.python.org/</a>。</p>
<p class="translated">在 3.2 版本发布后，计划将 Mercurial 作为主要仓库。这种分布式版本控制系统应使社区成员更容易创建和共享外部更改集。详见 <span class="target" id="index-44"></span><a class="pep reference external" href="https://peps.python.org/pep-0385/"><strong>PEP 385</strong></a>。</p>
<p class="translated">要学习使用新的版本控制系统，请参阅 <a class="reference external" href="https://www.mercurial-scm.org/wiki/QuickStart">快速入门</a> 或 <a class="reference external" href="https://www.mercurial-scm.org/guide">Mercurial工作流指南</a>。</p>
</section>
<section id="build-and-c-api-changes">
<h2 class="translated">构建和 C API 的改变<a class="headerlink" href="#build-and-c-api-changes" title="Link to this heading">¶</a></h2>
<p class="translated">针对 Python 构建过程和 C API 的改变包括:</p>
<ul>
<li><p class="translated">现在 <em>idle</em>、 <em>pydoc</em> 和 <em>2to3</em> 脚本的安装将在 <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">altinstall</span></code> 中附带特定版本的后缀 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10679">bpo-10679</a>)。</p></li>
<li><p class="translated">访问 Unicode 数据库的 C 函数现在接受并返回完整 Unicode 范围内的字符，即使在窄 Unicode 构建中也是如此（Py_UNICODE_TOLOWER、Py_UNICODE_ISDECIMAL 等）。在 Python 中可见的区别是 <a class="reference internal" href="../library/unicodedata.html#unicodedata.numeric" title="unicodedata.numeric"><code class="xref py py-func docutils literal notranslate"><span class="pre">unicodedata.numeric()</span></code></a> 现在为大代码点返回正确的值，而 <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code></a> 可能有更多字符被视为可打印。</p>
<p class="translated">（由 Bupjoe Lee 报告，Amaury Forgeot D'Arc 修复；参见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5127">bpo-5127</a> 。）</p>
</li>
<li><p class="translated">计算跳转（computed gotos）现在在支持的编译器（支持情况由配置脚本检测）上默认启用。仍可通过指定 <code class="docutils literal notranslate"><span class="pre">--without-computed-gotos</span></code> 选择性禁用。</p>
<p class="translated">（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9203">bpo-9203</a> 中贡献。）</p>
</li>
<li><p class="translated">选项 <code class="docutils literal notranslate"><span class="pre">--with-wctype-functions</span></code> 已被移除。内置的 Unicode 数据库现在用于所有函数。</p>
<p class="translated">（由 Amaury Forgeot d'Arc 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9210">bpo-9210</a> 中贡献。）</p>
</li>
<li><p class="translated">哈希值现在采用一种新类型 <a class="reference internal" href="../c-api/hash.html#c.Py_hash_t" title="Py_hash_t"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_hash_t</span></code></a> 的值，该类型被定义为与指针具有相同的大小。此前，哈希值的类型为 long，在某些 64 位操作系统上，long 仍然只有 32 位长。得益于这一改进，<a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#dict" title="dict"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> 现在可以在使用 64 位指针的构建版本中容纳超过 <code class="docutils literal notranslate"><span class="pre">2**32</span></code> 个条目（此前，虽然它们能够增长到该规模，但其性能会急剧下降）。</p>
<p class="translated">（由 Raymond Hettinger 建议，Benjamin Peterson 实现；参见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9778">bpo-9778</a>。）</p>
</li>
<li><p class="translated">一个新的宏 <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_VA_COPY</span></code> 复制可变参数列表的状态。它等同于 C99 的 <em>va_copy</em>，但在所有 Python 平台上都可用（<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2443">bpo-2443</a>）。</p></li>
<li><p class="translated">一个新的 C API 函数 <code class="xref c c-func docutils literal notranslate"><span class="pre">PySys_SetArgvEx()</span></code> 允许嵌入式解释器设置 <a class="reference internal" href="../library/sys.html#sys.argv" title="sys.argv"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.argv</span></code></a> 而不修改 <a class="reference internal" href="../library/sys.html#sys.path" title="sys.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a> (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5753">bpo-5753</a>)。</p></li>
<li><p class="translated"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_CallObject()</span></code> 现在仅以宏形式提供。为了向后兼容而保留的函数声明现已移除——该宏于1997年引入 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8276">bpo-8276</a>)。</p></li>
<li><p class="translated">新增函数 <a class="reference internal" href="../c-api/long.html#c.PyLong_AsLongLongAndOverflow" title="PyLong_AsLongLongAndOverflow"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyLong_AsLongLongAndOverflow()</span></code></a>，它与 <a class="reference internal" href="../c-api/long.html#c.PyLong_AsLongAndOverflow" title="PyLong_AsLongAndOverflow"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyLong_AsLongAndOverflow()</span></code></a> 类似。它们都用于将 Python <a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> 转换为本地固定宽度类型，并提供检测转换不匹配的情况 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7767">bpo-7767</a>)。</p></li>
<li><p class="translated"><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_CompareWithASCIIString" title="PyUnicode_CompareWithASCIIString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_CompareWithASCIIString()</span></code></a> 函数现在在 Python 字符串以 <em>NUL</em> 结尾时返回 <em>不相等</em>。</p></li>
<li><p class="translated">新增函数 <a class="reference internal" href="../c-api/exceptions.html#c.PyErr_NewExceptionWithDoc" title="PyErr_NewExceptionWithDoc"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_NewExceptionWithDoc()</span></code></a>，类似于 <a class="reference internal" href="../c-api/exceptions.html#c.PyErr_NewException" title="PyErr_NewException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_NewException()</span></code></a>，但允许指定文档字符串。这使得 C 语言实现的异常能够像纯 Python 异常一样具备自文档化能力 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7033">bpo-7033</a>)。</p></li>
<li><p class="translated">当使用 <code class="docutils literal notranslate"><span class="pre">--with-valgrind</span></code> 选项编译时，pymalloc 分配器在 Valgrind 下运行时会自动禁用。这提高了在 Valgrind 下运行时的内存泄漏检测能力，同时在其他时候利用 pymalloc (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2422">bpo-2422</a>)。</p></li>
<li><p class="translated">从 <em>PyArg_Parse</em> 函数中移除了 <code class="docutils literal notranslate"><span class="pre">O?</span></code> 格式。该格式不再使用，且从未被文档化 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8837">bpo-8837</a>)。</p></li>
</ul>
<p class="translated">C-API 还有一些其他小改动。详见 <a class="reference external" href="https://github.com/python/cpython/blob/v3.2.6/Misc/NEWS">Misc/NEWS</a> 文件以获取完整列表。</p>
<p class="translated">此外，Mac OS X 构建版本进行了多项更新，详细信息请参阅 <a class="reference external" href="https://github.com/python/cpython/blob/v3.2.6/Mac/BuildScript/README.txt">Mac/BuildScript/README.txt</a>。对于运行32/64位构建版本的用户，已知在Mac OS X 10.6上默认的Tcl/Tk存在问题。因此，我们建议安装更新的替代版本，例如 <a class="reference external" href="https://web.archive.org/web/20101208191259/https://www.activestate.com/activetcl/downloads">ActiveState Tcl/Tk 8.5.9</a>。更多详情请访问 <a class="reference external" href="https://www.python.org/download/mac/tcltk/">https://www.python.org/download/mac/tcltk/</a>。</p>
</section>
<section id="porting-to-python-3-2">
<h2 class="translated">移植到 Python 3.2<a class="headerlink" href="#porting-to-python-3-2" title="Link to this heading">¶</a></h2>
<p class="translated">本节列出了先前描述的变更以及可能需要修改你的代码的其他问题修正:</p>
<ul>
<li><p class="translated"><a class="reference internal" href="../library/configparser.html#module-configparser" title="configparser: Configuration file parser."><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> 模块进行了一系列清理工作。主要变化是将旧的 <code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code> 类替换为长期以来首选的替代类 <code class="xref py py-class docutils literal notranslate"><span class="pre">SafeConfigParser</span></code>。此外，还有一些较小的兼容性问题：</p>
<ul class="simple">
<li><p class="translated">插值语法现在在 <a class="reference internal" href="../library/configparser.html#configparser.ConfigParser.get" title="configparser.ConfigParser.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> 和 <a class="reference internal" href="../library/configparser.html#configparser.ConfigParser.set" title="configparser.ConfigParser.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a> 操作中进行验证。在默认的插值方案中，只有两个带有百分号的标记是有效的：<code class="docutils literal notranslate"><span class="pre">%(name)s</span></code> 和 <code class="docutils literal notranslate"><span class="pre">%%</span></code>，后者是转义后的百分号。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/configparser.html#configparser.ConfigParser.set" title="configparser.ConfigParser.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a> 和 <a class="reference internal" href="../library/configparser.html#configparser.ConfigParser.add_section" title="configparser.ConfigParser.add_section"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_section()</span></code></a> 方法现在验证值是否为实际的字符串。以前，可能会无意引入不支持的类型。</p></li>
<li><p class="translated">来自单个源的重复节或选项现在会引发 <a class="reference internal" href="../library/configparser.html#configparser.DuplicateSectionError" title="configparser.DuplicateSectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DuplicateSectionError</span></code></a> 或 <a class="reference internal" href="../library/configparser.html#configparser.DuplicateOptionError" title="configparser.DuplicateOptionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DuplicateOptionError</span></code></a>。此前，重复项会默默地覆盖先前的条目。</p></li>
<li><p class="translated">内联注释现在默认禁用，因此现在可以安全地在值中使用 <strong>;</strong> 字符。</p></li>
<li><p class="translated">注释现在可以缩进。因此，为了在多行值的行首出现 <strong>;</strong> 或 <strong>#</strong>，必须进行插值。这样可以防止值中的注释前缀字符被误认为是注释。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> 现在是一个有效值，不再自动转换为空字符串。对于空字符串，请在行中使用 <code class="docutils literal notranslate"><span class="pre">&quot;option</span> <span class="pre">=&quot;</span></code>。</p></li>
</ul>
</li>
<li><p class="translated"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nntplib</span></code> 模块进行了大量重写，这意味着其 API 通常与 3.1 版本的 API 不兼容。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> 对象不能再用作文件名；相反，它们应该转换为 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>。</p></li>
<li><p class="translated"><code class="xref py py-meth docutils literal notranslate"><span class="pre">array.tostring()</span></code> 和 <code class="xref py py-meth docutils literal notranslate"><span class="pre">array.fromstring()</span></code> 已更名为 <a class="reference internal" href="../library/array.html#array.array.tobytes" title="array.array.tobytes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">array.tobytes()</span></code></a> 和 <a class="reference internal" href="../library/array.html#array.array.frombytes" title="array.array.frombytes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">array.frombytes()</span></code></a> 以提高清晰度。旧名称已被弃用。（参见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8990">bpo-8990</a>。）</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">PyArg_Parse*()</span></code> 函数:</p>
<ul class="simple">
<li><p class="translated">&quot;t#&quot; 格式已被移除：改用 &quot;s#&quot; 或 &quot;s*&quot;</p></li>
<li><p class="translated">&quot;w&quot; 和 &quot;w#&quot; 格式已被移除：改用 &quot;w*&quot;</p></li>
</ul>
</li>
<li><p class="translated">在 3.1 版本中已被弃用的 <code class="xref c c-type docutils literal notranslate"><span class="pre">PyCObject</span></code> 类型已被移除。为了在 Python 对象中包装不透明的 C 指针，应使用 <a class="reference internal" href="../c-api/capsule.html#c.PyCapsule" title="PyCapsule"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyCapsule</span></code></a> API；新类型具有明确定义的接口，用于传递类型安全信息，并且调用析构函数的签名更简单。</p></li>
<li><p class="translated"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.setfilesystemencoding()</span></code> 函数已被移除，因为其设计存在缺陷。</p></li>
<li><p class="translated"><a class="reference internal" href="../library/random.html#random.seed" title="random.seed"><code class="xref py py-func docutils literal notranslate"><span class="pre">random.seed()</span></code></a> 函数和方法现在使用 sha512 哈希函数对字符串种子进行加盐。为了访问以前版本的 <em>seed</em> 以重现 Python 3.1 序列，将 <em>version</em> 参数设置为 <em>1</em>，即 <code class="docutils literal notranslate"><span class="pre">random.seed(s,</span> <span class="pre">version=1)</span></code>。</p></li>
<li><p class="translated">此前已弃用的 <code class="xref py py-func docutils literal notranslate"><span class="pre">string.maketrans()</span></code> 函数已被移除，取而代之的是静态方法 <a class="reference internal" href="../library/stdtypes.html#bytes.maketrans" title="bytes.maketrans"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bytes.maketrans()</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#bytearray.maketrans" title="bytearray.maketrans"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bytearray.maketrans()</span></code></a>。这一变更解决了关于 <a class="reference internal" href="../library/string.html#module-string" title="string: Common string operations."><code class="xref py py-mod docutils literal notranslate"><span class="pre">string</span></code></a> 模块支持哪些数据类型的混淆问题。现在，<a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>、<a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> 类型各自拥有独立的 <strong>maketrans</strong> 和 <strong>translate</strong> 方法，并会生成与相应类型匹配的中间转换表。</p>
<p class="translated">（由Georg Brandl在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5675">bpo-5675</a> 中贡献）</p>
</li>
<li><p class="translated">此前已弃用的 <code class="xref py py-func docutils literal notranslate"><span class="pre">contextlib.nested()</span></code> 函数已被移除，改为使用普通的 <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 语句，该语句可以接受多个上下文管理器。后一种技术在速度上更快（因为它是内置的），并且在其中一个上下文管理器引发异常时，能更好地完成多个上下文管理器的终结处理:</p>
<div class="translated highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;mylog.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;a.out&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;&lt;critical&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">（由 Georg Brandl 和 Mattias Brändström 贡献; <a class="reference external" href="https://codereview.appspot.com/53094">appspot issue 53094</a>。）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../library/struct.html#struct.pack" title="struct.pack"><code class="xref py py-func docutils literal notranslate"><span class="pre">struct.pack()</span></code></a> 现在只允许使用字节类型（bytes）作为 <code class="docutils literal notranslate"><span class="pre">s</span></code> 字符串打包代码的参数。此前，该函数会接受文本类型（text）参数，并隐式地使用 UTF-8 编码将其转换为字节类型。这种做法存在两个问题：一是它对正确的编码方式做了预设假设；二是在将变长编码写入结构的固定长度字段时可能会导致失败。</p>
<p class="translated">类似于 <code class="docutils literal notranslate"><span class="pre">struct.pack('&lt;6sHHBBB',</span> <span class="pre">'GIF87a',</span> <span class="pre">x,</span> <span class="pre">y)</span></code> 的代码应重写为使用字节串而不是文本，即 <code class="docutils literal notranslate"><span class="pre">struct.pack('&lt;6sHHBBB',</span> <span class="pre">b'GIF87a',</span> <span class="pre">x,</span> <span class="pre">y)</span></code>。</p>
<p class="translated">（由 David Beazley 发现，并由 Victor Stinner 修复；参见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10783">bpo-10783</a>。）</p>
</li>
<li><p class="translated"><a class="reference internal" href="../library/xml.etree.elementtree.html#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code class="xref py py-class docutils literal notranslate"><span class="pre">xml.etree.ElementTree</span></code></a> 类在解析失败时现在会抛出 <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.ParseError" title="xml.etree.ElementTree.ParseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">xml.etree.ElementTree.ParseError</span></code></a>。之前，它会抛出 <a class="reference internal" href="../library/pyexpat.html#xml.parsers.expat.ExpatError" title="xml.parsers.expat.ExpatError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">xml.parsers.expat.ExpatError</span></code></a>。</p></li>
<li><p class="translated">新的、更长的浮点数 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code></a> 输出格式可能会导致依赖旧输出格式的 doctest 测试用例失效。</p></li>
<li><p class="translated">在 <a class="reference internal" href="../library/subprocess.html#subprocess.Popen" title="subprocess.Popen"><code class="xref py py-class docutils literal notranslate"><span class="pre">subprocess.Popen</span></code></a> 中，<em>close_fds</em> 的默认值在 Unix 上现在为 <code class="docutils literal notranslate"><span class="pre">True</span></code>；在 Windows 上，如果三个标准流均设置为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，否则为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。之前，<em>close_fds</em> 默认总是 <code class="docutils literal notranslate"><span class="pre">False</span></code>，这会导致打开的文件描述符泄露到子进程中，产生难以解决的错误或竞争条件。</p></li>
<li><p class="translated">对旧式 HTTP 0.9 的支持已从 <a class="reference internal" href="../library/urllib.request.html#module-urllib.request" title="urllib.request: Extensible library for opening URLs."><code class="xref py py-mod docutils literal notranslate"><span class="pre">urllib.request</span></code></a> 和 <a class="reference internal" href="../library/http.client.html#module-http.client" title="http.client: HTTP and HTTPS protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">http.client</span></code></a> 中移除。 此项支持仍然存在于服务器端（在 <a class="reference internal" href="../library/http.server.html#module-http.server" title="http.server: HTTP server and request handlers."><code class="xref py py-mod docutils literal notranslate"><span class="pre">http.server</span></code></a> 中）。</p>
<p class="translated">（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10711">bpo-10711</a> 中贡献。）</p>
</li>
<li><p class="translated">超时模式下的 SSL 套接字现在如发生超时则会引发 <a class="reference internal" href="../library/socket.html#socket.timeout" title="socket.timeout"><code class="xref py py-exc docutils literal notranslate"><span class="pre">socket.timeout</span></code></a>，而不是一般性的 <a class="reference internal" href="../library/ssl.html#ssl.SSLError" title="ssl.SSLError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SSLError</span></code></a>。</p>
<p class="translated">（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10272">bpo-10272</a> 中贡献。）</p>
</li>
<li><p class="translated">有误导性的 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_AcquireLock()</span></code> 和 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_ReleaseLock()</span></code> 已正式被弃用。 应当改用可感知线程状态的 API (如 <a class="reference internal" href="../c-api/init.html#c.PyEval_SaveThread" title="PyEval_SaveThread"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_SaveThread()</span></code></a> 和 <a class="reference internal" href="../c-api/init.html#c.PyEval_RestoreThread" title="PyEval_RestoreThread"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_RestoreThread()</span></code></a>)。</p></li>
<li><p class="translated">由于存在安全风险，<code class="xref py py-func docutils literal notranslate"><span class="pre">asyncore.handle_accept()</span></code> 已被弃用，新增了一个函数 <code class="xref py py-func docutils literal notranslate"><span class="pre">asyncore.handle_accepted()</span></code> 用来替代它。</p>
<p class="translated">（由 Giampaolo Rodola 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6706">bpo-6706</a> 中贡献。）</p>
</li>
<li><p class="translated">由于新的 <a class="reference internal" href="../glossary.html#term-GIL"><span class="xref std std-term">GIL</span></a> 实现的限制，<code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_InitThreads()</span></code> 不再可以在 <a class="reference internal" href="../c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a> 之前被调用。</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Python 3.2 有什么新变化</a><ul>
<li><a class="reference internal" href="#pep-384-defining-a-stable-abi">PEP 384: 定义稳定的ABI</a></li>
<li><a class="reference internal" href="#pep-389-argparse-command-line-parsing-module">PEP 389: Argparse 命令行解析模块</a></li>
<li><a class="reference internal" href="#pep-391-dictionary-based-configuration-for-logging">PEP 391:  基于字典的日志配置</a></li>
<li><a class="reference internal" href="#pep-3148-the-concurrent-futures-module">PEP 3148:  <code class="docutils literal notranslate"><span class="pre">concurrent.futures</span></code> 模块</a></li>
<li><a class="reference internal" href="#pep-3147-pyc-repository-directories">PEP 3147: PYC 仓库目录</a></li>
<li><a class="reference internal" href="#pep-3149-abi-version-tagged-so-files">PEP 3149: 带有 ABI 版本标签的 .so 文件</a></li>
<li><a class="reference internal" href="#pep-3333-python-web-server-gateway-interface-v1-0-1">PEP 3333: Python Web服务器网关接口v1.0.1</a></li>
<li><a class="reference internal" href="#other-language-changes">其他语言特性修改</a></li>
<li><a class="reference internal" href="#new-improved-and-deprecated-modules">新增、改进和弃用的模块</a><ul>
<li><a class="reference internal" href="#email">email</a></li>
<li><a class="reference internal" href="#elementtree">elementtree</a></li>
<li><a class="reference internal" href="#functools">functools</a></li>
<li><a class="reference internal" href="#itertools">itertools</a></li>
<li><a class="reference internal" href="#collections">collections</a></li>
<li><a class="reference internal" href="#threading">threading</a></li>
<li><a class="reference internal" href="#datetime-and-time">datetime 和 time</a></li>
<li><a class="reference internal" href="#math">math</a></li>
<li><a class="reference internal" href="#abc">abc(抽象基类)</a></li>
<li><a class="reference internal" href="#io">io</a></li>
<li><a class="reference internal" href="#reprlib">reprlib</a></li>
<li><a class="reference internal" href="#logging">logging</a></li>
<li><a class="reference internal" href="#csv">csv</a></li>
<li><a class="reference internal" href="#contextlib">contextlib</a></li>
<li><a class="reference internal" href="#decimal-and-fractions">decimal 和 fractions</a></li>
<li><a class="reference internal" href="#ftp">ftp</a></li>
<li><a class="reference internal" href="#popen">popen</a></li>
<li><a class="reference internal" href="#select">select</a></li>
<li><a class="reference internal" href="#gzip-and-zipfile">gzip 和 zipfile</a></li>
<li><a class="reference internal" href="#tarfile">tarfile</a></li>
<li><a class="reference internal" href="#hashlib">hashlib</a></li>
<li><a class="reference internal" href="#ast">ast</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#shutil">shutil</a></li>
<li><a class="reference internal" href="#sqlite3">sqlite3</a></li>
<li><a class="reference internal" href="#html">html</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#ssl">ssl</a></li>
<li><a class="reference internal" href="#nntp">nntp</a></li>
<li><a class="reference internal" href="#certificates">certificates</a></li>
<li><a class="reference internal" href="#imaplib">imaplib</a></li>
<li><a class="reference internal" href="#http-client">http.client</a></li>
<li><a class="reference internal" href="#unittest">unittest</a></li>
<li><a class="reference internal" href="#random">random</a></li>
<li><a class="reference internal" href="#poplib">poplib</a></li>
<li><a class="reference internal" href="#asyncore">asyncore</a></li>
<li><a class="reference internal" href="#tempfile">tempfile</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#pydoc">pydoc</a></li>
<li><a class="reference internal" href="#dis">dis</a></li>
<li><a class="reference internal" href="#dbm">dbm</a></li>
<li><a class="reference internal" href="#ctypes">ctypes</a></li>
<li><a class="reference internal" href="#site">site</a></li>
<li><a class="reference internal" href="#sysconfig">sysconfig</a></li>
<li><a class="reference internal" href="#pdb">pdb</a></li>
<li><a class="reference internal" href="#configparser">configparser</a></li>
<li><a class="reference internal" href="#urllib-parse">urllib.parse</a></li>
<li><a class="reference internal" href="#mailbox">mailbox</a></li>
<li><a class="reference internal" href="#turtledemo">turtledemo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multi-threading">多线程</a></li>
<li><a class="reference internal" href="#optimizations">性能优化</a></li>
<li><a class="reference internal" href="#unicode">Unicode</a></li>
<li><a class="reference internal" href="#codecs">编解码器</a></li>
<li><a class="reference internal" href="#documentation">文档</a></li>
<li><a class="reference internal" href="#idle">IDLE</a></li>
<li><a class="reference internal" href="#code-repository">代码库</a></li>
<li><a class="reference internal" href="#build-and-c-api-changes">构建和 C API 的改变</a></li>
<li><a class="reference internal" href="#porting-to-python-3-2">移植到 Python 3.2</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一主题</h4>
    <p class="topless"><a href="3.3.html"
                          title="上一章">Python 3.3 有什么新变化</a></p>
  </div>
  <div>
    <h4>下一主题</h4>
    <p class="topless"><a href="3.1.html"
                          title="下一章">Python 3.1 有什么新变化</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">报告代码错误</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/whatsnew/3.2.rst?plain=1"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </div>
<div id="sidebarbutton" title="折叠边栏">
<span>«</span>
</div>

      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="Related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="3.1.html" title="Python 3.1 有什么新变化"
             >下一页</a> |</li>
        <li class="right" >
          <a href="3.3.html" title="Python 3.3 有什么新变化"
             >上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="Python logo" style="vertical-align: middle; margin-top: -1px"></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.14.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python的新变化</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python 3.2 有什么新变化</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="search" name="q" id="search-box">
          <input type="submit" value="转到">
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    主题
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>自动</option>
        <option value="light">明亮</option>
        <option value="dark">黑暗</option>
    </select>
</label> |</li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">版权</a> 2001 Python Software Foundation.
    <br>
    本页面采用 Python 软件基金会许可证第 2 版授权。
    <br>
    文档中的示例、代码片段及其他代码内容额外采用零条款 BSD 许可证授权。
    <br>
    
      更多信息请参阅《<a href="/license.html"> 历史与许可 </a>》。<br>
    
    
    <br>

    Python 软件基金会是一家非营利性公司。
<a href="https://www.python.org/psf/donations/">请进行捐赠。</a>
<br>
    <br>
      最后更新于11月 25, 2025 (07:24 UTC) 。
    
      <a href="/bugs.html">发现了错误</a>？
    
    <br>

    使用<a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3 创建。
    </div>

  </body>
</html>