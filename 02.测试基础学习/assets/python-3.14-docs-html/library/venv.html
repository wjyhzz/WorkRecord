<!DOCTYPE html>

<html lang="zh-CN" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="venv --- 虚拟环境的创建" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://docs.python.org/3/library/venv.html" />
<meta property="og:site_name" content="Python documentation" />
<meta property="og:description" content="源码： Lib/venv/ venv 模块支持创建轻量的“虚拟环境”，每个虚拟环境将拥有它们自己独立的安装在其 site 目录中的 Python 软件包集合。 虚拟环境是在现有的 Python 安装版基础之上创建的，这被称为虚拟环境的“基础”Python，并且默认与基础环境中的软件包隔离开来，这样只有在虚拟环境中显式安装的软件包才是可用的。 有关更多信息，请参阅 虚拟环境 和 site 的 ..." />
<meta property="og:image:width" content="1146" />
<meta property="og:image:height" content="600" />
<meta property="og:image" content="https://docs.python.org/3.14/zh-cn/_images/social_previews/summary_library_venv_6512d628.png" />
<meta property="og:image:alt" content="源码： Lib/venv/ venv 模块支持创建轻量的“虚拟环境”，每个虚拟环境将拥有它们自己独立的安装在其 site 目录中的 Python 软件包集合。 虚拟环境是在现有的 Python 安装版基础之上创建的，这被称为虚拟环境的“基础”Python，并且默认与基础环境中的软件包隔离开来，这样只有在虚拟环境中显式安装的软件包才是可用的。 有关更多信息，请参阅 虚拟环境 和 site 的 ..." />
<meta name="description" content="源码： Lib/venv/ venv 模块支持创建轻量的“虚拟环境”，每个虚拟环境将拥有它们自己独立的安装在其 site 目录中的 Python 软件包集合。 虚拟环境是在现有的 Python 安装版基础之上创建的，这被称为虚拟环境的“基础”Python，并且默认与基础环境中的软件包隔离开来，这样只有在虚拟环境中显式安装的软件包才是可用的。 有关更多信息，请参阅 虚拟环境 和 site 的 ..." />
<meta name="twitter:card" content="summary_large_image" />
<meta name="theme-color" content="#3776ab">

    <title>venv --- 虚拟环境的创建 &#8212; Python 3.14.0 文档</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css?v=234b1a7c" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css?v=8cd84f99" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=5349f25f" />
    
    <script src="../_static/documentation_options.js?v=a595ec0e"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Python 3.14.0 文档 中搜索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="关于此文档" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="copyright" title="版权" href="../copyright.html" />
    <link rel="next" title="zipapp --- 管理可执行的 Python zip 归档文件" href="zipapp.html" />
    <link rel="prev" title="ensurepip --- 初始设置 pip 安装器" href="ensurepip.html" />
    
      
      <script defer file-types="bz2,epub,zip" data-domain="docs.python.org" src="https://analytics.python.org/js/script.file-downloads.outbound-links.js"></script>
      
      <link rel="canonical" href="https://docs.python.org/3/library/venv.html">
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="stylesheet" href="../_static/pydoctheme_dark.css" media="(prefers-color-scheme: dark)" id="pydoctheme_dark_css">
    <link rel="shortcut icon" type="image/png" href="../_static/py.svg">
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script>
            <script type="text/javascript" src="../_static/search-focus.js"></script>
            <script type="text/javascript" src="../_static/themetoggle.js"></script> 
            <script type="text/javascript" src="../_static/rtd_switcher.js"></script>
            <meta name="readthedocs-addons-api-version" content="1">

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="菜单">
    <nav class="nav-content" role="navigation">
        <label for="menuToggler" class="toggler__label">
            <span></span>
        </label>
        <span class="nav-items-wrapper">
            <a href="https://www.python.org/" class="nav-logo">
                <img src="../_static/py.svg" alt="Python logo">
            </a>
            <span class="version_switcher_placeholder"></span>
            <form role="search" class="search" action="../search.html" method="get">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                    <path fill-rule="nonzero" fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                </svg>
                <input placeholder="快速搜索" aria-label="快速搜索" type="search" name="q">
                <input type="submit" value="转到">
            </form>
        </span>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
            
<label class="theme-selector-label">
    主题
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>自动</option>
        <option value="light">明亮</option>
        <option value="dark">黑暗</option>
    </select>
</label>
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code> --- 虚拟环境的创建</a><ul>
<li><a class="reference internal" href="#creating-virtual-environments">创建虚拟环境</a></li>
<li><a class="reference internal" href="#how-venvs-work">虚拟环境是如何实现的</a></li>
<li><a class="reference internal" href="#api">API</a></li>
<li><a class="reference internal" href="#an-example-of-extending-envbuilder">一个扩展 <code class="docutils literal notranslate"><span class="pre">EnvBuilder</span></code> 的例子</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一主题</h4>
    <p class="topless"><a href="ensurepip.html"
                          title="上一章"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ensurepip</span></code> --- 初始设置 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 安装器</a></p>
  </div>
  <div>
    <h4>下一主题</h4>
    <p class="topless"><a href="zipapp.html"
                          title="下一章"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zipapp</span></code> --- 管理可执行的 Python zip 归档文件</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">报告代码错误</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/library/venv.rst?plain=1"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="Related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="zipapp.html" title="zipapp --- 管理可执行的 Python zip 归档文件"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="ensurepip.html" title="ensurepip --- 初始设置 pip 安装器"
             accesskey="P">上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="Python logo" style="vertical-align: middle; margin-top: -1px"></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.14.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 标准库</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="distribution.html" accesskey="U">软件打包和分发</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code> --- 虚拟环境的创建</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="search" name="q" id="search-box">
          <input type="submit" value="转到">
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    主题
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>自动</option>
        <option value="light">明亮</option>
        <option value="dark">黑暗</option>
    </select>
</label> |</li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-venv">
<span id="venv-creation-of-virtual-environments"></span><h1 class="translated"><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code> --- 虚拟环境的创建<a class="headerlink" href="#module-venv" title="Link to this heading">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.3.</span></p>
</div>
<p class="translated"><strong>源码：</strong> <a class="extlink-source reference external" href="https://github.com/python/cpython/tree/3.14/Lib/venv/">Lib/venv/</a></p>
<hr class="docutils" id="index-0" />
<p class="translated" id="venv-intro"><span id="venv-def"></span><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code> 模块支持创建轻量的“虚拟环境”，每个虚拟环境将拥有它们自己独立的安装在其 <a class="reference internal" href="site.html#module-site" title="site: Module responsible for site-specific configuration."><code class="xref py py-mod docutils literal notranslate"><span class="pre">site</span></code></a> 目录中的 Python 软件包集合。 虚拟环境是在现有的 Python 安装版基础之上创建的，这被称为虚拟环境的“基础”Python，并且默认与基础环境中的软件包隔离开来，这样只有在虚拟环境中显式安装的软件包才是可用的。 有关更多信息，请参阅 <a class="reference internal" href="sys_path_init.html#sys-path-init-virtual-environments"><span class="std std-ref">虚拟环境</span></a> 和 <a class="reference internal" href="site.html#module-site" title="site: Module responsible for site-specific configuration."><code class="xref py py-mod docutils literal notranslate"><span class="pre">site</span></code></a> 的 <a class="reference internal" href="site.html#site-virtual-environments-configuration"><span class="std std-ref">虚拟环境文档</span></a>。</p>
<p class="translated">当在虚拟环境中使用时，常见安装工具如 <a class="extlink-pypi reference external" href="https://pypi.org/project/pip/">pip</a> 将把 Python 软件包安装到虚拟环境而无需显式地指明这一点。</p>
<p class="translated">虚拟环境是（主要的特性）：</p>
<ul class="simple">
<li><p class="translated">用来包含支持一个项目（库或应用程序）所需的特定 Python 解释器、软件库和二进制文件。 它们在默认情况下与其他虚拟环境中的软件以及操作系统中安装的 Python 解释器和库保持隔离。</p></li>
<li><p class="translated">包含在一个目录中，根据惯例被命名为项目目录下的 <code class="docutils literal notranslate"><span class="pre">.venv</span></code> 或 <code class="docutils literal notranslate"><span class="pre">venv</span></code>，或是有许多虚拟环境的容器目录下，如 <code class="docutils literal notranslate"><span class="pre">~/.virtualenvs</span></code>。</p></li>
<li><p class="translated">不可签入 Git 等源代码控制系统。</p></li>
<li><p class="translated">被认为是可丢弃的 -- 它应当能被简单地删除并从头开始重建。 你不应在此环境中放置任何项目代码。</p></li>
<li><p class="translated">不被视为是可移动或可复制的 —— 你只能在目标位置重建相同的环境。</p></li>
</ul>
<p class="translated">请参阅 <span class="target" id="index-9"></span><a class="pep reference external" href="https://peps.python.org/pep-0405/"><strong>PEP 405</strong></a> 了解有关 Python 虚拟环境的更多背景信息。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p class="translated"><a class="reference external" href="https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/#create-and-use-virtual-environments">Python Packaging User Guide: Creating and using virtual environments</a></p>
</div>
<div class="availability docutils container">
<p class="translated"><a class="reference internal" href="intro.html#availability"><span class="std std-ref">Availability</span></a>: not Android, not iOS, not WASI.</p>
<p class="translated">此模块在 <a class="reference internal" href="intro.html#mobile-availability"><span class="std std-ref">移动平台</span></a> 或 <a class="reference internal" href="intro.html#wasm-availability"><span class="std std-ref">WebAssembly 平台</span></a> 上不受支持。</p>
</div>
<section id="creating-virtual-environments">
<h2 class="translated">创建虚拟环境<a class="headerlink" href="#creating-virtual-environments" title="Link to this heading">¶</a></h2>
<p class="translated"><a class="reference internal" href="#venv-def"><span class="std std-ref">虚拟环境</span></a> 是通过执行 <code class="docutils literal notranslate"><span class="pre">venv</span></code> 模块来创建的：</p>
<div class="translated highlight-shell notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>/path/to/new/virtual/environment
</pre></div>
</div>
<p class="translated">此命令会创建目标目录（必要时还包括父目录）并在其中放置一个 <code class="file docutils literal notranslate"><span class="pre">pyvenv.cfg</span></code> 文件，文件带有一个指向运行此命令的 Python 安装版的 <code class="docutils literal notranslate"><span class="pre">home</span></code> 键。 它还会创建一个 <code class="file docutils literal notranslate"><span class="pre">bin</span></code> 子目录 (在 Windows 上为 <code class="file docutils literal notranslate"><span class="pre">Scripts</span></code>)，其中包含 Python 可执行文件的副本或符号链接 (具体由创建环境时所使用的平台或参数而定)。 它还会创建一个 <code class="file docutils literal notranslate"><span class="pre">lib/pythonX.Y/site-packages</span></code> 子目录 (在 Windows 上则为 <code class="file docutils literal notranslate"><span class="pre">Lib\site-packages</span></code> )。 如果指定了现有的目录，则该目录将被重用。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.5 版本发生变更: </span>现在推荐使用 <code class="docutils literal notranslate"><span class="pre">venv</span></code> 来创建虚拟环境。</p>
</div>
<div class="deprecated-removed">
<p><span class="versionmodified removed">Deprecated since version 3.6, removed in version 3.8: </span><strong class="program">pyvenv</strong> 是针对 Python 3.3 和 3.4 创建虚拟环境的推荐工具，并在 3.5 中被直接执行 <code class="docutils literal notranslate"><span class="pre">venv</span></code> 的方式所取代。</p>
</div>
<p class="translated">在 Windows，像下面这样唤起 <code class="docutils literal notranslate"><span class="pre">venv</span></code> 命令：</p>
<div class="translated highlight-ps1con notranslate"><div class="highlight"><pre><span></span><span class="gp">PS&gt; </span><span class="n">python</span> <span class="n">-m</span> <span class="n">venv</span> <span class="n">C</span><span class="p">:\</span><span class="n">path</span><span class="p">\</span><span class="n">to</span><span class="p">\</span><span class="n">new</span><span class="p">\</span><span class="n">virtual</span><span class="p">\</span><span class="n">environment</span>
</pre></div>
</div>
<p class="translated">本命令如果以 <code class="docutils literal notranslate"><span class="pre">-h</span></code> 参数运行，将显示可用的选项:</p>
<div class="translated highlight-none notranslate"><div class="highlight"><pre><span></span>usage: venv [-h] [--system-site-packages] [--symlinks | --copies] [--clear]
            [--upgrade] [--without-pip] [--prompt PROMPT] [--upgrade-deps]
            [--without-scm-ignore-files]
            ENV_DIR [ENV_DIR ...]

Creates virtual Python environments in one or more target directories.

Once an environment has been created, you may wish to activate it, e.g. by
sourcing an activate script in its bin directory.
</pre></div>
</div>
<dl class="std option" id="venv-cli">
<dt class="sig sig-object std" id="cmdoption-venv-arg-ENV_DIR">
<span class="sig-name descname"><span class="pre">ENV_DIR</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-venv-arg-ENV_DIR" title="Link to this definition">¶</a></dt>
<dd><p class="translated">一个必需参数，用于指定创建环境所在的目录。</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-venv-system-site-packages">
<span class="sig-name descname"><span class="pre">--system-site-packages</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-venv-system-site-packages" title="Link to this definition">¶</a></dt>
<dd><p class="translated">授予虚拟环境访问系统 site-packages 目录的权限。</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-venv-symlinks">
<span class="sig-name descname"><span class="pre">--symlinks</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-venv-symlinks" title="Link to this definition">¶</a></dt>
<dd><p class="translated">当符号链接不是平台的默认选项时，尽量使用符号链接而非复制操作。</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-venv-copies">
<span class="sig-name descname"><span class="pre">--copies</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-venv-copies" title="Link to this definition">¶</a></dt>
<dd><p class="translated">即使符号链接是平台的默认选项，也尽量使用复制操作而非符号链接。</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-venv-clear">
<span class="sig-name descname"><span class="pre">--clear</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-venv-clear" title="Link to this definition">¶</a></dt>
<dd><p class="translated">在创建环境之前，如果环境目录已存在，则删除其内容。</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-venv-upgrade">
<span class="sig-name descname"><span class="pre">--upgrade</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-venv-upgrade" title="Link to this definition">¶</a></dt>
<dd><p class="translated">将环境目录升级为使用此版本的 Python，前提是 Python 已就地升级。</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-venv-without-pip">
<span class="sig-name descname"><span class="pre">--without-pip</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-venv-without-pip" title="Link to this definition">¶</a></dt>
<dd><p class="translated">跳过在虚拟环境中安装或升级 pip 的操作（pip 默认会通过引导程序进行安装）。</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-venv-prompt">
<span class="sig-name descname"><span class="pre">--prompt</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;PROMPT&gt;</span></span><a class="headerlink" href="#cmdoption-venv-prompt" title="Link to this definition">¶</a></dt>
<dd><p class="translated">为该环境提供一个替代性的提示前缀。</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-venv-upgrade-deps">
<span class="sig-name descname"><span class="pre">--upgrade-deps</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-venv-upgrade-deps" title="Link to this definition">¶</a></dt>
<dd><p class="translated">将核心依赖 (pip) 升级至 PyPI 中的最新版本。</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-venv-without-scm-ignore-files">
<span class="sig-name descname"><span class="pre">--without-scm-ignore-files</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-venv-without-scm-ignore-files" title="Link to this definition">¶</a></dt>
<dd><p class="translated">跳过向环境目录添加 SCM 忽略文件 (默认将支持 Git)。</p>
</dd></dl>

<div class="versionchanged">
<p><span class="versionmodified changed">在 3.4 版本发生变更: </span>默认安装 pip，添加了 <code class="docutils literal notranslate"><span class="pre">--without-pip</span></code> 和 <code class="docutils literal notranslate"><span class="pre">--copies</span></code> 选项。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.4 版本发生变更: </span>在早期版本中，如果目标目录已存在，将引发错误，除非使用了 <code class="docutils literal notranslate"><span class="pre">--clear</span></code> 或 <code class="docutils literal notranslate"><span class="pre">--upgrade</span></code> 选项。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.9 版本发生变更: </span>添加 <code class="docutils literal notranslate"><span class="pre">--upgrade-deps</span></code> 选项以将 pip + setuptools 升级为 PyPI 上的最新版本。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.12 版本发生变更: </span><code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 不再是核心的 venv 依赖项。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.13 版本发生变更: </span>增加了 <code class="docutils literal notranslate"><span class="pre">--without-scm-ignore-files</span></code> 选项。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.13 版本发生变更: </span>现在 <code class="docutils literal notranslate"><span class="pre">venv</span></code> 默认会创建为 Git 创建一个 <code class="file docutils literal notranslate"><span class="pre">.gitignore</span></code> 文件。</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p class="translated">虽然 Windows 支持符号链接，但不推荐使用它们。特别注意，在文件资源管理器中双击 <code class="docutils literal notranslate"><span class="pre">python.exe</span></code> 将立即解析符号链接，并忽略虚拟环境。</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p class="translated">在 Microsoft Windows 上，为了启用 <code class="docutils literal notranslate"><span class="pre">Activate.ps1</span></code> 脚本，可能需要修改用户的执行策略。可以运行以下 PowerShell 命令来执行此操作：</p>
<div class="translated highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">PS </span><span class="n">C</span><span class="p">:\&gt;</span> <span class="nb">Set-ExecutionPolicy</span> <span class="n">-ExecutionPolicy</span> <span class="n">RemoteSigned</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</pre></div>
</div>
<p class="translated">参阅 <a class="reference external" href="https://go.microsoft.com/fwlink/?LinkID=135170">About Execution Policies</a> 以获取更多信息。</p>
</div>
<p class="translated">创建的 <code class="file docutils literal notranslate"><span class="pre">pyvenv.cfg</span></code> 文件还包括 <code class="docutils literal notranslate"><span class="pre">include-system-site-packages</span></code> 键，如果运行 <code class="docutils literal notranslate"><span class="pre">venv</span></code> 时带有 <code class="docutils literal notranslate"><span class="pre">--system-site-packages</span></code> 选项则将会其设为 <code class="docutils literal notranslate"><span class="pre">true</span></code>，否则为 <code class="docutils literal notranslate"><span class="pre">false</span></code>。</p>
<p class="translated">除非采用 <code class="docutils literal notranslate"><span class="pre">--without-pip</span></code> 选项，否则将会调用 <a class="reference internal" href="ensurepip.html#module-ensurepip" title="ensurepip: Bootstrapping the &quot;pip&quot; installer into an existing Python installation or virtual environment."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ensurepip</span></code></a> 将 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 引导到虚拟环境中。</p>
<p class="translated">可以向 <code class="docutils literal notranslate"><span class="pre">venv</span></code> 传入多个路径，此时将根据给定的选项，在所给的每个路径上创建相同的虚拟环境。</p>
</section>
<section id="how-venvs-work">
<span id="venv-explanation"></span><h2 class="translated">虚拟环境是如何实现的<a class="headerlink" href="#how-venvs-work" title="Link to this heading">¶</a></h2>
<p class="translated">当运行虚拟环境中的 Python 解释器时，<a class="reference internal" href="sys.html#sys.prefix" title="sys.prefix"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.prefix</span></code></a> 和 <a class="reference internal" href="sys.html#sys.exec_prefix" title="sys.exec_prefix"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.exec_prefix</span></code></a> 将指向该虚拟环境的相应目录，而 <a class="reference internal" href="sys.html#sys.base_prefix" title="sys.base_prefix"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.base_prefix</span></code></a> 和 <a class="reference internal" href="sys.html#sys.base_exec_prefix" title="sys.base_exec_prefix"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.base_exec_prefix</span></code></a> 将指向用于创建该虚拟环境的基础 Python 的相应目录。 只需检测 <code class="docutils literal notranslate"><span class="pre">sys.prefix</span> <span class="pre">!=</span> <span class="pre">sys.base_prefix</span></code> 就足以确定当前解释器是否运行于虚拟环境中。</p>
<p class="translated">一个虚拟环境可以通过位于其二进制文件目录目录 (在 POSIX 上为 <code class="docutils literal notranslate"><span class="pre">bin</span></code>；在 Windows 上为 <code class="docutils literal notranslate"><span class="pre">Scripts</span></code> ) 中的脚本来“激活”。 这会将该目录添加到你的 <span class="target" id="index-10"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>，这样运行 <strong class="program">python</strong> 时就会唤起虚拟环境的 Python 解释器，从而可以运行该目录中安装的脚本而不必使用其完整路径。 激活脚本的唤起方式是平台专属的 (<code class="samp docutils literal notranslate"><em><span class="pre">&lt;venv&gt;</span></em></code> 必须用包含虚拟环境目录的路径来替换):</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p class="translated">平台</p></th>
<th class="head"><p class="translated">Shell</p></th>
<th class="head"><p class="translated">用于激活虚拟环境的命令</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p class="translated">POSIX</p></td>
<td><p class="translated">bash/zsh</p></td>
<td><p class="translated"><code class="samp docutils literal notranslate"><span class="pre">$</span> <span class="pre">source</span> <em><span class="pre">&lt;venv&gt;</span></em><span class="pre">/bin/activate</span></code></p></td>
</tr>
<tr class="row-odd"><td><p class="translated">fish</p></td>
<td><p class="translated"><code class="samp docutils literal notranslate"><span class="pre">$</span> <span class="pre">source</span> <em><span class="pre">&lt;venv&gt;</span></em><span class="pre">/bin/activate.fish</span></code></p></td>
</tr>
<tr class="row-even"><td><p class="translated">csh/tcsh</p></td>
<td><p class="translated"><code class="samp docutils literal notranslate"><span class="pre">$</span> <span class="pre">source</span> <em><span class="pre">&lt;venv&gt;</span></em><span class="pre">/bin/activate.csh</span></code></p></td>
</tr>
<tr class="row-odd"><td><p class="translated">pwsh</p></td>
<td><p class="translated"><code class="samp docutils literal notranslate"><span class="pre">$</span> <em><span class="pre">&lt;venv&gt;</span></em><span class="pre">/bin/Activate.ps1</span></code></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p class="translated">Windows</p></td>
<td><p class="translated">cmd.exe</p></td>
<td><p class="translated"><code class="samp docutils literal notranslate"><span class="pre">C:\&gt;</span> <em><span class="pre">&lt;venv&gt;</span></em><span class="pre">\Scripts\activate.bat</span></code></p></td>
</tr>
<tr class="row-odd"><td><p class="translated">PowerShell</p></td>
<td><p class="translated"><code class="samp docutils literal notranslate"><span class="pre">PS</span> <span class="pre">C:\&gt;</span> <em><span class="pre">&lt;venv&gt;</span></em><span class="pre">\Scripts\Activate.ps1</span></code></p></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.4: </span><strong class="program">fish</strong> 和 <strong class="program">csh</strong> 激活脚本。</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.8: </span>在 POSIX 上安装 PowerShell 激活脚本，以支持 PowerShell Core。</p>
</div>
<p class="translated">激活一个虚拟环境的操作 <em>不是必需的</em>，因为你完全可以在唤起 Python 时指明特定虚拟环境的 Python 解释器的完整路径。 更进一步地说，安装在虚拟环境中的所有脚本也都可以在不激活该虚拟环境的情况下运行。</p>
<p class="translated">为了达成此目的，安装到虚拟环境中的脚本将包含一个以“井号叹号”打头的行用来指定虚拟环境的 Python 解释器，<code class="samp docutils literal notranslate"><span class="pre">#!/</span><em><span class="pre">&lt;path-to-venv&gt;</span></em><span class="pre">/bin/python</span></code>。 这意味着无论 <span class="target" id="index-11"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> 的值是什么该脚本都将使用指定的解释器运行。 在 Windows 上，对处理“井号叹号”行的支持将在你安装了 <a class="reference internal" href="../using/windows.html#launcher"><span class="std std-ref">Python 安装管理器</span></a> 的情况下获得。 这样，在 Windows 资源管理器窗口中双击一个已安装的脚本应当会使用正确的解释器运行它而无需激活相应虚拟环境或设置 <span class="target" id="index-12"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>。</p>
<p class="translated">当一个虚拟环境已被激活时，<code class="xref std std-envvar docutils literal notranslate"><span class="pre">VIRTUAL_ENV</span></code> 环境变量会被设为该虚拟环境的路径。 由于使用虚拟环境并不需要显式地激活它，因此 <code class="xref std std-envvar docutils literal notranslate"><span class="pre">VIRTUAL_ENV</span></code> 并不能被用来可靠地确定是否正在使用虚拟环境。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p class="translated">因为安装在虚拟环境中的脚本不应要求必须激活该虚拟环境，所以它们的“井号叹号”行会包含虚拟环境的绝对路径。 因为这一点，所以虚拟环境在通常情况下都是不可移植的。 你应当保证提供重建一个虚拟环境的简便方式（举例来说，如果你准备了需求文件 <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>，则可以使用虚拟环境的 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 执行 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span></code> 来安装虚拟环境所需的所有软件包）。 如果出于某种原因你需要将虚拟环境移动到一个新的位置，则你应当在目标位置上重建它并删除旧位置上的虚拟环境。 如果出于某种原因你移动了一个虚拟环境的上级目录，你也应当在新位置上重建该虚拟环境。 否则，安装到该虚拟环境的软件包可能无法正常工作。</p>
</div>
<p class="translated">你可以通过在 shell 中输入 <code class="docutils literal notranslate"><span class="pre">deactivate</span></code> 来取消激活一个虚拟环境。 取消激活的实现机制依赖于具体平台并且属于内部实现细节（通常，将会使用一个脚本或者 shell 函数）。</p>
</section>
<section id="api">
<span id="venv-api"></span><h2 class="translated">API<a class="headerlink" href="#api" title="Link to this heading">¶</a></h2>
<p class="translated">上述的高级方法使用了一个简单的 API，该 API 提供了一种机制，第三方虚拟环境创建者可以根据其需求自定义环境创建过程，该 API 为 <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnvBuilder</span></code></a> 类。</p>
<dl class="py class">
<dt class="sig sig-object py" id="venv.EnvBuilder">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">venv.</span></span><span class="sig-name descname"><span class="pre">EnvBuilder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">system_site_packages</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clear</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symlinks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upgrade</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">with_pip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prompt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upgrade_deps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">scm_ignore_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">frozenset()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder" title="Link to this definition">¶</a></dt>
<dd><p class="translated"><a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnvBuilder</span></code></a> 类在实例化时接受以下关键字参数：</p>
<ul class="simple">
<li><p class="translated"><em>system_site_packages</em> -- 一个指明系统 Python 的 site-packages 是否要对该环境可用的布尔值 (默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code>)。</p></li>
<li><p class="translated"><em>clear</em> -- 一个布尔值，当为真时，将在创建环境前删除任何现有目标目录的内容。</p></li>
<li><p class="translated"><em>symlinks</em> -- 一个指明是否要尝试创建 Python 二进制文件的符号链接而非复制的布尔值。</p></li>
<li><p class="translated"><em>upgrade</em> -- 一个布尔值，当为真时，将使用当前运行的 Python 升级现有环境 —— 用于 Python 已原地更新的情况 (默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code>)。</p></li>
<li><p class="translated"><em>with_pip</em> -- 一个布尔值，当为真时，将确保在虚拟环境中已安装 pip。 这将执行 <a class="reference internal" href="ensurepip.html#module-ensurepip" title="ensurepip: Bootstrapping the &quot;pip&quot; installer into an existing Python installation or virtual environment."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ensurepip</span></code></a> 并使用 <code class="docutils literal notranslate"><span class="pre">--default-pip</span></code> 选项。</p></li>
<li><p class="translated"><em>prompt</em> -- 一个要在虚拟环境被激活后显示的字符串（默认值 <code class="docutils literal notranslate"><span class="pre">None</span></code> 表示将使用环境的目录名）。 如果提供特殊的字符串 <code class="docutils literal notranslate"><span class="pre">&quot;.&quot;</span></code>，则将使用当前目录的基本名作为提示符。</p></li>
<li><p class="translated"><em>upgrade_deps</em> -- 将 venv 的基础模块更新为 PyPI 上的最新版本</p></li>
<li><p class="translated"><em>scm_ignore_files</em> -- 基于在可迭代对象中指定的源代码控制管理器（SCM）创建忽略文件。 这项支持是通过名为 <code class="docutils literal notranslate"><span class="pre">create_{scm}_ignore_file</span></code> 的方法来定义的。 默认支持的值只有通过 <a class="reference internal" href="#venv.EnvBuilder.create_git_ignore_file" title="venv.EnvBuilder.create_git_ignore_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_git_ignore_file()</span></code></a> 定义的 <code class="docutils literal notranslate"><span class="pre">&quot;git&quot;</span></code>。</p></li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.4 版本发生变更: </span>添加 <code class="docutils literal notranslate"><span class="pre">with_pip</span></code> 参数</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.6 版本发生变更: </span>添加 <code class="docutils literal notranslate"><span class="pre">prompt</span></code> 参数</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.9 版本发生变更: </span>添加 <code class="docutils literal notranslate"><span class="pre">upgrade_deps</span></code> 参数</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.13 版本发生变更: </span>增加了 <code class="docutils literal notranslate"><span class="pre">scm_ignore_files</span></code> 形参</p>
</div>
<p class="translated"><a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnvBuilder</span></code></a> 可以被用作基类。</p>
<dl class="py method">
<dt class="sig sig-object py" id="venv.EnvBuilder.create">
<span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">env_dir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.create" title="Link to this definition">¶</a></dt>
<dd><p class="translated">指定要建立虚拟环境的目标目录（绝对路径或相对于当前路径）来创建虚拟环境。<code class="docutils literal notranslate"><span class="pre">create</span></code> 方法将在指定目录中创建环境，或者引发对应的异常。</p>
<p class="translated"><a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnvBuilder</span></code></a> 类的 <code class="docutils literal notranslate"><span class="pre">create</span></code> 方法定义了可用于定制子类的钩子:</p>
<div class="translated highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    在一个目录中创建虚拟的 Python 环境。</span>
<span class="sd">    env_dir 是用于创建环境的目标目录。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_directories</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">create_configuration</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_python</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_scripts</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">post_setup</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">每个方法 <a class="reference internal" href="#venv.EnvBuilder.ensure_directories" title="venv.EnvBuilder.ensure_directories"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ensure_directories()</span></code></a>, <a class="reference internal" href="#venv.EnvBuilder.create_configuration" title="venv.EnvBuilder.create_configuration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_configuration()</span></code></a>, <a class="reference internal" href="#venv.EnvBuilder.setup_python" title="venv.EnvBuilder.setup_python"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup_python()</span></code></a>, <a class="reference internal" href="#venv.EnvBuilder.setup_scripts" title="venv.EnvBuilder.setup_scripts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup_scripts()</span></code></a> 和 <a class="reference internal" href="#venv.EnvBuilder.post_setup" title="venv.EnvBuilder.post_setup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">post_setup()</span></code></a> 都可以被重写。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="venv.EnvBuilder.ensure_directories">
<span class="sig-name descname"><span class="pre">ensure_directories</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">env_dir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.ensure_directories" title="Link to this definition">¶</a></dt>
<dd><p class="translated">创建虚拟环境目录及尚不存在的所有必要的子目录，并返回一个上下文对象。 这个上下文对象被用于存放供其他方法使用的属性（如路径等）。 如果 <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnvBuilder</span></code></a> 是附带参数 <code class="docutils literal notranslate"><span class="pre">clear=True</span></code> 创建的，则虚拟环境的内容将被清除并将重新创建所有必要的子目录。</p>
<p class="translated">返回的上下文对象是一个具有以下属性的 <a class="reference internal" href="types.html#types.SimpleNamespace" title="types.SimpleNamespace"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.SimpleNamespace</span></code></a>:</p>
<ul class="simple">
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">env_dir</span></code> - 虚拟环境的位置。 将被用作激活脚本中的 <code class="docutils literal notranslate"><span class="pre">__VENV_DIR__</span></code> (参见 <a class="reference internal" href="#venv.EnvBuilder.install_scripts" title="venv.EnvBuilder.install_scripts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">install_scripts()</span></code></a>)。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">env_name</span></code> - 虚拟环境的名称。 将被用作激活脚本中的 <code class="docutils literal notranslate"><span class="pre">__VENV_NAME__</span></code> (参见 <a class="reference internal" href="#venv.EnvBuilder.install_scripts" title="venv.EnvBuilder.install_scripts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">install_scripts()</span></code></a>)。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">prompt</span></code> - 激活脚本要使用的提示符。 将被用作激活脚本中的 <code class="docutils literal notranslate"><span class="pre">__VENV_PROMPT__</span></code> (参见 <a class="reference internal" href="#venv.EnvBuilder.install_scripts" title="venv.EnvBuilder.install_scripts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">install_scripts()</span></code></a>)。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">executable</span></code> - 虚拟环境所使用的下层 Python 可执行文件。 这会将基于另一个虚拟环境创建虚拟环境的情况也纳入考虑。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">inc_path</span></code> - 虚拟环境的 include 路径。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">lib_path</span></code> - 虚拟环境的 purelib 路径。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">bin_path</span></code> - 虚拟环境的 script 路径。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">bin_name</span></code> - 相对于虚拟环境位置的 script 路径名称。 用于激活脚本中的 <code class="docutils literal notranslate"><span class="pre">__VENV_BIN_NAME__</span></code> (参见 <a class="reference internal" href="#venv.EnvBuilder.install_scripts" title="venv.EnvBuilder.install_scripts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">install_scripts()</span></code></a>)。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">env_exe</span></code> - 虚拟环境中 Python 解释器的名称。 用于激活脚本中的 <code class="docutils literal notranslate"><span class="pre">__VENV_PYTHON__</span></code> (参见 <a class="reference internal" href="#venv.EnvBuilder.install_scripts" title="venv.EnvBuilder.install_scripts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">install_scripts()</span></code></a>)。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">env_exec_cmd</span></code> - Python 解释器的名称，会将文件系统重定向也纳入考虑。 这可被用于在虚拟环境中运行 Python。</p></li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.11 版本发生变更: </span><em>venv</em> <a class="reference internal" href="sysconfig.html#installation-paths"><span class="std std-ref">sysconfig installation scheme</span></a> 被用于构造所创建目录的路径。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.12 版本发生变更: </span>将属性 <code class="docutils literal notranslate"><span class="pre">lib_path</span></code> 添加到上下文中，并将上下文对象写入文档。</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="venv.EnvBuilder.create_configuration">
<span class="sig-name descname"><span class="pre">create_configuration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.create_configuration" title="Link to this definition">¶</a></dt>
<dd><p class="translated">在环境中创建 <code class="docutils literal notranslate"><span class="pre">pyvenv.cfg</span></code> 配置文件。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="venv.EnvBuilder.setup_python">
<span class="sig-name descname"><span class="pre">setup_python</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.setup_python" title="Link to this definition">¶</a></dt>
<dd><p class="translated">在环境中创建 Python 可执行文件的拷贝或符号链接。在 POSIX 系统上，如果给定了可执行文件 <code class="docutils literal notranslate"><span class="pre">python3.x</span></code>，将创建指向该可执行文件的 <code class="docutils literal notranslate"><span class="pre">python</span></code> 和 <code class="docutils literal notranslate"><span class="pre">python3</span></code> 符号链接，除非相同名称的文件已经存在。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="venv.EnvBuilder.setup_scripts">
<span class="sig-name descname"><span class="pre">setup_scripts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.setup_scripts" title="Link to this definition">¶</a></dt>
<dd><p class="translated">将适用于平台的激活脚本安装到虚拟环境中。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="venv.EnvBuilder.upgrade_dependencies">
<span class="sig-name descname"><span class="pre">upgrade_dependencies</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.upgrade_dependencies" title="Link to this definition">¶</a></dt>
<dd><p class="translated">升级环境中的核心 venv 依赖包 (目前为 <a class="extlink-pypi reference external" href="https://pypi.org/project/pip/">pip</a>)。 这是通过将 shell 命令传出到环境中的 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 可执行文件来完成的。</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.9.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.12 版本发生变更: </span><a class="extlink-pypi reference external" href="https://pypi.org/project/setuptools/">setuptools</a> 不再属于核心 venv 依赖项。</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="venv.EnvBuilder.post_setup">
<span class="sig-name descname"><span class="pre">post_setup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.post_setup" title="Link to this definition">¶</a></dt>
<dd><p class="translated">占位方法，可以在第三方实现中重写，用于在虚拟环境中预安装软件包，或是其他创建后要执行的步骤。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="venv.EnvBuilder.install_scripts">
<span class="sig-name descname"><span class="pre">install_scripts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.install_scripts" title="Link to this definition">¶</a></dt>
<dd><p class="translated">此方法可以从子类的 <a class="reference internal" href="#venv.EnvBuilder.setup_scripts" title="venv.EnvBuilder.setup_scripts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup_scripts()</span></code></a> 或 <a class="reference internal" href="#venv.EnvBuilder.post_setup" title="venv.EnvBuilder.post_setup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">post_setup()</span></code></a> 调用以将自定义脚本安装到虚拟环境中。</p>
<p class="translated"><em>path</em> 是一个目录的路径，该目录应包含子目录 <code class="docutils literal notranslate"><span class="pre">common</span></code>, <code class="docutils literal notranslate"><span class="pre">posix</span></code>, <code class="docutils literal notranslate"><span class="pre">nt</span></code>；每个子目录中包含指向环境中 <code class="docutils literal notranslate"><span class="pre">bin</span></code> 目录的脚本。 在一些占位符文本替换完毕后将会拷贝 <code class="docutils literal notranslate"><span class="pre">common</span></code> 和对应于 <a class="reference internal" href="os.html#os.name" title="os.name"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.name</span></code></a> 的子目录的内容：</p>
<ul class="simple">
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">__VENV_DIR__</span></code> 会被替换为环境目录的绝对路径。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">__VENV_NAME__</span></code> 会被替换为环境名称（环境目录的最后一个字段）。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">__VENV_PROMPT__</span></code> 会被替换为提示符（用括号括起来的环境名称紧跟着一个空格）。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">__VENV_BIN_NAME__</span></code> 会被替换为 bin 目录的名称（ <code class="docutils literal notranslate"><span class="pre">bin</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Scripts</span></code> ）。</p></li>
<li><p class="translated"><code class="docutils literal notranslate"><span class="pre">__VENV_PYTHON__</span></code> 会被替换为环境可执行文件的绝对路径。</p></li>
</ul>
<p class="translated">允许目录已存在（用于升级现有环境时）。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="venv.EnvBuilder.create_git_ignore_file">
<span class="sig-name descname"><span class="pre">create_git_ignore_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.create_git_ignore_file" title="Link to this definition">¶</a></dt>
<dd><p class="translated">在虚拟环境中创建 <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> 文件将使整个目录被 Git 源代码控制管理器所忽略。</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.13.</span></p>
</div>
</dd></dl>

<div class="versionchanged">
<p><span class="versionmodified changed">在 3.7.2 版本发生变更: </span>Windows 现在为 <code class="docutils literal notranslate"><span class="pre">python[w].exe</span></code> 使用重定向脚本，而不是复制实际的二进制文件。仅在 3.7.2 中，除非运行的是源码树中的构建，否则 <a class="reference internal" href="#venv.EnvBuilder.setup_python" title="venv.EnvBuilder.setup_python"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup_python()</span></code></a> 不会执行任何操作。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.7.3 版本发生变更: </span>Windows 将重定向脚本复制为 <a class="reference internal" href="#venv.EnvBuilder.setup_python" title="venv.EnvBuilder.setup_python"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup_python()</span></code></a> 的一部分而非 <a class="reference internal" href="#venv.EnvBuilder.setup_scripts" title="venv.EnvBuilder.setup_scripts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup_scripts()</span></code></a>。在 3.7.2 中不是这种情况。使用符号链接时，将链接至原始可执行文件。</p>
</div>
</dd></dl>

<p class="translated">有一个方便实用的模块级别的函数:</p>
<dl class="py function">
<dt class="sig sig-object py" id="venv.create">
<span class="sig-prename descclassname"><span class="pre">venv.</span></span><span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">env_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">system_site_packages</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clear</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symlinks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">with_pip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prompt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upgrade_deps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">scm_ignore_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">frozenset()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#venv.create" title="Link to this definition">¶</a></dt>
<dd><p class="translated">通过关键词参数来创建一个 <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnvBuilder</span></code></a>，并且使用 <em>env_dir</em> 参数来调用它的 <a class="reference internal" href="#venv.EnvBuilder.create" title="venv.EnvBuilder.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create()</span></code></a> 方法。</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.3.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.4 版本发生变更: </span>增加了 <em>with_pip</em> 形参</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.6 版本发生变更: </span>增加了 <em>prompt</em> 形参</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.9 版本发生变更: </span>增加了 <em>upgrade_deps</em> 形参</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.13 版本发生变更: </span>增加了 <em>scm_ignore_files</em> 形参</p>
</div>
</dd></dl>

</section>
<section id="an-example-of-extending-envbuilder">
<h2 class="translated">一个扩展 <code class="docutils literal notranslate"><span class="pre">EnvBuilder</span></code> 的例子<a class="headerlink" href="#an-example-of-extending-envbuilder" title="Link to this heading">¶</a></h2>
<p class="translated">下面的脚本展示了如何通过实现一个子类来扩展 <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnvBuilder</span></code></a>。这个子类会安装 setuptools 和 pip 到被创建的虚拟环境中。</p>
<div class="translated highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os.path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">subprocess</span><span class="w"> </span><span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.request</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlretrieve</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">venv</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ExtendedEnvBuilder</span><span class="p">(</span><span class="n">venv</span><span class="o">.</span><span class="n">EnvBuilder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This builder installs setuptools and pip so that you can pip or</span>
<span class="sd">    easy_install other packages into the created virtual environment.</span>

<span class="sd">    :param nodist: If true, setuptools and pip are not installed into the</span>
<span class="sd">                   created virtual environment.</span>
<span class="sd">    :param nopip: If true, pip is not installed into the created</span>
<span class="sd">                  virtual environment.</span>
<span class="sd">    :param progress: If setuptools or pip are installed, the progress of the</span>
<span class="sd">                     installation can be monitored by passing a progress</span>
<span class="sd">                     callable. If specified, it is called with two</span>
<span class="sd">                     arguments: a string indicating some progress, and a</span>
<span class="sd">                     context indicating where the string is coming from.</span>
<span class="sd">                     The context argument can have one of three values:</span>
<span class="sd">                     &#39;main&#39;, indicating that it is called from virtualize()</span>
<span class="sd">                     itself, and &#39;stdout&#39; and &#39;stderr&#39;, which are obtained</span>
<span class="sd">                     by reading lines from the output streams of a subprocess</span>
<span class="sd">                     which is used to install the app.</span>

<span class="sd">                     If a callable is not specified, default progress</span>
<span class="sd">                     information is output to sys.stderr.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodist</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nodist&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nopip</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nopip&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">post_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up any packages which need to be pre-installed into the</span>
<span class="sd">        virtual environment being created.</span>

<span class="sd">        :param context: The information for the virtual environment</span>
<span class="sd">                        creation request being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">env_dir</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">install_setuptools</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="c1"># 没有 setuptools 无法安装 pip</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nopip</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">install_pip</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read lines from a subprocess&#39; output stream and either pass to a progress</span>
<span class="sd">        callable (if specified) or write progress information to sys.stderr.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">progress</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">progress</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">install_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">binpath</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">bin_path</span>
        <span class="n">distpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">binpath</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        <span class="c1"># 将脚本下载到虚拟环境的可执行文件目录</span>
        <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">distpath</span><span class="p">)</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">progress</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">progress</span><span class="p">(</span><span class="s1">&#39;Installing </span><span class="si">%s</span><span class="s1"> ...</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">term</span><span class="p">),</span> <span class="s1">&#39;main&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Installing </span><span class="si">%s</span><span class="s1"> ...</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">term</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="c1"># 安装虚拟环境</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">context</span><span class="o">.</span><span class="n">env_exe</span><span class="p">,</span> <span class="n">fn</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">binpath</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span><span class="p">))</span>
        <span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s1">&#39;stderr&#39;</span><span class="p">))</span>
        <span class="n">t2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">progress</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">progress</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># 清理 —— 不再需要</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">distpath</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">install_setuptools</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Install setuptools in the virtual environment.</span>

<span class="sd">        :param context: The information for the virtual environment</span>
<span class="sd">                        creation request being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://bootstrap.pypa.io/ez_setup.py&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_script</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;setuptools&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="c1"># 清理已下载的 setuptools 归档</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;setuptools-&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tar.gz&#39;</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">bin_path</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">bin_path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">install_pip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Install pip in the virtual environment.</span>

<span class="sd">        :param context: The information for the virtual environment</span>
<span class="sd">                        creation request being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://bootstrap.pypa.io/get-pip.py&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_script</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
                                     <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Creates virtual Python &#39;</span>
                                                 <span class="s1">&#39;environments in one or &#39;</span>
                                                 <span class="s1">&#39;more target &#39;</span>
                                                 <span class="s1">&#39;directories.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;dirs&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;ENV_DIR&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;A directory in which to create the &#39;</span>
                             <span class="s1">&#39;virtual environment.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--no-setuptools&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;nodist&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Don&#39;t install setuptools or pip in the &quot;</span>
                             <span class="s2">&quot;virtual environment.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--no-pip&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;nopip&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Don&#39;t install pip in the virtual &quot;</span>
                             <span class="s2">&quot;environment.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--system-site-packages&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;system_site&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Give the virtual environment access to the &#39;</span>
                             <span class="s1">&#39;system site-packages dir.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>
        <span class="n">use_symlinks</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">use_symlinks</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--symlinks&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">use_symlinks</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;symlinks&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Try to use symlinks rather than copies, &#39;</span>
                             <span class="s1">&#39;when symlinks are not the default for &#39;</span>
                             <span class="s1">&#39;the platform.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--clear&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Delete the contents of the &#39;</span>
                                           <span class="s1">&#39;virtual environment &#39;</span>
                                           <span class="s1">&#39;directory if it already &#39;</span>
                                           <span class="s1">&#39;exists, before virtual &#39;</span>
                                           <span class="s1">&#39;environment creation.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--upgrade&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;upgrade&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Upgrade the virtual &#39;</span>
                                             <span class="s1">&#39;environment directory to &#39;</span>
                                             <span class="s1">&#39;use this version of &#39;</span>
                                             <span class="s1">&#39;Python, assuming Python &#39;</span>
                                             <span class="s1">&#39;has been upgraded &#39;</span>
                                             <span class="s1">&#39;in-place.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Display the output &#39;</span>
                                             <span class="s1">&#39;from the scripts which &#39;</span>
                                             <span class="s1">&#39;install setuptools and pip.&#39;</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">upgrade</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">clear</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;you cannot supply --upgrade and --clear together.&#39;</span><span class="p">)</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">ExtendedEnvBuilder</span><span class="p">(</span><span class="n">system_site_packages</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">system_site</span><span class="p">,</span>
                                   <span class="n">clear</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">clear</span><span class="p">,</span>
                                   <span class="n">symlinks</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">symlinks</span><span class="p">,</span>
                                   <span class="n">upgrade</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">upgrade</span><span class="p">,</span>
                                   <span class="n">nodist</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">nodist</span><span class="p">,</span>
                                   <span class="n">nopip</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">nopip</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">dirs</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
</pre></div>
</div>
<p class="translated">这个脚本同样可以 <a class="reference external" href="https://gist.github.com/vsajip/4673395">在线下载</a>。</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code> --- 虚拟环境的创建</a><ul>
<li><a class="reference internal" href="#creating-virtual-environments">创建虚拟环境</a></li>
<li><a class="reference internal" href="#how-venvs-work">虚拟环境是如何实现的</a></li>
<li><a class="reference internal" href="#api">API</a></li>
<li><a class="reference internal" href="#an-example-of-extending-envbuilder">一个扩展 <code class="docutils literal notranslate"><span class="pre">EnvBuilder</span></code> 的例子</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一主题</h4>
    <p class="topless"><a href="ensurepip.html"
                          title="上一章"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ensurepip</span></code> --- 初始设置 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 安装器</a></p>
  </div>
  <div>
    <h4>下一主题</h4>
    <p class="topless"><a href="zipapp.html"
                          title="下一章"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zipapp</span></code> --- 管理可执行的 Python zip 归档文件</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">报告代码错误</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/library/venv.rst?plain=1"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </div>
<div id="sidebarbutton" title="折叠边栏">
<span>«</span>
</div>

      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="Related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="zipapp.html" title="zipapp --- 管理可执行的 Python zip 归档文件"
             >下一页</a> |</li>
        <li class="right" >
          <a href="ensurepip.html" title="ensurepip --- 初始设置 pip 安装器"
             >上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="Python logo" style="vertical-align: middle; margin-top: -1px"></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.14.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 标准库</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="distribution.html" >软件打包和分发</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code> --- 虚拟环境的创建</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="search" name="q" id="search-box">
          <input type="submit" value="转到">
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    主题
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>自动</option>
        <option value="light">明亮</option>
        <option value="dark">黑暗</option>
    </select>
</label> |</li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">版权</a> 2001 Python Software Foundation.
    <br>
    本页面采用 Python 软件基金会许可证第 2 版授权。
    <br>
    文档中的示例、代码片段及其他代码内容额外采用零条款 BSD 许可证授权。
    <br>
    
      更多信息请参阅《<a href="/license.html"> 历史与许可 </a>》。<br>
    
    
    <br>

    Python 软件基金会是一家非营利性公司。
<a href="https://www.python.org/psf/donations/">请进行捐赠。</a>
<br>
    <br>
      最后更新于11月 25, 2025 (07:24 UTC) 。
    
      <a href="/bugs.html">发现了错误</a>？
    
    <br>

    使用<a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3 创建。
    </div>

  </body>
</html>